<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard - QualityX</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%2300bfff'/%3E%3Ctext x='50' y='55' font-family='Poppins, sans-serif' font-size='60' font-weight='bold' fill='white' text-anchor='middle' dominant-baseline='middle'%3EQ%3C/text%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { 
            supabase, 
            getCurrentUser,
            getUserById,
            getPerformanceMetrics,
            getErrorTrends,
            getDepartmentPerformance,
            getTeamMembers,
            updateUserProfile,
            getTeamSchedule,
            updateTeamSchedule,
            getNotifications,
            markNotificationAsRead,
            subscribeToNotifications,
            getCompanyEmployees,
            getDepartments,
            addCompanyEmployee,
            updateCompanyEmployee
        } from './api-client.js';
        
        window.supabase = supabase;
        window.getCurrentUser = getCurrentUser;
        window.getUserById = getUserById;
        window.getPerformanceMetrics = getPerformanceMetrics;
        window.getErrorTrends = getErrorTrends;
        window.getDepartmentPerformance = getDepartmentPerformance;
        window.getTeamMembers = getTeamMembers;
        window.updateUserProfile = updateUserProfile;
        window.getTeamSchedule = getTeamSchedule;
        window.updateTeamSchedule = updateTeamSchedule;
        window.getNotifications = getNotifications;
        window.markNotificationAsRead = markNotificationAsRead;
        window.getCompanyEmployees = getCompanyEmployees;
        window.getDepartments = getDepartments;
        window.addCompanyEmployee = addCompanyEmployee;
        window.updateCompanyEmployee = updateCompanyEmployee;
    </script>
    <style>
        :root {
            --primary-color: #00bfff;
            --primary-hover: #00a4d9;
            --bg-color: #121212;
            --sidebar-bg: #1a1a1a;
            --card-bg: #1a1a1a;
            --text-color: #e6edf3;
            --text-muted: #8b949e;
            --border-color: #333;
            --red: #dc3545;
            --red-bg: rgba(220, 53, 69, 0.1);
            --green: #28a745;
            --green-bg: rgba(40, 167, 69, 0.1);
            --yellow: #ffc107;
            --yellow-bg: rgba(255, 193, 7, 0.1);
            --purple: #6f42c1;
            --purple-bg: rgba(111, 66, 193, 0.1);
            --border-radius-base: 0.75rem;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-color); color: var(--text-color); display: flex; flex-direction: column; min-height: 100vh; }
        .sidebar { width: 260px; background-color: var(--sidebar-bg); height: 100vh; position: fixed; left: 0; top: 0; border-right:1px solid var(--border-color); display: flex; flex-direction: column; z-index: 1000; }
        .sidebar-header { display: flex; align-items: center; gap: 10px; padding: 20px; border-bottom: 1px solid var(--border-color); }
        .sidebar-logo { height: 32px; fill: var(--primary-color); }
        .sidebar-title { font-size: 1.25rem; color: var(--primary-color); font-weight: 700; }
        .sidebar-nav-container { flex-grow: 1; overflow-y: auto; padding-top: 1rem; }
        .nav-group { margin-bottom: 1.5rem; padding: 0 20px; }
        .nav-group-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 600; margin-bottom: 0.75rem; }
        .sidebar-nav { list-style:none; padding:0; margin:0; }
        .sidebar-nav a { display: flex; align-items: center; padding: 12px 15px; border-radius: 8px; color: var(--text-muted); text-decoration: none; margin-bottom: 10px; transition: all 0.3s ease; gap: 15px; cursor:pointer; white-space: nowrap; }
        .sidebar-nav a:hover, .sidebar-nav a.active { background-color: var(--primary-color); color: #000; }
        .sidebar-footer { padding: 15px 20px; border-top: 1px solid var(--border-color); }
        .user-profile-widget { display: flex; align-items: center; gap: 12px; }
        .avatar-initials { width: 44px; height: 44px; border-radius: 50%; background-color: var(--primary-color); color: black; font-weight: 700; font-size: 1rem; display: inline-flex; align-items: center; justify-content: center; }
        .user-name { font-weight: 600; font-size: 1rem; }
        .user-role { font-size: 0.8rem; color: var(--text-muted); }
        .user-status { font-size: 0.75rem; color: var(--green); margin-top: 2px; }
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 30px; flex: 1; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 1rem; }
        .header-left { flex-grow: 1; }
        .header-actions { display: flex; align-items: center; gap: 1rem; }
        .page-title { font-size: 24px; font-weight: 700; }
        #welcome-message { margin-bottom: 2rem; }
        #welcome-message h2 { font-size: 1.75rem; font-weight: 700; }
        #welcome-message p { color: var(--text-muted); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--card-bg); padding: 25px; border-radius: var(--border-radius-base); border: 1px solid var(--border-color); }
        .card h3 { font-size: 18px; font-weight: 600; margin-bottom: 20px; }
        .stat-card .stat-header { display: flex; justify-content: space-between; align-items: center; color: var(--text-muted); }
        .stat-card .stat-value { font-size: 32px; font-weight: 600; margin: 10px 0; }
        .stat-card .stat-change { display: flex; align-items: center; font-weight: 500; font-size: 14px; gap: 5px; }
        .stat-card .stat-change.positive { color: var(--green); }
        .stat-card .stat-change.negative { color: var(--red); }
        .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px; align-items: start; }
        .chart-container { position: relative; height: 350px; }
        .filter-container { display: flex; justify-content: center; width: 100%; margin-bottom: 30px; }
        .filter-panel { display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; background: var(--card-bg); padding: 20px; border-radius: var(--border-radius-base); border: 1px solid var(--border-color); width: 100%; max-width: 1200px; }
        .filter-group { flex: 1; min-width: 200px; }
        .filter-group label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 14px; }
        .filter-group input, .filter-group select { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; font-family: 'Poppins'; background: #2c2c2c; color:#fff; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; justify-content: center; gap: 8px; transition: background-color 0.2s; }
        .btn-primary { background: var(--primary-color); color: #000; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-secondary { background-color: var(--green); color: white; }
        .btn-secondary:hover { background-color: #218838; }
        .btn-danger { background-color: var(--red); color: white; }
        .btn-danger:hover { background-color: #c82333; }
        .placeholder-content { padding: 40px; text-align: center; color: var(--text-muted); border: 2px dashed var(--border-color); border-radius: var(--border-radius-base); }
        .placeholder-content h3 { color: var(--text-color); margin-bottom: 10px; }
        .search-input-container { position: relative; }
        .search-input-container .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
        .search-input-container input[type="search"] { background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 10px 12px 10px 38px; width: 300px; }
        
        /* حل مشكلة الـ autocomplete */
        .search-input-container input.anti-autofill {
            background: #2c2c2c !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            color: var(--text-color) !important;
            padding: 10px 12px 10px 38px !important;
            width: 300px !important;
            -webkit-text-fill-color: var(--text-color) !important;
            -webkit-box-shadow: 0 0 0px 1000px #2c2c2c inset !important;
            transition: background-color 5000s ease-in-out 0s !important;
        }
        
        .notification-bell { position: relative; }
        .notification-btn { background: none; border: none; color: var(--text-muted); font-size: 24px; cursor: pointer; padding: 5px; }
        .notification-dropdown { display: none; position: absolute; right: 0; top: 120%; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-base); width: 320px; box-shadow: 0 8px 16px rgba(0,0,0,0.3); z-index: 10; }
        .notification-dropdown.show { display: block; }
        .notification-header { padding: 1rem; border-bottom: 1px solid var(--border-color); font-weight: 600; }
        .notification-list { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; }
        .notification-item { padding: 1rem; border-bottom: 1px solid var(--border-color); font-size: 14px; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; color: var(--text-muted); }
        .form-group input, .form-group select { width: 100%; background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 10px 12px; }
        .page-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem; }
        .settings-layout { display: flex; gap: 2rem; }
        .settings-nav { flex: 0 0 200px; }
        .settings-nav ul { list-style: none; padding: 0; }
        .settings-nav a { display: block; padding: 0.75rem 1rem; text-decoration: none; color: var(--text-muted); border-radius: 8px; font-weight: 500; margin-bottom: 5px; }
        .settings-nav a:hover { background-color: #2c2c2c; color: var(--text-color); }
        .settings-nav a.active { background-color: var(--primary-color); color: black; }
        .settings-content { flex-grow: 1; }
        .settings-section { display: none; }
        .settings-section.active { display: block; animation: fadeIn 0.4s ease; }
        .setting-card { background-color: #222; padding: 1.5rem; border-radius: var(--border-radius-base); margin-bottom: 1.5rem; }
        .setting-card h4 { font-size: 1.25rem; margin-bottom: 0.5rem; color: var(--text-color); }
        .setting-card p { font-size: 1rem; color: var(--text-muted); margin-bottom: 1.5rem; margin-top: 0; }
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-base); padding: 15px 20px; margin-bottom: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 10px; max-width: 350px; animation: slideInRight 0.3s ease; }
        .toast.success { border-left: 4px solid var(--green); }
        .toast.error { border-left: 4px solid var(--red); }
        .toast.warning { border-left: 4px solid var(--yellow); }
        .toast.info { border-left: 4px solid var(--primary-color); }
        .toast-icon { font-size: 20px; }
        .toast.success .toast-icon { color: var(--green); }
        .toast.error .toast-icon { color: var(--red); }
        .toast.warning .toast-icon { color: var(--yellow); }
        .toast.info .toast-icon { color: var(--primary-color); }
        .toast-content { flex: 1; }
        .toast-title { font-weight: 600; margin-bottom: 5px; }
        .toast-message { font-size: 14px; color: var(--text-muted); }
        .toast-close { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 18px; }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .empty-state { text-align: center; padding: 40px; color: var(--text-muted); }
        .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
        .user-management-table { width: 100%; border-collapse: collapse; }
        .user-management-table th, .user-management-table td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
        .user-management-table th { font-weight: 600; font-size: 14px; color:var(--text-muted); text-transform: uppercase; background-color: #2c2c2c; }
        .user-management-table tbody tr:last-child td { border-bottom: none; }
        .user-management-table tbody tr:hover { background-color: #2c2c2c; }
        .role-badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .role-agent { background-color: var(--primary-color); color: #000; }
        .role-quality { background-color: var(--green); color: white; }
        .role-senior { background-color: var(--yellow); color: #000; }
        .role-manager { background-color: var(--purple); color: white; }
        .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .status-active { background-color: var(--green-bg); color: var(--green); }
        .status-inactive { background-color: var(--red-bg); color: var(--red); }
        .status-pending { background-color: var(--yellow-bg); color: var(--yellow); }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.show {
            display: flex;
            opacity: 1;
        }
        .modal-box {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-base);
            width: 90%;
            max-width: 500px;
            animation: slideInUp 0.4s ease;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
        }
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        .modal-close-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }
        .modal-body {
            padding: 1.5rem;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding: 1.25rem;
            border-top: 1px solid var(--border-color);
        }
        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-footer .btn-secondary {
            background-color: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            font-weight: 500;
        }
        .modal-footer .btn-secondary:hover {
            background-color: var(--border-color);
            color: var(--text-color);
        }

        .action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
            border: 1px solid transparent;
            transition: all 0.2s ease-in-out;
            margin-right: 5px;
            background-color: transparent;
        }
        .action-btn.edit-user-btn {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        .action-btn.edit-user-btn:hover {
            background-color: var(--primary-color);
            color: #000;
        }
        .action-btn.danger {
            border-color: var(--red);
            color: var(--red);
        }
        .action-btn.danger:hover {
            background-color: var(--red);
            color: white;
        }
        .action-btn.primary {
            border-color: var(--green);
            color: var(--green);
        }
        .action-btn.primary:hover {
            background-color: var(--green);
            color: white;
        }
        
        /* Team Scheduling Table Styles */
        #schedule-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid var(--border-color);
        }
        
        #schedule-table th, 
        #schedule-table td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: center;
            vertical-align: middle;
        }
        
        #schedule-table th {
            background-color: #2c2c2c;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.85rem;
        }
        
        #schedule-table td.member-name {
            text-align: left;
            font-weight: 600;
            background-color: #2c2c2c;
        }
        
        #schedule-table.edit-mode td.shift-cell {
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        #schedule-table.edit-mode td.shift-cell:hover {
            background-color: rgba(0, 191, 255, 0.1);
        }
        
        /* Shift status colors */
        .on-leave {
            color: var(--yellow);
        }
        
        .sick-leave {
            color: var(--red);
        }
        
        .off {
            color: var(--text-muted);
        }
        
        /* Schedule edit controls */
        #schedule-edit-controls {
            display: none;
            gap: 0.5rem;
            align-items: center;
        }
        
        @media (max-width: 1024px) {
            .sidebar { width: 220px; }
            .main-content { margin-left: 220px; width: calc(100% - 220px); }
            .charts-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .sidebar { width: 70px; }
            .sidebar-title, .nav-group-title, .user-name, .user-role, .user-status { display: none; }
            .sidebar-nav a span:not(.icon) { display: none; }
            .main-content { margin-left: 70px; width: calc(100% - 70px); padding: 15px; }
            .stats-grid { grid-template-columns: 1fr; }
            .filter-panel { flex-direction: column; }
            .filter-group { min-width: 100%; }
            .header-actions { flex-direction: column; align-items: flex-end; gap: 10px; }
            .search-input-container input[type="search"] { width: 200px; }
        }
        @media (max-width: 480px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; width: 100%; }
            .modal-box { width: 95%; padding: 1rem; }
        }
    </style>
</head>
<body>
    <!-- Form وهمي لخداع المتصفح -->
    <form style="display: none;" autocomplete="off">
        <input type="email" name="fake-email" value="">
        <input type="password" name="fake-password" value="">
    </form>

    <div class="container-wrapper" style="display: flex; flex-direction: column; min-height: 100vh;">
        <div style="display: flex; flex: 1;">
            <aside class="sidebar">
                <div>
                    <div class="sidebar-header">
                        <svg class="sidebar-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5-10-5-10 5z" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" fill-opacity="0.3"></path>
                            <path d="M12 22V12" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <h1 class="sidebar-title">QualityX</h1>
                    </div>
                    <div class="sidebar-nav-container">
                        <div class="nav-group">
                            <h2 class="nav-group-title">Menu</h2>
                            <ul class="sidebar-nav">
                                <li><a class="active" data-tab="dashboard">📊 Dashboard</a></li>
                                <li><a data-tab="reports">📄 Reports & Analytics</a></li>
                                <li><a data-tab="teams">👥 Teams</a></li>
                                <li><a data-tab="team-scheduling">📅 Team Scheduling</a></li>
                                <li><a data-tab="company-employees">🏢 Company Employees</a></li>
                                <li><a data-tab="departments">🏛️ Departments</a></li>
                                <li><a data-tab="payments">💳 Payments</a></li>
                                <li><a data-tab="kpis">📈 KPIs</a></li>
                            </ul>
                        </div>
                        <div class="nav-group">
                            <h2 class="nav-group-title">Account</h2>
                            <ul class="sidebar-nav">
                                <li><a data-tab="profile">👤 Profile</a></li>
                                <li><a data-tab="settings">⚙️ Settings</a></li>
                                <li><a data-tab="help">❓ Get Help</a></li>
                                <li><a id="logout-btn">🚪 Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="sidebar-footer">
                    <div class="user-profile-widget">
                        <div class="avatar-initials" id="sidebar-avatar-initials">NO</div>
                        <div>
                            <div class="user-name" id="sidebar-username">Nawaf Al-Otaibi</div>
                            <div class="user-role" id="sidebar-userrole">Manager</div>
                            <div class="user-status" id="sidebar-userstatus">● Connected</div>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="main-content">
                <header>
                    <div class="header-left">
                        <h2 class="page-title" id="page-title-header">Dashboard</h2>
                    </div>
                    <div class="header-actions">
                        <div class="search-input-container">
                            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            <input type="text" 
                                   placeholder="Search reports, teams..." 
                                   class="anti-autofill"
                                   id="main-search"
                                   name="search_main">
                        </div>
                        <div class="notification-bell">
                            <button id="notification-btn" class="notification-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                            </button>
                            <div id="notification-dropdown" class="notification-dropdown">
                                <div class="notification-header">Notifications</div>
                                <ul class="notification-list" id="notification-list">
                                    <li class="notification-item">Loading notifications...</li>
                                </ul>
                            </div>
                        </div>
                        <button class="btn btn-primary" id="export-report-btn">Export Overall Report</button>
                    </div>
                </header>

                <div id="dashboard" class="tab-content active">
                    <div id="welcome-message">
                        <h2 id="welcome-user-h2">Welcome, Loading...!</h2>
                        <p>Here is the high-level overview of your quality operations.</p>
                    </div>

                    <section class="stats-grid">
                        <div class="card stat-card">
                            <div class="stat-header"><span>Total Orders Reviewed</span><span style="color:var(--primary-color)">👁️</span></div>
                            <div class="stat-value" id="total-orders">0</div>
                            <div class="stat-change positive" id="orders-change"><span>⬆️</span> Loading...</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-header"><span>Overall Error Rate</span><span style="color:var(--red)">❌</span></div>
                            <div class="stat-value" id="error-rate">0%</div>
                            <div class="stat-change positive" id="error-rate-change" style="color: var(--green)"><span>⬇️</span> Loading...</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-header"><span>Top Performing Team</span><span style="color:var(--green)">⭐</span></div>
                            <div class="stat-value" id="top-team">Loading...</div>
                            <div class="stat-change positive" id="top-team-rate">Loading...</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-header"><span>Active Agents</span><span style="color:var(--purple)">👤</span></div>
                            <div class="stat-value" id="active-agents">0</div>
                            <div class="stat-change positive" id="agents-change"><span>➕</span> Loading...</div>
                        </div>
                    </section>

                    <div class="filter-container">
                        <section class="filter-panel">
                            <div class="filter-group">
                                <label>Department</label>
                                <select id="filter-department">
                                    <option value="all">All</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Team</label>
                                <select id="filter-team">
                                    <option value="all">All</option>
                                    <option value="team_a">Team A</option>
                                    <option value="team_b">Team B</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Employee</label>
                                <select id="filter-employee">
                                    <option value="all">All</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Date Range</label>
                                <input type="date" id="filter-date" style="color-scheme: dark;">
                            </div>
                            <button class="btn btn-primary" id="apply-filters-btn">Apply Filters</button>
                            <button id="download-report-btn" class="btn btn-secondary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                Download Report
                            </button>
                        </section>
                    </div>

                    <section class="charts-grid">
                        <div class="card">
                            <h3>Error Rate Trend (Last 30 Days)</h3>
                            <div class="chart-container">
                                <canvas id="errorTrendChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <h3>Errors by Department</h3>
                            <div class="chart-container">
                                <canvas id="departmentErrorsChart"></canvas>
                            </div>
                        </div>
                    </section>
                </div>

                <div id="reports" class="tab-content">
                    <div class="card">
                        <h3>Advanced Reports & Analytics</h3>
                        <div class="filter-panel">
                            <div class="filter-group">
                                <label>Report Type</label>
                                <select id="report-type">
                                    <option value="performance">Performance Report</option>
                                    <option value="quality">Quality Metrics</option>
                                    <option value="department">Department Analysis</option>
                                    <option value="agent">Agent Performance</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Time Period</label>
                                <select id="report-period">
                                    <option value="week">Last Week</option>
                                    <option value="month">Last Month</option>
                                    <option value="quarter">Last Quarter</option>
                                    <option value="year">Last Year</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Format</label>
                                <select id="report-format">
                                    <option value="pdf">PDF</option>
                                    <option value="excel">Excel</option>
                                    <option value="csv">CSV</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="generate-report-btn">Generate Report</button>
                        </div>
                        <div class="placeholder-content">
                            <h3>Report Generation</h3>
                            <p>Select your report parameters and click "Generate Report" to create a detailed analysis.</p>
                        </div>
                    </div>
                </div>

                <div id="teams" class="tab-content">
                    <div class="card">
                        <h3>Team Management</h3>
                        <div class="filter-panel">
                            <div class="filter-group">
                                <label>Team</label>
                                <select id="team-select">
                                    <option value="team_a">Team A</option>
                                    <option value="team_b">Team B</option>
                                    <option value="team_c">Team C</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="view-team-btn">View Team</button>
                            <button class="btn btn-secondary" id="add-team-btn">Add New Team</button>
                        </div>
                        <div class="placeholder-content">
                            <h3>Team Performance Overview</h3>
                            <p>Select a team to view detailed performance metrics and member information.</p>
                        </div>
                    </div>
                </div>

                <div id="team-scheduling" class="tab-content">
                    <div class="card">
                        <h3>Team Scheduling</h3>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div style="display: flex; gap: 10px;">
                                <button class="btn btn-primary" id="edit-schedule-btn">Edit Schedule</button>
                                <div id="schedule-edit-controls">
                                    <button class="btn btn-secondary" id="save-schedule-btn">Save Changes</button>
                                    <button class="btn btn-danger" id="cancel-schedule-btn">Cancel</button>
                                </div>
                            </div>
                            <button class="btn btn-secondary" id="add-member-btn">Add Member</button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="schedule-table">
                                <thead>
                                    <tr>
                                        <th>Member</th>
                                        <th>Monday</th>
                                        <th>Tuesday</th>
                                        <th>Wednesday</th>
                                        <th>Thursday</th>
                                        <th>Friday</th>
                                        <th>Saturday</th>
                                        <th>Sunday</th>
                                    </tr>
                                </thead>
                                <tbody id="schedule-table-body">
                                    <!-- Schedule data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="company-employees" class="tab-content">
                    <div class="card">
                        <h3>Company Employees</h3>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div class="search-input-container">
                                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                <input type="text" 
                                       placeholder="Search employees..." 
                                       class="anti-autofill"
                                       id="employee-search"
                                       name="search_employee">
                            </div>
                            <button class="btn btn-primary" id="add-employee-btn">Add New Employee</button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="user-management-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Position</th>
                                        <th>Department</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="employees-table-body">
                                    <!-- Employee data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="departments" class="tab-content">
                    <div class="card">
                        <h3>Departments</h3>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div class="search-input-container">
                                <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                                <input type="text" 
                                       placeholder="Search departments..." 
                                       class="anti-autofill"
                                       id="department-search"
                                       name="search_department">
                            </div>
                            <button class="btn btn-primary" id="add-department-btn">Add New Department</button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="user-management-table">
                                <thead>
                                    <tr>
                                        <th>Department Name</th>
                                        <th>Manager</th>
                                        <th>Team Count</th>
                                        <th>Employee Count</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="departments-table-body">
                                    <!-- Department data will be populated here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="payments" class="tab-content">
                    <div class="card">
                        <h3>Payments & Compensation</h3>
                        <div class="filter-panel">
                            <div class="filter-group">
                                <label>Payment Period</label>
                                <select id="payment-period">
                                    <option value="current">Current Month</option>
                                    <option value="previous">Previous Month</option>
                                    <option value="quarter">Current Quarter</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Department</label>
                                <select id="payment-department">
                                    <option value="all">All</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="view-payments-btn">View Payments</button>
                            <button class="btn btn-secondary" id="export-payments-btn">Export Payment Report</button>
                        </div>
                        <div class="placeholder-content">
                            <h3>Payment Management</h3>
                            <p>Select parameters to view payment details and compensation reports for your teams.</p>
                        </div>
                    </div>
                </div>

                <div id="kpis" class="tab-content">
                    <div class="card">
                        <h3>Key Performance Indicators</h3>
                        <div class="filter-panel">
                            <div class="filter-group">
                                <label>KPI Category</label>
                                <select id="kpi-category">
                                    <option value="quality">Quality Metrics</option>
                                    <option value="efficiency">Efficiency Metrics</option>
                                    <option value="compliance">Compliance Metrics</option>
                                    <option value="customer">Customer Satisfaction</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Time Frame</label>
                                <select id="kpi-timeframe">
                                    <option value="week">Weekly</option>
                                    <option value="month">Monthly</option>
                                    <option value="quarter">Quarterly</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="view-kpis-btn">View KPIs</button>
                        </div>
                        <div class="placeholder-content">
                            <h3>KPI Dashboard</h3>
                            <p>Select a category and time frame to view detailed performance indicators.</p>
                        </div>
                    </div>
                </div>

                <div id="profile" class="tab-content">
                    <div class="card">
                        <h3>User Profile</h3>
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" id="profile-name" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" id="profile-email" placeholder="Enter your email address">
                        </div>
                        <div class="form-group">
                            <label>Position</label>
                            <input type="text" id="profile-position" placeholder="Enter your position">
                        </div>
                        <div class="form-group">
                            <label>Department</label>
                            <input type="text" id="profile-department" placeholder="Enter your department">
                        </div>
                        <div class="page-actions">
                            <button class="btn btn-primary" id="save-profile-btn">Save Changes</button>
                            <button class="btn btn-secondary" id="cancel-profile-btn">Cancel</button>
                        </div>
                    </div>
                </div>

                <div id="settings" class="tab-content">
                    <div class="settings-layout">
                        <div class="settings-nav">
                            <ul>
                                <li><a class="settings-nav-item active" data-section="general">General Settings</a></li>
                                <li><a class="settings-nav-item" data-section="notifications">Notifications</a></li>
                                <li><a class="settings-nav-item" data-section="privacy">Privacy & Security</a></li>
                                <li><a class="settings-nav-item" data-section="integrations">Integrations</a></li>
                            </ul>
                        </div>
                        <div class="settings-content">
                            <div id="general" class="settings-section active">
                                <div class="setting-card">
                                    <h4>Language & Region</h4>
                                    <p>Set your preferred language and regional settings.</p>
                                    <div class="form-group">
                                        <label>Language</label>
                                        <select id="language-select">
                                            <option value="en">English</option>
                                            <option value="es">Spanish</option>
                                            <option value="fr">French</option>
                                            <option value="de">German</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Time Zone</label>
                                        <select id="timezone-select">
                                            <option value="utc-8">Pacific Time (UTC-8)</option>
                                            <option value="utc-5">Eastern Time (UTC-5)</option>
                                            <option value="utc">UTC</option>
                                            <option value="utc+1">Central European Time (UTC+1)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="setting-card">
                                    <h4>Display Preferences</h4>
                                    <p>Customize how the dashboard appears.</p>
                                    <div class="form-group">
                                        <label>Theme</label>
                                        <select id="theme-select">
                                            <option value="dark">Dark</option>
                                            <option value="light">Light</option>
                                            <option value="auto">Auto (System)</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Default Dashboard View</label>
                                        <select id="dashboard-view-select">
                                            <option value="overview">Overview</option>
                                            <option value="detailed">Detailed</option>
                                            <option value="minimal">Minimal</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div id="notifications" class="settings-section">
                                <div class="setting-card">
                                    <h4>Notification Preferences</h4>
                                    <p>Choose how and when you want to be notified.</p>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="email-notifications" checked>
                                            Email Notifications
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="push-notifications" checked>
                                            Push Notifications
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="sms-notifications">
                                            SMS Notifications
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div id="privacy" class="settings-section">
                                <div class="setting-card">
                                    <h4>Privacy Settings</h4>
                                    <p>Control your data and privacy preferences.</p>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="data-collection" checked>
                                            Allow data collection for analytics
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="personalized-ads">
                                            Allow personalized content and ads
                                        </label>
                                    </div>
                                </div>
                                <div class="setting-card">
                                    <h4>Security</h4>
                                    <p>Manage your account security settings.</p>
                                    <div class="form-group">
                                        <label>Two-Factor Authentication</label>
                                        <select id="2fa-select">
                                            <option value="disabled">Disabled</option>
                                            <option value="enabled">Enabled</option>
                                        </select>
                                    </div>
                                    <button class="btn btn-primary" id="change-password-btn">Change Password</button>
                                </div>
                            </div>
                            <div id="integrations" class="settings-section">
                                <div class="setting-card">
                                    <h4>Third-Party Integrations</h4>
                                    <p>Connect with other tools and services.</p>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="slack-integration">
                                            Slack Integration
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="google-integration">
                                            Google Workspace Integration
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="jira-integration">
                                            Jira Integration
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="help" class="tab-content">
                    <div class="card">
                        <h3>Help & Support</h3>
                        <div class="placeholder-content">
                            <h3>Get Help</h3>
                            <p>If you need assistance with the QualityX dashboard, please contact our support team.</p>
                            <p>Email: support@qualityx.com | Phone: +1 (555) 123-4567</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modals -->
    <div class="modal-overlay" id="add-employee-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Add New Employee</h3>
                <button class="modal-close-btn" data-modal="add-employee-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="new-employee-name" placeholder="Enter employee name">
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="new-employee-email" placeholder="Enter employee email">
                </div>
                <div class="form-group">
                    <label>Position</label>
                    <input type="text" id="new-employee-position" placeholder="Enter employee position">
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <select id="new-employee-department">
                        <option value="quality">Quality Assurance</option>
                        <option value="customer">Customer Service</option>
                        <option value="operations">Operations</option>
                        <option value="management">Management</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="add-employee-modal">Cancel</button>
                <button class="btn btn-primary" id="save-new-employee-btn">Save Employee</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="edit-department-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Edit Department</h3>
                <button class="modal-close-btn" data-modal="edit-department-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Department Name</label>
                    <input type="text" id="edit-department-name" placeholder="Enter department name">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="edit-department-modal">Cancel</button>
                <button class="btn btn-primary" id="save-department-btn">Save Changes</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="shift-edit-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Edit Shift</h3>
                <button class="modal-close-btn" data-modal="shift-edit-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Shift Type</label>
                    <select id="shift-type-select">
                        <option value="09:00-17:00">09:00-17:00</option>
                        <option value="11:00-19:00">11:00-19:00</option>
                        <option value="on-leave">On Leave</option>
                        <option value="sick">Sick</option>
                        <option value="off">Off</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="shift-edit-modal">Cancel</button>
                <button class="btn btn-primary" id="save-shift-btn">Save Shift</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="add-member-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Add New Team Member</h3>
                <button class="modal-close-btn" data-modal="add-member-modal">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="new-member-name" placeholder="Enter member name">
                </div>
                <div class="form-group">
                    <label>Position</label>
                    <input type="text" id="new-member-position" placeholder="Enter member position">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-modal="add-member-modal">Cancel</button>
                <button class="btn btn-primary" id="save-new-member-btn">Add Member</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // Global variables
        let currentUser = null;
        let scheduleData = {};
        let originalScheduleData = {};
        let employeesData = [];
        let departmentsData = [];
        let isEditMode = false;
        let currentEditingCell = null;

        // DOM Elements
        const tabLinks = document.querySelectorAll('.sidebar-nav a[data-tab]');
        const tabContents = document.querySelectorAll('.tab-content');
        const notificationBtn = document.getElementById('notification-btn');
        const notificationDropdown = document.getElementById('notification-dropdown');
        const modalCloseBtns = document.querySelectorAll('.modal-close-btn, .btn-secondary[data-modal]');
        const modalOverlays = document.querySelectorAll('.modal-overlay');
        const addEmployeeBtn = document.getElementById('add-employee-btn');
        const addEmployeeModal = document.getElementById('add-employee-modal');
        const saveNewEmployeeBtn = document.getElementById('save-new-employee-btn');
        const editDepartmentModal = document.getElementById('edit-department-modal');
        const saveDepartmentBtn = document.getElementById('save-department-btn');
        const editScheduleBtn = document.getElementById('edit-schedule-btn');
        const scheduleEditControls = document.getElementById('schedule-edit-controls');
        const saveScheduleBtn = document.getElementById('save-schedule-btn');
        const cancelScheduleBtn = document.getElementById('cancel-schedule-btn');
        const scheduleTable = document.getElementById('schedule-table');
        const scheduleTableBody = document.getElementById('schedule-table-body');
        const shiftEditModal = document.getElementById('shift-edit-modal');
        const saveShiftBtn = document.getElementById('save-shift-btn');
        const addMemberBtn = document.getElementById('add-member-btn');
        const addMemberModal = document.getElementById('add-member-modal');
        const saveNewMemberBtn = document.getElementById('save-new-member-btn');

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadInitialData();
        });

        // Initialize the application
        function initializeApp() {
            // Set current user (in a real app, this would come from authentication)
            currentUser = {
                id: 1,
                name: "Nawaf Al-Otaibi",
                role: "Manager",
                email: "nawaf@qualityx.com",
                position: "Quality Manager",
                department: "Quality Assurance"
            };

            // Update UI with user data
            document.getElementById('sidebar-avatar-initials').textContent = getInitials(currentUser.name);
            document.getElementById('sidebar-username').textContent = currentUser.name;
            document.getElementById('sidebar-userrole').textContent = currentUser.role;
            document.getElementById('welcome-user-h2').textContent = `Welcome, ${currentUser.name}!`;
        }

        // Set up event listeners
        function setupEventListeners() {
            // Tab navigation
            tabLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const tabId = this.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });

            // Settings navigation
            const settingsNavItems = document.querySelectorAll('.settings-nav-item');
            settingsNavItems.forEach(item => {
                item.addEventListener('click', function() {
                    const sectionId = this.getAttribute('data-section');
                    switchSettingsSection(sectionId);
                });
            });

            // Notification dropdown
            notificationBtn.addEventListener('click', function() {
                notificationDropdown.classList.toggle('show');
            });

            // Close notification dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!notificationBtn.contains(e.target) && !notificationDropdown.contains(e.target)) {
                    notificationDropdown.classList.remove('show');
                }
            });

            // Modal functionality
            modalCloseBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const modalId = this.getAttribute('data-modal');
                    closeModal(modalId);
                });
            });

            modalOverlays.forEach(overlay => {
                overlay.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });

            // Add Employee functionality
            addEmployeeBtn.addEventListener('click', function() {
                openModal('add-employee-modal');
            });

            saveNewEmployeeBtn.addEventListener('click', function() {
                saveNewEmployee();
            });

            // Edit Department functionality
            saveDepartmentBtn.addEventListener('click', function() {
                saveDepartmentChanges();
            });

            // Schedule editing functionality
            editScheduleBtn.addEventListener('click', function() {
                enableEditMode();
            });

            saveScheduleBtn.addEventListener('click', function() {
                saveScheduleChanges();
            });

            cancelScheduleBtn.addEventListener('click', function() {
                cancelScheduleChanges();
            });

            // Shift editing functionality
            saveShiftBtn.addEventListener('click', function() {
                saveShiftChange();
            });

            // Add Member functionality
            addMemberBtn.addEventListener('click', function() {
                openModal('add-member-modal');
            });

            saveNewMemberBtn.addEventListener('click', function() {
                saveNewMember();
            });

            // Export report button
            document.getElementById('export-report-btn').addEventListener('click', function() {
                showToast('Report exported successfully!', 'success');
            });

            // Logout button
            document.getElementById('logout-btn').addEventListener('click', function() {
                if (confirm('Are you sure you want to logout?')) {
                    showToast('Logged out successfully', 'info');
                    // In a real app, this would redirect to login page
                }
            });

            // Apply filters button
            document.getElementById('apply-filters-btn').addEventListener('click', function() {
                applyFilters();
            });

            // Generate report button
            document.getElementById('generate-report-btn').addEventListener('click', function() {
                generateReport();
            });

            // Save profile button
            document.getElementById('save-profile-btn').addEventListener('click', function() {
                saveProfile();
            });

            // View payments button
            document.getElementById('view-payments-btn').addEventListener('click', function() {
                viewPayments();
            });

            // View KPIs button
            document.getElementById('view-kpis-btn').addEventListener('click', function() {
                viewKPIs();
            });
        }

        // Load initial data
        function loadInitialData() {
            // Load schedule data
            loadScheduleData();
            
            // Load employees data
            loadEmployeesData();
            
            // Load departments data
            loadDepartmentsData();
            
            // Load notifications
            loadNotifications();
            
            // Initialize charts
            initializeCharts();
        }

        // Switch between tabs
        function switchTab(tabId) {
            // Update active tab in sidebar
            tabLinks.forEach(link => {
                link.classList.remove('active');
            });
            document.querySelector(`.sidebar-nav a[data-tab="${tabId}"]`).classList.add('active');
            
            // Update active tab content
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabId).classList.add('active');
            
            // Update page title
            const pageTitle = document.getElementById('page-title-header');
            pageTitle.textContent = document.querySelector(`.sidebar-nav a[data-tab="${tabId}"]`).textContent.trim();
            
            // Close notification dropdown
            notificationDropdown.classList.remove('show');
        }

        // Switch between settings sections
        function switchSettingsSection(sectionId) {
            // Update active nav item
            document.querySelectorAll('.settings-nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.settings-nav-item[data-section="${sectionId}"]`).classList.add('active');
            
            // Update active section
            document.querySelectorAll('.settings-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
        }

        // Open modal
        function openModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        // Show toast notification
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type]}</div>
                <div class="toast-content">
                    <div class="toast-title">${type.charAt(0).toUpperCase() + type.slice(1)}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">×</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Add event listener to close button
            toast.querySelector('.toast-close').addEventListener('click', function() {
                toast.remove();
            });
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }

        // Get initials from name
        function getInitials(name) {
            return name.split(' ').map(part => part[0]).join('').toUpperCase();
        }

        // Load schedule data
        function loadScheduleData() {
            // In a real app, this would come from an API
            scheduleData = {
                "members": [
                    {
                        "id": 1,
                        "name": "Sarah Johnson",
                        "position": "Quality Analyst",
                        "schedule": {
                            "monday": "09:00-17:00",
                            "tuesday": "09:00-17:00",
                            "wednesday": "09:00-17:00",
                            "thursday": "09:00-17:00",
                            "friday": "09:00-17:00",
                            "saturday": "Off",
                            "sunday": "Off"
                        }
                    },
                    {
                        "id": 2,
                        "name": "Michael Chen",
                        "position": "Senior QA",
                        "schedule": {
                            "monday": "11:00-19:00",
                            "tuesday": "11:00-19:00",
                            "wednesday": "11:00-19:00",
                            "thursday": "11:00-19:00",
                            "friday": "11:00-19:00",
                            "saturday": "Off",
                            "sunday": "Off"
                        }
                    },
                    {
                        "id": 3,
                        "name": "Emma Rodriguez",
                        "position": "QA Specialist",
                        "schedule": {
                            "monday": "09:00-17:00",
                            "tuesday": "On Leave",
                            "wednesday": "09:00-17:00",
                            "thursday": "09:00-17:00",
                            "friday": "09:00-17:00",
                            "saturday": "Off",
                            "sunday": "Off"
                        }
                    },
                    {
                        "id": 4,
                        "name": "David Kim",
                        "position": "Quality Engineer",
                        "schedule": {
                            "monday": "Sick",
                            "tuesday": "11:00-19:00",
                            "wednesday": "11:00-19:00",
                            "thursday": "11:00-19:00",
                            "friday": "11:00-19:00",
                            "saturday": "Off",
                            "sunday": "Off"
                        }
                    }
                ]
            };
            
            // Store original data for cancel functionality
            originalScheduleData = JSON.parse(JSON.stringify(scheduleData));
            
            // Render schedule table
            renderScheduleTable();
        }

        // Render schedule table
        function renderScheduleTable() {
            if (!scheduleData.members || scheduleData.members.length === 0) {
                scheduleTableBody.innerHTML = '<tr><td colspan="8" class="empty-state">No team members found</td></tr>';
                return;
            }
            
            let tableHTML = '';
            
            scheduleData.members.forEach(member => {
                tableHTML += `
                    <tr data-member-id="${member.id}">
                        <td class="member-name">
                            <div><strong>${member.name}</strong></div>
                            <div style="font-size: 0.8rem; color: var(--text-muted);">${member.position}</div>
                        </td>
                        <td class="shift-cell" data-day="monday">${formatShiftDisplay(member.schedule.monday)}</td>
                        <td class="shift-cell" data-day="tuesday">${formatShiftDisplay(member.schedule.tuesday)}</td>
                        <td class="shift-cell" data-day="wednesday">${formatShiftDisplay(member.schedule.wednesday)}</td>
                        <td class="shift-cell" data-day="thursday">${formatShiftDisplay(member.schedule.thursday)}</td>
                        <td class="shift-cell" data-day="friday">${formatShiftDisplay(member.schedule.friday)}</td>
                        <td class="shift-cell" data-day="saturday">${formatShiftDisplay(member.schedule.saturday)}</td>
                        <td class="shift-cell" data-day="sunday">${formatShiftDisplay(member.schedule.sunday)}</td>
                    </tr>
                `;
            });
            
            scheduleTableBody.innerHTML = tableHTML;
            
            // Add event listeners to shift cells if in edit mode
            if (isEditMode) {
                addShiftCellEventListeners();
            }
        }

        // Format shift display with appropriate styling
        function formatShiftDisplay(shift) {
            if (shift === 'On Leave') {
                return `<span class="on-leave">${shift}</span>`;
            } else if (shift === 'Sick') {
                return `<span class="sick-leave">${shift}</span>`;
            } else if (shift === 'Off') {
                return `<span class="off">${shift}</span>`;
            } else {
                return shift;
            }
        }

        // Enable edit mode for schedule
        function enableEditMode() {
            isEditMode = true;
            editScheduleBtn.style.display = 'none';
            scheduleEditControls.style.display = 'flex';
            scheduleTable.classList.add('edit-mode');
            
            // Add event listeners to shift cells
            addShiftCellEventListeners();
            
            showToast('Edit mode enabled. Click on any shift to modify it.', 'info');
        }

        // Disable edit mode for schedule
        function disableEditMode() {
            isEditMode = false;
            editScheduleBtn.style.display = 'inline-flex';
            scheduleEditControls.style.display = 'none';
            scheduleTable.classList.remove('edit-mode');
            
            // Remove event listeners from shift cells
            removeShiftCellEventListeners();
        }

        // Add event listeners to shift cells
        function addShiftCellEventListeners() {
            const shiftCells = document.querySelectorAll('#schedule-table.edit-mode td.shift-cell');
            shiftCells.forEach(cell => {
                cell.addEventListener('click', handleShiftCellClick);
            });
        }

        // Remove event listeners from shift cells
        function removeShiftCellEventListeners() {
            const shiftCells = document.querySelectorAll('#schedule-table.edit-mode td.shift-cell');
            shiftCells.forEach(cell => {
                cell.removeEventListener('click', handleShiftCellClick);
            });
        }

        // Handle shift cell click
        function handleShiftCellClick(e) {
            if (!isEditMode) return;
            
            const cell = e.currentTarget;
            const memberId = cell.closest('tr').getAttribute('data-member-id');
            const day = cell.getAttribute('data-day');
            const currentShift = cell.textContent;
            
            // Store reference to the cell being edited
            currentEditingCell = {
                cell: cell,
                memberId: parseInt(memberId),
                day: day
            };
            
            // Set current value in modal
            const shiftTypeSelect = document.getElementById('shift-type-select');
            const options = Array.from(shiftTypeSelect.options);
            const matchingOption = options.find(option => option.text === currentShift);
            
            if (matchingOption) {
                shiftTypeSelect.value = matchingOption.value;
            } else {
                // Handle special cases (On Leave, Sick, Off)
                if (currentShift === 'On Leave') {
                    shiftTypeSelect.value = 'on-leave';
                } else if (currentShift === 'Sick') {
                    shiftTypeSelect.value = 'sick';
                } else if (currentShift === 'Off') {
                    shiftTypeSelect.value = 'off';
                } else {
                    shiftTypeSelect.value = '09:00-17:00';
                }
            }
            
            // Open the shift edit modal
            openModal('shift-edit-modal');
        }

        // Save shift change
        function saveShiftChange() {
            if (!currentEditingCell) return;
            
            const shiftTypeSelect = document.getElementById('shift-type-select');
            const selectedValue = shiftTypeSelect.value;
            let displayValue = '';
            
            // Map the selected value to display text
            switch(selectedValue) {
                case '09:00-17:00':
                    displayValue = '09:00-17:00';
                    break;
                case '11:00-19:00':
                    displayValue = '11:00-19:00';
                    break;
                case 'on-leave':
                    displayValue = 'On Leave';
                    break;
                case 'sick':
                    displayValue = 'Sick';
                    break;
                case 'off':
                    displayValue = 'Off';
                    break;
                default:
                    displayValue = '09:00-17:00';
            }
            
            // Update the cell content
            currentEditingCell.cell.innerHTML = formatShiftDisplay(displayValue);
            
            // Update the data model
            const member = scheduleData.members.find(m => m.id === currentEditingCell.memberId);
            if (member) {
                member.schedule[currentEditingCell.day] = displayValue;
            }
            
            // Close the modal
            closeModal('shift-edit-modal');
            currentEditingCell = null;
            
            showToast('Shift updated successfully', 'success');
        }

        // Save schedule changes
        function saveScheduleChanges() {
            // In a real app, this would send the updated schedule to the server
            originalScheduleData = JSON.parse(JSON.stringify(scheduleData));
            
            disableEditMode();
            showToast('Schedule changes saved successfully', 'success');
        }

        // Cancel schedule changes
        function cancelScheduleChanges() {
            // Restore original data
            scheduleData = JSON.parse(JSON.stringify(originalScheduleData));
            
            // Re-render the table
            renderScheduleTable();
            
            disableEditMode();
            showToast('Changes discarded', 'info');
        }

        // Load employees data
        function loadEmployeesData() {
            // In a real app, this would come from an API
            employeesData = [
                {
                    id: 1,
                    name: "Sarah Johnson",
                    email: "sarah.j@qualityx.com",
                    position: "Quality Analyst",
                    department: "Quality Assurance",
                    status: "Active"
                },
                {
                    id: 2,
                    name: "Michael Chen",
                    email: "michael.c@qualityx.com",
                    position: "Senior QA",
                    department: "Quality Assurance",
                    status: "Active"
                },
                {
                    id: 3,
                    name: "Emma Rodriguez",
                    email: "emma.r@qualityx.com",
                    position: "QA Specialist",
                    department: "Quality Assurance",
                    status: "Active"
                },
                {
                    id: 4,
                    name: "David Kim",
                    email: "david.k@qualityx.com",
                    position: "Quality Engineer",
                    department: "Quality Assurance",
                    status: "Active"
                },
                {
                    id: 5,
                    name: "Lisa Thompson",
                    email: "lisa.t@qualityx.com",
                    position: "Customer Service Rep",
                    department: "Customer Service",
                    status: "Active"
                }
            ];
            
            renderEmployeesTable();
        }

        // Render employees table
        function renderEmployeesTable() {
            const tableBody = document.getElementById('employees-table-body');
            
            if (!employeesData || employeesData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="6" class="empty-state">No employees found</td></tr>';
                return;
            }
            
            let tableHTML = '';
            
            employeesData.forEach(employee => {
                tableHTML += `
                    <tr data-employee-id="${employee.id}">
                        <td>${employee.name}</td>
                        <td>${employee.email}</td>
                        <td>${employee.position}</td>
                        <td>${employee.department}</td>
                        <td><span class="status-badge status-active">${employee.status}</span></td>
                        <td>
                            <button class="action-btn edit-user-btn">Edit</button>
                            <button class="action-btn danger">Deactivate</button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            
            // Add event listeners to edit buttons
            const editButtons = document.querySelectorAll('.edit-user-btn');
            editButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const employeeId = this.closest('tr').getAttribute('data-employee-id');
                    editEmployee(parseInt(employeeId));
                });
            });
        }

        // Load departments data
        function loadDepartmentsData() {
            // In a real app, this would come from an API
            departmentsData = [
                {
                    id: 1,
                    name: "Quality Assurance",
                    manager: "Nawaf Al-Otaibi",
                    teamCount: 3,
                    employeeCount: 12
                },
                {
                    id: 2,
                    name: "Customer Service",
                    manager: "Lisa Thompson",
                    teamCount: 2,
                    employeeCount: 8
                },
                {
                    id: 3,
                    name: "Operations",
                    manager: "Robert Wilson",
                    teamCount: 2,
                    employeeCount: 10
                }
            ];
            
            renderDepartmentsTable();
        }

        // Render departments table
        function renderDepartmentsTable() {
            const tableBody = document.getElementById('departments-table-body');
            
            if (!departmentsData || departmentsData.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="empty-state">No departments found</td></tr>';
                return;
            }
            
            let tableHTML = '';
            
            departmentsData.forEach(department => {
                tableHTML += `
                    <tr data-department-id="${department.id}">
                        <td>${department.name}</td>
                        <td>${department.manager}</td>
                        <td>${department.teamCount}</td>
                        <td>${department.employeeCount}</td>
                        <td>
                            <button class="action-btn edit-user-btn">Edit</button>
                            <button class="action-btn primary">View Teams</button>
                        </td>
                    </tr>
                `;
            });
            
            tableBody.innerHTML = tableHTML;
            
            // Add event listeners to edit buttons
            const editButtons = document.querySelectorAll('.edit-user-btn');
            editButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const departmentId = this.closest('tr').getAttribute('data-department-id');
                    editDepartment(parseInt(departmentId));
                });
            });
        }

        // Edit department
        function editDepartment(departmentId) {
            const department = departmentsData.find(d => d.id === departmentId);
            if (!department) return;
            
            document.getElementById('edit-department-name').value = department.name;
            openModal('edit-department-modal');
            
            // Store the department ID for saving
            document.getElementById('save-department-btn').setAttribute('data-department-id', departmentId);
        }

        // Save department changes
        function saveDepartmentChanges() {
            const departmentId = parseInt(document.getElementById('save-department-btn').getAttribute('data-department-id'));
            const newName = document.getElementById('edit-department-name').value.trim();
            
            if (!newName) {
                showToast('Please enter a department name', 'error');
                return;
            }
            
            // Update the department in the data model
            const department = departmentsData.find(d => d.id === departmentId);
            if (department) {
                department.name = newName;
            }
            
            // Re-render the table
            renderDepartmentsTable();
            
            closeModal('edit-department-modal');
            showToast('Department updated successfully', 'success');
        }

        // Save new employee
        function saveNewEmployee() {
            const name = document.getElementById('new-employee-name').value.trim();
            const email = document.getElementById('new-employee-email').value.trim();
            const position = document.getElementById('new-employee-position').value.trim();
            const department = document.getElementById('new-employee-department').value;
            
            if (!name || !email || !position) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Create new employee object
            const newEmployee = {
                id: employeesData.length > 0 ? Math.max(...employeesData.map(e => e.id)) + 1 : 1,
                name: name,
                email: email,
                position: position,
                department: department === 'quality' ? 'Quality Assurance' : 
                           department === 'customer' ? 'Customer Service' :
                           department === 'operations' ? 'Operations' : 'Management',
                status: "Active"
            };
            
            // Add to employees data
            employeesData.push(newEmployee);
            
            // Re-render employees table
            renderEmployeesTable();
            
            // Reset form
            document.getElementById('new-employee-name').value = '';
            document.getElementById('new-employee-email').value = '';
            document.getElementById('new-employee-position').value = '';
            document.getElementById('new-employee-department').value = 'quality';
            
            closeModal('add-employee-modal');
            showToast('Employee added successfully', 'success');
        }

        // Save new member
        function saveNewMember() {
            const name = document.getElementById('new-member-name').value.trim();
            const position = document.getElementById('new-member-position').value.trim();
            
            if (!name || !position) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Create new member object
            const newMember = {
                id: scheduleData.members.length > 0 ? Math.max(...scheduleData.members.map(m => m.id)) + 1 : 1,
                name: name,
                position: position,
                schedule: {
                    monday: "09:00-17:00",
                    tuesday: "09:00-17:00",
                    wednesday: "09:00-17:00",
                    thursday: "09:00-17:00",
                    friday: "09:00-17:00",
                    saturday: "Off",
                    sunday: "Off"
                }
            };
            
            // Add to schedule data
            scheduleData.members.push(newMember);
            
            // Also add to employees data
            const newEmployee = {
                id: employeesData.length > 0 ? Math.max(...employeesData.map(e => e.id)) + 1 : 1,
                name: name,
                email: `${name.toLowerCase().replace(' ', '.')}@qualityx.com`,
                position: position,
                department: "Quality Assurance",
                status: "Active"
            };
            
            employeesData.push(newEmployee);
            
            // Re-render both tables
            renderScheduleTable();
            renderEmployeesTable();
            
            // Reset form
            document.getElementById('new-member-name').value = '';
            document.getElementById('new-member-position').value = '';
            
            closeModal('add-member-modal');
            showToast('Team member added successfully', 'success');
        }

        // Edit employee (placeholder function)
        function editEmployee(employeeId) {
            // In a real app, this would open an edit modal
            showToast('Employee editing functionality will be implemented in the next phase', 'info');
        }

        // Load notifications
        function loadNotifications() {
            // In a real app, this would come from an API
            const notifications = [
                { id: 1, message: "New quality report available for review", time: "10 minutes ago" },
                { id: 2, message: "Team A has exceeded their weekly targets", time: "2 hours ago" },
                { id: 3, message: "System maintenance scheduled for Saturday", time: "1 day ago" }
            ];
            
            const notificationList = document.getElementById('notification-list');
            let listHTML = '';
            
            notifications.forEach(notification => {
                listHTML += `
                    <li class="notification-item">
                        <div>${notification.message}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-top: 5px;">${notification.time}</div>
                    </li>
                `;
            });
            
            notificationList.innerHTML = listHTML;
        }

        // Initialize charts
        function initializeCharts() {
            // Error Trend Chart
            const errorTrendCtx = document.getElementById('errorTrendChart').getContext('2d');
            const errorTrendChart = new Chart(errorTrendCtx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7', 'Day 8', 'Day 9', 'Day 10', 
                            'Day 11', 'Day 12', 'Day 13', 'Day 14', 'Day 15', 'Day 16', 'Day 17', 'Day 18', 'Day 19', 'Day 20',
                            'Day 21', 'Day 22', 'Day 23', 'Day 24', 'Day 25', 'Day 26', 'Day 27', 'Day 28', 'Day 29', 'Day 30'],
                    datasets: [{
                        label: 'Error Rate (%)',
                        data: [5.2, 4.8, 5.1, 4.9, 4.7, 4.5, 4.3, 4.6, 4.4, 4.2, 
                               4.1, 4.0, 3.9, 3.8, 3.7, 3.6, 3.5, 3.4, 3.3, 3.2,
                               3.1, 3.0, 2.9, 2.8, 2.7, 2.6, 2.5, 2.4, 2.3, 2.2],
                        borderColor: '#00bfff',
                        backgroundColor: 'rgba(0, 191, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#8b949e'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#8b949e',
                                maxTicksLimit: 10
                            }
                        }
                    }
                }
            });
            
            // Department Errors Chart
            const departmentErrorsCtx = document.getElementById('departmentErrorsChart').getContext('2d');
            const departmentErrorsChart = new Chart(departmentErrorsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Quality Assurance', 'Customer Service', 'Operations', 'Management'],
                    datasets: [{
                        data: [45, 30, 20, 5],
                        backgroundColor: [
                            '#00bfff',
                            '#28a745',
                            '#ffc107',
                            '#6f42c1'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#8b949e',
                                padding: 20
                            }
                        }
                    }
                }
            });
            
            // Update dashboard stats
            updateDashboardStats();
        }

        // Update dashboard stats
        function updateDashboardStats() {
            document.getElementById('total-orders').textContent = '12,458';
            document.getElementById('error-rate').textContent = '2.2%';
            document.getElementById('top-team').textContent = 'Team A';
            document.getElementById('active-agents').textContent = '24';
            
            document.getElementById('orders-change').innerHTML = '<span>⬆️</span> +12% from last week';
            document.getElementById('error-rate-change').innerHTML = '<span>⬇️</span> -8% from last week';
            document.getElementById('top-team-rate').innerHTML = '<span>⭐</span> 98.7% accuracy';
            document.getElementById('agents-change').innerHTML = '<span>➕</span> +2 from last month';
        }

        // Apply filters (placeholder function)
        function applyFilters() {
            showToast('Filters applied successfully', 'success');
        }

        // Generate report (placeholder function)
        function generateReport() {
            showToast('Report generation started. You will be notified when it is ready.', 'info');
        }

        // Save profile (placeholder function)
        function saveProfile() {
            showToast('Profile updated successfully', 'success');
        }

        // View payments (placeholder function)
        function viewPayments() {
            showToast('Payment details loaded', 'info');
        }

        // View KPIs (placeholder function)
        function viewKPIs() {
            showToast('KPI data loaded', 'info');
        }

        // Fix for console errors related to asynchronous operations
        // This addresses the "message channel closed before a response was received" errors
        window.addEventListener('message', function(event) {
            // Only handle messages from the same origin
            if (event.origin !== window.location.origin) return;
            
            // Handle specific message types if needed
            // This prevents the "listener indicated an asynchronous response" error
            if (event.data && event.data.type === 'ASYNC_RESPONSE_REQUIRED') {
                // Send a response to indicate the message was handled
                event.source.postMessage({
                    type: 'ASYNC_RESPONSE',
                    id: event.data.id,
                    success: true
                }, event.origin);
            }
        });

        // Fix for sidebar menu item wrapping
        // Adjust the CSS for the "Company Employees" menu item
        document.addEventListener('DOMContentLoaded', function() {
            const companyEmployeesLink = document.querySelector('.sidebar-nav a[data-tab="company-employees"]');
            if (companyEmployeesLink) {
                // Ensure the text doesn't wrap
                companyEmployeesLink.style.whiteSpace = 'nowrap';
                companyEmployeesLink.style.overflow = 'hidden';
                companyEmployeesLink.style.textOverflow = 'ellipsis';
            }
        });
    </script>
</body>
</html>
