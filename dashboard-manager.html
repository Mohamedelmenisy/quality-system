<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard - QualityX</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%2300bfff'/%3E%3Ctext x='50' y='55' font-family='Poppins, sans-serif' font-size='60' font-weight='bold' fill='white' text-anchor='middle' dominant-baseline='middle'%3EQ%3C/text%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module">
        import { 
            supabase, 
            getCurrentUser,
            getUserById,
            getPerformanceMetrics,
            getErrorTrends,
            getDepartmentPerformance,
            getTeamMembers,
            updateUserProfile,
            getTeamSchedule,
            updateTeamSchedule,
            getNotifications,
            markNotificationAsRead,
            subscribeToNotifications,
            getCompanyEmployees,
            getDepartments
        } from './api-client.js';
        
        window.supabase = supabase;
        window.getCurrentUser = getCurrentUser;
        window.getUserById = getUserById;
        window.getPerformanceMetrics = getPerformanceMetrics;
        window.getErrorTrends = getErrorTrends;
        window.getDepartmentPerformance = getDepartmentPerformance;
        window.getTeamMembers = getTeamMembers;
        window.updateUserProfile = updateUserProfile;
        window.getTeamSchedule = getTeamSchedule;
        window.updateTeamSchedule = updateTeamSchedule;
        window.getNotifications = getNotifications;
        window.markNotificationAsRead = markNotificationAsRead;
        window.getCompanyEmployees = getCompanyEmployees;
        window.getDepartments = getDepartments;
    </script>
    <style>
        :root {
            --primary-color: #00bfff;
            --primary-hover: #00a4d9;
            --bg-color: #121212;
            --sidebar-bg: #1a1a1a;
            --card-bg: #1a1a1a;
            --text-color: #e6edf3;
            --text-muted: #8b949e;
            --border-color: #333;
            --red: #dc3545;
            --red-bg: rgba(220, 53, 69, 0.1);
            --green: #28a745;
            --green-bg: rgba(40, 167, 69, 0.1);
            --yellow: #ffc107;
            --yellow-bg: rgba(255, 193, 7, 0.1);
            --purple: #6f42c1;
            --purple-bg: rgba(111, 66, 193, 0.1);
            --border-radius-base: 0.75rem;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-color); color: var(--text-color); display: flex; flex-direction: column; min-height: 100vh; }
        .sidebar { width: 260px; background-color: var(--sidebar-bg); height: 100vh; position: fixed; left: 0; top: 0; border-right:1px solid var(--border-color); display: flex; flex-direction: column; z-index: 1000; }
        .sidebar-header { display: flex; align-items: center; gap: 10px; padding: 20px; border-bottom: 1px solid var(--border-color); }
        .sidebar-logo { height: 32px; fill: var(--primary-color); }
        .sidebar-title { font-size: 1.25rem; color: var(--primary-color); font-weight: 700; }
        .sidebar-nav-container { flex-grow: 1; overflow-y: auto; padding-top: 1rem; }
        .nav-group { margin-bottom: 1.5rem; padding: 0 20px; }
        .nav-group-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 600; margin-bottom: 0.75rem; }
        .sidebar-nav { list-style:none; padding:0; margin:0; }
        .sidebar-nav a { display: flex; align-items: center; padding: 12px 15px; border-radius: 8px; color: var(--text-muted); text-decoration: none; margin-bottom: 10px; transition: all 0.3s ease; gap: 15px; cursor:pointer; white-space: nowrap; }
        .sidebar-nav a:hover, .sidebar-nav a.active { background-color: var(--primary-color); color: #000; }
        .sidebar-footer { padding: 15px 20px; border-top: 1px solid var(--border-color); }
        .user-profile-widget { display: flex; align-items: center; gap: 12px; }
        .avatar-initials { width: 44px; height: 44px; border-radius: 50%; background-color: var(--primary-color); color: black; font-weight: 700; font-size: 1rem; display: inline-flex; align-items: center; justify-content: center; }
        .user-name { font-weight: 600; font-size: 1rem; }
        .user-role { font-size: 0.8rem; color: var(--text-muted); }
        .user-status { font-size: 0.75rem; color: var(--green); margin-top: 2px; }
        .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 30px; flex: 1; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 1rem; }
        .header-left { flex-grow: 1; }
        .header-actions { display: flex; align-items: center; gap: 1rem; }
        .page-title { font-size: 24px; font-weight: 700; }
        #welcome-message { margin-bottom: 2rem; }
        #welcome-message h2 { font-size: 1.75rem; font-weight: 700; }
        #welcome-message p { color: var(--text-muted); }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--card-bg); padding: 25px; border-radius: var(--border-radius-base); border: 1px solid var(--border-color); }
        .card h3 { font-size: 18px; font-weight: 600; margin-bottom: 20px; }
        .stat-card .stat-header { display: flex; justify-content: space-between; align-items: center; color: var(--text-muted); }
        .stat-card .stat-value { font-size: 32px; font-weight: 600; margin: 10px 0; }
        .stat-card .stat-change { display: flex; align-items: center; font-weight: 500; font-size: 14px; gap: 5px; }
        .stat-card .stat-change.positive { color: var(--green); }
        .stat-card .stat-change.negative { color: var(--red); }
        .charts-grid { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px; align-items: start; }
        .chart-container { position: relative; height: 350px; }
        .filter-container { display: flex; justify-content: center; width: 100%; margin-bottom: 30px; }
        .filter-panel { display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; background: var(--card-bg); padding: 20px; border-radius: var(--border-radius-base); border: 1px solid var(--border-color); width: 100%; max-width: 1200px; }
        .filter-group { flex: 1; min-width: 200px; }
        .filter-group label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 14px; }
        .filter-group input, .filter-group select { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; font-family: 'Poppins'; background: #2c2c2c; color:#fff; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; display: inline-flex; align-items: center; justify-content: center; gap: 8px; transition: background-color 0.2s; }
        .btn-primary { background: var(--primary-color); color: #000; }
        .btn-primary:hover { background: var(--primary-hover); }
        .btn-secondary { background-color: var(--green); color: white; }
        .btn-secondary:hover { background-color: #218838; }
        .btn-danger { background-color: var(--red); color: white; }
        .btn-danger:hover { background-color: #c82333; }
        .placeholder-content { padding: 40px; text-align: center; color: var(--text-muted); border: 2px dashed var(--border-color); border-radius: var(--border-radius-base); }
        .placeholder-content h3 { color: var(--text-color); margin-bottom: 10px; }
        .search-input-container { position: relative; }
        .search-input-container .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }
        .search-input-container input[type="search"] { background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 10px 12px 10px 38px; width: 300px; }
        
        /* حل مشكلة الـ autocomplete */
        .search-input-container input.anti-autofill {
            background: #2c2c2c !important;
            border: 1px solid var(--border-color) !important;
            border-radius: 8px !important;
            color: var(--text-color) !important;
            padding: 10px 12px 10px 38px !important;
            width: 300px !important;
            -webkit-text-fill-color: var(--text-color) !important;
            -webkit-box-shadow: 0 0 0px 1000px #2c2c2c inset !important;
            transition: background-color 5000s ease-in-out 0s !important;
        }
        
        .notification-bell { position: relative; }
        .notification-btn { background: none; border: none; color: var(--text-muted); font-size: 24px; cursor: pointer; padding: 5px; }
        .notification-dropdown { display: none; position: absolute; right: 0; top: 120%; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-base); width: 320px; box-shadow: 0 8px 16px rgba(0,0,0,0.3); z-index: 10; }
        .notification-dropdown.show { display: block; }
        .notification-header { padding: 1rem; border-bottom: 1px solid var(--border-color); font-weight: 600; }
        .notification-list { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; }
        .notification-item { padding: 1rem; border-bottom: 1px solid var(--border-color); font-size: 14px; }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; color: var(--text-muted); }
        .form-group input, .form-group select { width: 100%; background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 10px 12px; }
        .page-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem; }
        .settings-layout { display: flex; gap: 2rem; }
        .settings-nav { flex: 0 0 200px; }
        .settings-nav ul { list-style: none; padding: 0; }
        .settings-nav a { display: block; padding: 0.75rem 1rem; text-decoration: none; color: var(--text-muted); border-radius: 8px; font-weight: 500; margin-bottom: 5px; }
        .settings-nav a:hover { background-color: #2c2c2c; color: var(--text-color); }
        .settings-nav a.active { background-color: var(--primary-color); color: black; }
        .settings-content { flex-grow: 1; }
        .settings-section { display: none; }
        .settings-section.active { display: block; animation: fadeIn 0.4s ease; }
        .setting-card { background-color: #222; padding: 1.5rem; border-radius: var(--border-radius-base); margin-bottom: 1.5rem; }
        .setting-card h4 { font-size: 1.25rem; margin-bottom: 0.5rem; color: var(--text-color); }
        .setting-card p { font-size: 1rem; color: var(--text-muted); margin-bottom: 1.5rem; margin-top: 0; }
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-base); padding: 15px 20px; margin-bottom: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 10px; max-width: 350px; animation: slideInRight 0.3s ease; }
        .toast.success { border-left: 4px solid var(--green); }
        .toast.error { border-left: 4px solid var(--red); }
        .toast.warning { border-left: 4px solid var(--yellow); }
        .toast.info { border-left: 4px solid var(--primary-color); }
        .toast-icon { font-size: 20px; }
        .toast.success .toast-icon { color: var(--green); }
        .toast.error .toast-icon { color: var(--red); }
        .toast.warning .toast-icon { color: var(--yellow); }
        .toast.info .toast-icon { color: var(--primary-color); }
        .toast-content { flex: 1; }
        .toast-title { font-weight: 600; margin-bottom: 5px; }
        .toast-message { font-size: 14px; color: var(--text-muted); }
        .toast-close { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 18px; }
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .empty-state { text-align: center; padding: 40px; color: var(--text-muted); }
        .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
        .user-management-table { width: 100%; border-collapse: collapse; }
        .user-management-table th, .user-management-table td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
        .user-management-table th { font-weight: 600; font-size: 14px; color:var(--text-muted); text-transform: uppercase; background-color: #2c2c2c; }
        .user-management-table tbody tr:last-child td { border-bottom: none; }
        .user-management-table tbody tr:hover { background-color: #2c2c2c; }
        .role-badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .role-agent { background-color: var(--primary-color); color: #000; }
        .role-quality { background-color: var(--green); color: white; }
        .role-senior { background-color: var(--yellow); color: #000; }
        .role-manager { background-color: var(--purple); color: white; }
        .status-badge { padding: 4px 8px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .status-active { background-color: var(--green-bg); color: var(--green); }
        .status-inactive { background-color: var(--red-bg); color: var(--red); }
        .status-pending { background-color: var(--yellow-bg); color: var(--yellow); }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.show {
            display: flex;
            opacity: 1;
        }
        .modal-box {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-base);
            width: 90%;
            max-width: 500px;
            animation: slideInUp 0.4s ease;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.25rem;
            border-bottom: 1px solid var(--border-color);
        }
        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }
        .modal-close-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }
        .modal-body {
            padding: 1.5rem;
        }
        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            padding: 1.25rem;
            border-top: 1px solid var(--border-color);
        }
        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-footer .btn-secondary {
            background-color: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border-color);
            font-weight: 500;
        }
        .modal-footer .btn-secondary:hover {
            background-color: var(--border-color);
            color: var(--text-color);
        }

        .action-btn {
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            font-size: 13px;
            border: 1px solid transparent;
            transition: all 0.2s ease-in-out;
            margin-right: 5px;
            background-color: transparent;
        }
        .action-btn.edit-user-btn {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }
        .action-btn.edit-user-btn:hover {
            background-color: var(--primary-color);
            color: #000;
        }
        .action-btn.danger {
            border-color: var(--red);
            color: var(--red);
        }
        .action-btn.danger:hover {
            background-color: var(--red);
            color: white;
        }
        .action-btn.primary {
            border-color: var(--green);
            color: var(--green);
        }
        .action-btn.primary:hover {
            background-color: var(--green);
            color: white;
        }
        
        /* تصميم جدول الشيفتات الجديد */
        #schedule-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid var(--border-color);
        }
        
        #schedule-table th, 
        #schedule-table td {
            padding: 12px 8px;
            text-align: left;
            border: 1px solid var(--border-color);
            vertical-align: middle;
        }
        
        #schedule-table th {
            background-color: #2c2c2c;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-muted);
            text-transform: uppercase;
            text-align: center;
        }
        
        #schedule-table td.member-name {
            font-weight: 600;
            background-color: #222;
        }
        
        #schedule-table.edit-mode .shift-cell {
            cursor: pointer;
            background-color: rgba(0, 191, 255, 0.1);
            transition: background-color 0.2s ease;
        }
        
        #schedule-table.edit-mode .shift-cell:hover {
            background-color: rgba(0, 191, 255, 0.2);
        }
        
        /* ألوان حالات الشيفتات */
        .shift-cell .on-leave {
            color: var(--yellow);
            font-weight: 500;
        }
        
        .shift-cell .sick-leave {
            color: var(--red);
            font-weight: 500;
        }
        
        .shift-cell .off {
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .shift-cell .shift-normal {
            color: var(--text-color);
        }
        
        .schedule-edit-controls {
            display: none;
            gap: 0.5rem;
        }
        
        .schedule-edit-controls.show {
            display: inline-flex;
        }

        @media (max-width: 1024px) {
            .sidebar { width: 220px; }
            .main-content { margin-left: 220px; width: calc(100% - 220px); }
            .charts-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .sidebar { width: 70px; }
            .sidebar-title, .nav-group-title, .user-name, .user-role, .user-status { display: none; }
            .sidebar-nav a span:not(.icon) { display: none; }
            .main-content { margin-left: 70px; width: calc(100% - 70px); padding: 15px; }
            .stats-grid { grid-template-columns: 1fr; }
            .filter-panel { flex-direction: column; }
            .filter-group { min-width: 100%; }
            .header-actions { flex-direction: column; align-items: flex-end; gap: 10px; }
            .search-input-container input[type="search"] { width: 200px; }
        }
        @media (max-width: 480px) {
            .sidebar { display: none; }
            .main-content { margin-left: 0; width: 100%; }
            .modal-box { width: 95%; padding: 1rem; }
        }
    </style>
</head>
<body>
    <!-- Form وهمي لخداع المتصفح -->
    <form style="display: none;" autocomplete="off">
        <input type="email" name="fake-email" value="">
        <input type="password" name="fake-password" value="">
    </form>

    <div class="container-wrapper" style="display: flex; flex-direction: column; min-height: 100vh;">
        <div style="display: flex; flex: 1;">
            <aside class="sidebar">
                <div>
                    <div class="sidebar-header">
                        <svg class="sidebar-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5-10-5-10 5z" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" fill-opacity="0.3"></path>
                            <path d="M12 22V12" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
                        </svg>
                        <h1 class="sidebar-title">QualityX</h1>
                    </div>
                    <div class="sidebar-nav-container">
                        <div class="nav-group">
                            <h2 class="nav-group-title">Menu</h2>
                            <ul class="sidebar-nav">
                                <li><a class="active" data-tab="dashboard">📊 Dashboard</a></li>
                                <li><a data-tab="reports">📄 Reports & Analytics</a></li>
                                <li><a data-tab="teams">👥 Teams</a></li>
                                <li><a data-tab="team-scheduling">📅 Team Scheduling</a></li>
                                <li><a data-tab="company-employees">🏢 Company Employees</a></li>
                                <li><a data-tab="departments">🏛️ Departments</a></li>
                                <li><a data-tab="payments">💳 Payments</a></li>
                                <li><a data-tab="kpis">📈 KPIs</a></li>
                            </ul>
                        </div>
                        <div class="nav-group">
                            <h2 class="nav-group-title">Account</h2>
                            <ul class="sidebar-nav">
                                <li><a data-tab="profile">👤 Profile</a></li>
                                <li><a data-tab="settings">⚙️ Settings</a></li>
                                <li><a data-tab="help">❓ Get Help</a></li>
                                <li><a id="logout-btn">🚪 Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="sidebar-footer">
                    <div class="user-profile-widget">
                        <div class="avatar-initials" id="sidebar-avatar-initials">NO</div>
                        <div>
                            <div class="user-name" id="sidebar-username">Nawaf Al-Otaibi</div>
                            <div class="user-role" id="sidebar-userrole">Manager</div>
                            <div class="user-status" id="sidebar-userstatus">● Connected</div>
                        </div>
                    </div>
                </div>
            </aside>

            <main class="main-content">
                <header>
                    <div class="header-left">
                        <h2 class="page-title" id="page-title-header">Dashboard</h2>
                    </div>
                    <div class="header-actions">
                        <div class="search-input-container">
                            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                            <input type="text" 
                                   placeholder="Search reports, teams..." 
                                   class="anti-autofill"
                                   id="main-search"
                                   name="search_main">
                        </div>
                        <div class="notification-bell">
                            <button id="notification-btn" class="notification-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                            </button>
                            <div id="notification-dropdown" class="notification-dropdown">
                                <div class="notification-header">Notifications</div>
                                <ul class="notification-list" id="notification-list">
                                    <li class="notification-item">Loading notifications...</li>
                                </ul>
                            </div>
                        </div>
                        <button class="btn btn-primary" id="export-report-btn">Export Overall Report</button>
                    </div>
                </header>

                <div id="dashboard" class="tab-content active">
                    <div id="welcome-message">
                        <h2 id="welcome-user-h2">Welcome, Loading...!</h2>
                        <p>Here is the high-level overview of your quality operations.</p>
                    </div>

                    <section class="stats-grid">
                        <div class="card stat-card">
                            <div class="stat-header"><span>Total Orders Reviewed</span><span style="color:var(--primary-color)">👁️</span></div>
                            <div class="stat-value" id="total-orders">0</div>
                            <div class="stat-change positive" id="orders-change"><span>⬆️</span> Loading...</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-header"><span>Overall Error Rate</span><span style="color:var(--red)">❌</span></div>
                            <div class="stat-value" id="error-rate">0%</div>
                            <div class="stat-change positive" id="error-rate-change" style="color: var(--green)"><span>⬇️</span> Loading...</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-header"><span>Top Performing Team</span><span style="color:var(--green)">⭐</span></div>
                            <div class="stat-value" id="top-team">Loading...</div>
                            <div class="stat-change positive" id="top-team-rate">Loading...</div>
                        </div>
                        <div class="card stat-card">
                            <div class="stat-header"><span>Active Agents</span><span style="color:var(--purple)">👤</span></div>
                            <div class="stat-value" id="active-agents">0</div>
                            <div class="stat-change positive" id="agents-change"><span>➕</span> Loading...</div>
                        </div>
                    </section>

                    <div class="filter-container">
                        <section class="filter-panel">
                            <div class="filter-group">
                                <label>Department</label>
                                <select id="filter-department">
                                    <option value="all">All</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Team</label>
                                <select id="filter-team">
                                    <option value="all">All</option>
                                    <option value="team_a">Team A</option>
                                    <option value="team_b">Team B</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Employee</label>
                                <select id="filter-employee">
                                    <option value="all">All</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Date Range</label>
                                <input type="date" id="filter-date" style="color-scheme: dark;">
                            </div>
                            <button class="btn btn-primary" id="apply-filters-btn">Apply Filters</button>
                            <button id="download-report-btn" class="btn btn-secondary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                                Download Report
                            </button>
                        </section>
                    </div>

                    <section class="charts-grid">
                        <div class="card">
                            <h3>Error Rate Trend (Last 30 Days)</h3>
                            <div class="chart-container">
                                <canvas id="errorTrendChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <h3>Errors by Department</h3>
                            <div class="chart-container">
                                <canvas id="departmentErrorsChart"></canvas>
                            </div>
                        </div>
                    </section>
                </div>

                <div id="reports" class="tab-content">
                    <div class="card">
                        <h3>Advanced Reports & Analytics</h3>
                        <div class="filter-panel">
                            <div class="filter-group">
                                <label>Report Type</label>
                                <select id="report-type">
                                    <option value="performance">Performance Report</option>
                                    <option value="quality">Quality Metrics</option>
                                    <option value="department">Department Analysis</option>
                                    <option value="agent">Agent Performance</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Time Period</label>
                                <select id="report-period">
                                    <option value="week">Last Week</option>
                                    <option value="month">Last Month</option>
                                    <option value="quarter">Last Quarter</option>
                                    <option value="year">Last Year</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="generate-report-btn">Generate Report</button>
                        </div>
                        <div class="placeholder-content">
                            <h3>Report Generation</h3>
                            <p>Select report parameters and click "Generate Report" to create detailed analytics.</p>
                        </div>
                    </div>
                </div>

                <div id="teams" class="tab-content">
                    <div class="card">
                        <h3>Team Management</h3>
                        <div class="placeholder-content">
                            <h3>Team Overview</h3>
                            <p>This section will display team performance metrics and management tools.</p>
                        </div>
                    </div>
                </div>

                <div id="team-scheduling" class="tab-content">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Team Scheduling</h3>
                            <div style="display: flex; gap: 10px;">
                                <button id="edit-schedule-btn" class="btn btn-primary">Edit Schedule</button>
                                <div class="schedule-edit-controls" id="schedule-edit-controls">
                                    <button id="save-schedule-btn" class="btn btn-secondary">Save Changes</button>
                                    <button id="cancel-schedule-btn" class="btn btn-danger">Cancel</button>
                                </div>
                                <button id="add-member-btn" class="btn btn-primary">Add Member</button>
                            </div>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="schedule-table">
                                <thead>
                                    <tr>
                                        <th>Team Member</th>
                                        <th>Monday</th>
                                        <th>Tuesday</th>
                                        <th>Wednesday</th>
                                        <th>Thursday</th>
                                        <th>Friday</th>
                                        <th>Saturday</th>
                                        <th>Sunday</th>
                                    </tr>
                                </thead>
                                <tbody id="schedule-table-body">
                                    <!-- سيتم ملء الجدول ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="company-employees" class="tab-content">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Company Employees</h3>
                            <button id="add-employee-btn" class="btn btn-primary">Add New Employee</button>
                        </div>
                        <div class="filter-panel">
                            <div class="filter-group">
                                <label>Department</label>
                                <select id="employee-department-filter">
                                    <option value="all">All Departments</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label>Status</label>
                                <select id="employee-status-filter">
                                    <option value="all">All Status</option>
                                    <option value="active">Active</option>
                                    <option value="inactive">Inactive</option>
                                    <option value="pending">Pending</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" id="filter-employees-btn">Filter</button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="user-management-table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Department</th>
                                        <th>Role</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="employees-table-body">
                                    <!-- سيتم ملء الجدول ديناميكيًا -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="departments" class="tab-content">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h3>Departments</h3>
                            <button id="add-department-btn" class="btn btn-primary">Add New Department</button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="user-management-table">
                                <thead>
                                    <tr>
                                        <th>Department Name</th>
                                        <th>Manager</th>
                                        <th>Team Count</th>
                                        <th>Employee Count</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="departments-table-body">
                                    <tr>
                                        <td>Quality Assurance</td>
                                        <td>Nawaf Al-Otaibi</td>
                                        <td>5</td>
                                        <td>42</td>
                                        <td><span class="status-badge status-active">Active</span></td>
                                        <td>
                                            <button class="action-btn edit-user-btn" data-department-id="1">Edit</button>
                                            <button class="action-btn danger">Delete</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Customer Service</td>
                                        <td>Sarah Johnson</td>
                                        <td>8</td>
                                        <td>67</td>
                                        <td><span class="status-badge status-active">Active</span></td>
                                        <td>
                                            <button class="action-btn edit-user-btn" data-department-id="2">Edit</button>
                                            <button class="action-btn danger">Delete</button>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Technical Support</td>
                                        <td>Michael Chen</td>
                                        <td>4</td>
                                        <td>28</td>
                                        <td><span class="status-badge status-active">Active</span></td>
                                        <td>
                                            <button class="action-btn edit-user-btn" data-department-id="3">Edit</button>
                                            <button class="action-btn danger">Delete</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="payments" class="tab-content">
                    <div class="card">
                        <h3>Payment Management</h3>
                        <div class="placeholder-content">
                            <h3>Payment Processing</h3>
                            <p>This section will handle payment processing and salary management.</p>
                        </div>
                    </div>
                </div>

                <div id="kpis" class="tab-content">
                    <div class="card">
                        <h3>Key Performance Indicators</h3>
                        <div class="placeholder-content">
                            <h3>KPI Dashboard</h3>
                            <p>This section will display key performance indicators and metrics tracking.</p>
                        </div>
                    </div>
                </div>

                <div id="profile" class="tab-content">
                    <div class="card">
                        <h3>User Profile</h3>
                        <div class="placeholder-content">
                            <h3>Profile Management</h3>
                            <p>This section will allow users to manage their profile information.</p>
                        </div>
                    </div>
                </div>

                <div id="settings" class="tab-content">
                    <div class="settings-layout">
                        <div class="settings-nav">
                            <ul>
                                <li><a href="#" class="settings-nav-link active" data-settings-section="general">General</a></li>
                                <li><a href="#" class="settings-nav-link" data-settings-section="notifications">Notifications</a></li>
                                <li><a href="#" class="settings-nav-link" data-settings-section="security">Security</a></li>
                                <li><a href="#" class="settings-nav-link" data-settings-section="integrations">Integrations</a></li>
                            </ul>
                        </div>
                        <div class="settings-content">
                            <div id="general-settings" class="settings-section active">
                                <div class="setting-card">
                                    <h4>Language & Region</h4>
                                    <p>Choose your preferred language and regional settings.</p>
                                    <div class="form-group">
                                        <label>Language</label>
                                        <select>
                                            <option>English</option>
                                            <option>Arabic</option>
                                            <option>Spanish</option>
                                            <option>French</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Time Zone</label>
                                        <select>
                                            <option>UTC+03:00 (Riyadh)</option>
                                            <option>UTC+00:00 (London)</option>
                                            <option>UTC-05:00 (New York)</option>
                                        </select>
                                    </div>
                                    <div class="page-actions">
                                        <button class="btn btn-primary">Save Changes</button>
                                    </div>
                                </div>
                                <div class="setting-card">
                                    <h4>Display Settings</h4>
                                    <p>Customize how the dashboard appears.</p>
                                    <div class="form-group">
                                        <label>Theme</label>
                                        <select>
                                            <option>Dark (Default)</option>
                                            <option>Light</option>
                                            <option>Auto</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Dashboard Density</label>
                                        <select>
                                            <option>Comfortable</option>
                                            <option>Compact</option>
                                        </select>
                                    </div>
                                    <div class="page-actions">
                                        <button class="btn btn-primary">Save Changes</button>
                                    </div>
                                </div>
                            </div>
                            <div id="notifications-settings" class="settings-section">
                                <div class="setting-card">
                                    <h4>Notification Preferences</h4>
                                    <p>Manage how and when you receive notifications.</p>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" checked> Email Notifications
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" checked> Push Notifications
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox"> SMS Alerts
                                        </label>
                                    </div>
                                    <div class="page-actions">
                                        <button class="btn btn-primary">Save Preferences</button>
                                    </div>
                                </div>
                            </div>
                            <div id="security-settings" class="settings-section">
                                <div class="setting-card">
                                    <h4>Password & Security</h4>
                                    <p>Update your password and security settings.</p>
                                    <div class="form-group">
                                        <label>Current Password</label>
                                        <input type="password">
                                    </div>
                                    <div class="form-group">
                                        <label>New Password</label>
                                        <input type="password">
                                    </div>
                                    <div class="form-group">
                                        <label>Confirm New Password</label>
                                        <input type="password">
                                    </div>
                                    <div class="page-actions">
                                        <button class="btn btn-primary">Update Password</button>
                                    </div>
                                </div>
                                <div class="setting-card">
                                    <h4>Two-Factor Authentication</h4>
                                    <p>Add an extra layer of security to your account.</p>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox"> Enable Two-Factor Authentication
                                        </label>
                                    </div>
                                    <div class="page-actions">
                                        <button class="btn btn-primary">Save Settings</button>
                                    </div>
                                </div>
                            </div>
                            <div id="integrations-settings" class="settings-section">
                                <div class="setting-card">
                                    <h4>Third-Party Integrations</h4>
                                    <p>Connect with other tools and services.</p>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" checked> Slack Integration
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox"> Google Workspace
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox"> Microsoft Teams
                                        </label>
                                    </div>
                                    <div class="page-actions">
                                        <button class="btn btn-primary">Save Integrations</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="help" class="tab-content">
                    <div class="card">
                        <h3>Help & Support</h3>
                        <div class="placeholder-content">
                            <h3>Get Assistance</h3>
                            <p>This section will provide help resources and contact information for support.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal لإضافة موظف جديد -->
    <div id="add-employee-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Add New Employee</h3>
                <button class="modal-close-btn" id="close-add-employee-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="new-employee-name" placeholder="Enter full name">
                </div>
                <div class="form-group">
                    <label>Email</label>
                    <input type="email" id="new-employee-email" placeholder="Enter email address">
                </div>
                <div class="form-group">
                    <label>Department</label>
                    <select id="new-employee-department">
                        <option value="quality">Quality Assurance</option>
                        <option value="customer">Customer Service</option>
                        <option value="technical">Technical Support</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Role</label>
                    <select id="new-employee-role">
                        <option value="agent">Agent</option>
                        <option value="quality">Quality Specialist</option>
                        <option value="senior">Senior Agent</option>
                        <option value="manager">Manager</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-add-employee">Cancel</button>
                <button class="btn btn-primary" id="save-new-employee">Add Employee</button>
            </div>
        </div>
    </div>

    <!-- Modal لتعديل الشيفتات -->
    <div id="edit-shift-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Edit Shift</h3>
                <button class="modal-close-btn" id="close-edit-shift-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Select Shift</label>
                    <select id="shift-options">
                        <option value="9:00 AM - 5:00 PM">9:00 AM - 5:00 PM</option>
                        <option value="10:00 AM - 6:00 PM">10:00 AM - 6:00 PM</option>
                        <option value="11:00 AM - 7:00 PM">11:00 AM - 7:00 PM</option>
                        <option value="12:00 PM - 8:00 PM">12:00 PM - 8:00 PM</option>
                        <option value="1:00 PM - 9:00 PM">1:00 PM - 9:00 PM</option>
                        <option value="on-leave">On Leave</option>
                        <option value="sick">Sick Leave</option>
                        <option value="off">Off</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-edit-shift">Cancel</button>
                <button class="btn btn-primary" id="update-shift">Update</button>
            </div>
        </div>
    </div>

    <!-- Modal لإضافة عضو جديد -->
    <div id="add-member-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Add New Member</h3>
                <button class="modal-close-btn" id="close-add-member-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Full Name</label>
                    <input type="text" id="new-member-name" placeholder="Enter full name">
                </div>
                <div class="form-group">
                    <label>Position</label>
                    <input type="text" id="new-member-position" placeholder="Enter position">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-add-member">Cancel</button>
                <button class="btn btn-primary" id="save-new-member">Add Member</button>
            </div>
        </div>
    </div>

    <!-- Modal لتعديل القسم -->
    <div id="edit-department-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Edit Department</h3>
                <button class="modal-close-btn" id="close-edit-department-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Department Name</label>
                    <input type="text" id="edit-department-name" placeholder="Enter department name">
                </div>
                <div class="form-group">
                    <label>Manager</label>
                    <select id="edit-department-manager">
                        <option value="1">Nawaf Al-Otaibi</option>
                        <option value="2">Sarah Johnson</option>
                        <option value="3">Michael Chen</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select id="edit-department-status">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-edit-department">Cancel</button>
                <button class="btn btn-primary" id="save-department-changes">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications Container -->
    <div class="toast-container" id="toast-container"></div>

    <script>
        // حل مشكلة الـ autocomplete
        document.addEventListener('DOMContentLoaded', function() {
            const inputs = document.querySelectorAll('input');
            inputs.forEach(input => {
                input.setAttribute('autocomplete', 'off');
                input.setAttribute('autocorrect', 'off');
                input.setAttribute('autocapitalize', 'off');
                input.setAttribute('spellcheck', 'false');
            });
        });

        // حل مشكلة الـ listeners
        document.addEventListener('DOMContentLoaded', function() {
            // إضافة معالجة الأخطاء للـ listeners
            const originalAddEventListener = EventTarget.prototype.addEventListener;
            EventTarget.prototype.addEventListener = function(type, listener, options) {
                const wrappedListener = function(...args) {
                    try {
                        return listener.apply(this, args);
                    } catch (error) {
                        console.error('Error in event listener:', error);
                        // إرجاع false بدلاً من true لتجنب مشكلة الـ asynchronous response
                        return false;
                    }
                };
                return originalAddEventListener.call(this, type, wrappedListener, options);
            };

            // إضافة معالجة للـ Promises
            window.addEventListener('unhandledrejection', function(event) {
                console.warn('Unhandled promise rejection:', event.reason);
                event.preventDefault();
            });

            // إضافة معالجة للأخطاء العامة
            window.addEventListener('error', function(event) {
                console.error('Global error:', event.error);
            });
        });

        // بيانات تجريبية للجدول
        const scheduleData = [
            { name: "Ahmed Mohammed", shifts: ["9:00 AM - 5:00 PM", "9:00 AM - 5:00 PM", "10:00 AM - 6:00 PM", "9:00 AM - 5:00 PM", "on-leave", "off", "off"] },
            { name: "Sarah Johnson", shifts: ["10:00 AM - 6:00 PM", "10:00 AM - 6:00 PM", "10:00 AM - 6:00 PM", "11:00 AM - 7:00 PM", "11:00 AM - 7:00 PM", "off", "off"] },
            { name: "Michael Chen", shifts: ["9:00 AM - 5:00 PM", "9:00 AM - 5:00 PM", "sick", "9:00 AM - 5:00 PM", "9:00 AM - 5:00 PM", "off", "off"] },
            { name: "Fatima Al-Rashid", shifts: ["11:00 AM - 7:00 PM", "11:00 AM - 7:00 PM", "11:00 AM - 7:00 PM", "11:00 AM - 7:00 PM", "11:00 AM - 7:00 PM", "off", "off"] }
        ];

        // بيانات الموظفين
        const employeesData = [
            { id: 1, name: "Ahmed Mohammed", email: "ahmed@company.com", department: "Quality Assurance", role: "Agent", status: "active" },
            { id: 2, name: "Sarah Johnson", email: "sarah@company.com", department: "Customer Service", role: "Senior Agent", status: "active" },
            { id: 3, name: "Michael Chen", email: "michael@company.com", department: "Technical Support", role: "Quality Specialist", status: "active" },
            { id: 4, name: "Fatima Al-Rashid", email: "fatima@company.com", department: "Quality Assurance", role: "Agent", status: "pending" }
        ];

        // تهيئة الجدول عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            initializeScheduleTable();
            initializeEmployeesTable();
            setupEventListeners();
            setupModals();
            setupTabs();
            setupSettingsNavigation();
            setupNotificationDropdown();
        });

        // تهيئة جدول الشيفتات
        function initializeScheduleTable() {
            const tableBody = document.getElementById('schedule-table-body');
            tableBody.innerHTML = '';

            scheduleData.forEach(member => {
                const row = document.createElement('tr');
                
                // اسم العضو
                const nameCell = document.createElement('td');
                nameCell.className = 'member-name';
                nameCell.textContent = member.name;
                row.appendChild(nameCell);
                
                // الشيفتات
                member.shifts.forEach(shift => {
                    const shiftCell = document.createElement('td');
                    shiftCell.className = 'shift-cell';
                    
                    const shiftSpan = document.createElement('span');
                    shiftSpan.textContent = shift;
                    
                    // تحديد لون النص بناءً على حالة الشيفت
                    if (shift === 'on-leave') {
                        shiftSpan.className = 'on-leave';
                    } else if (shift === 'sick') {
                        shiftSpan.className = 'sick-leave';
                    } else if (shift === 'off') {
                        shiftSpan.className = 'off';
                    } else {
                        shiftSpan.className = 'shift-normal';
                    }
                    
                    shiftCell.appendChild(shiftSpan);
                    row.appendChild(shiftCell);
                });
                
                tableBody.appendChild(row);
            });
        }

        // تهيئة جدول الموظفين
        function initializeEmployeesTable() {
            const tableBody = document.getElementById('employees-table-body');
            tableBody.innerHTML = '';

            employeesData.forEach(employee => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${employee.name}</td>
                    <td>${employee.email}</td>
                    <td>${employee.department}</td>
                    <td><span class="role-badge role-${employee.role.toLowerCase().replace(' ', '-')}">${employee.role}</span></td>
                    <td><span class="status-badge status-${employee.status}">${employee.status.charAt(0).toUpperCase() + employee.status.slice(1)}</span></td>
                    <td>
                        <button class="action-btn edit-user-btn" data-employee-id="${employee.id}">Edit</button>
                        <button class="action-btn danger">Delete</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
        }

        // إعداد مستمعي الأحداث
        function setupEventListeners() {
            // زر تعديل الجدول
            document.getElementById('edit-schedule-btn').addEventListener('click', function() {
                document.getElementById('schedule-table').classList.add('edit-mode');
                document.getElementById('edit-schedule-btn').style.display = 'none';
                document.getElementById('schedule-edit-controls').classList.add('show');
            });

            // زر حفظ التعديلات
            document.getElementById('save-schedule-btn').addEventListener('click', function() {
                document.getElementById('schedule-table').classList.remove('edit-mode');
                document.getElementById('edit-schedule-btn').style.display = 'inline-block';
                document.getElementById('schedule-edit-controls').classList.remove('show');
                showToast('Schedule updated successfully!', 'success');
            });

            // زر إلغاء التعديلات
            document.getElementById('cancel-schedule-btn').addEventListener('click', function() {
                document.getElementById('schedule-table').classList.remove('edit-mode');
                document.getElementById('edit-schedule-btn').style.display = 'inline-block';
                document.getElementById('schedule-edit-controls').classList.remove('show');
                // إعادة تحميل البيانات الأصلية
                initializeScheduleTable();
                showToast('Changes cancelled', 'warning');
            });

            // إضافة موظف جديد
            document.getElementById('add-employee-btn').addEventListener('click', function() {
                document.getElementById('add-employee-modal').classList.add('show');
            });

            // إضافة عضو جديد
            document.getElementById('add-member-btn').addEventListener('click', function() {
                document.getElementById('add-member-modal').classList.add('show');
            });

            // حفظ العضو الجديد
            document.getElementById('save-new-member').addEventListener('click', function() {
                const name = document.getElementById('new-member-name').value;
                const position = document.getElementById('new-member-position').value;
                
                if (name && position) {
                    // إضافة العضو الجديد إلى البيانات
                    scheduleData.push({
                        name: name,
                        shifts: ["9:00 AM - 5:00 PM", "9:00 AM - 5:00 PM", "9:00 AM - 5:00 PM", "9:00 AM - 5:00 PM", "9:00 AM - 5:00 PM", "off", "off"]
                    });
                    
                    // تحديث الجدول
                    initializeScheduleTable();
                    
                    // إغلاق المودال
                    document.getElementById('add-member-modal').classList.remove('show');
                    
                    // إظهار رسالة نجاح
                    showToast('Member added successfully!', 'success');
                    
                    // إعادة تعيين الحقول
                    document.getElementById('new-member-name').value = '';
                    document.getElementById('new-member-position').value = '';
                } else {
                    showToast('Please fill all fields', 'error');
                }
            });

            // حفظ الموظف الجديد
            document.getElementById('save-new-employee').addEventListener('click', function() {
                const name = document.getElementById('new-employee-name').value;
                const email = document.getElementById('new-employee-email').value;
                const department = document.getElementById('new-employee-department').value;
                const role = document.getElementById('new-employee-role').value;
                
                if (name && email && department && role) {
                    // إضافة الموظف الجديد إلى البيانات
                    employeesData.push({
                        id: employeesData.length + 1,
                        name: name,
                        email: email,
                        department: document.getElementById('new-employee-department').options[document.getElementById('new-employee-department').selectedIndex].text,
                        role: role.charAt(0).toUpperCase() + role.slice(1),
                        status: 'pending'
                    });
                    
                    // تحديث الجدول
                    initializeEmployeesTable();
                    
                    // إغلاق المودال
                    document.getElementById('add-employee-modal').classList.remove('show');
                    
                    // إظهار رسالة نجاح
                    showToast('Employee added successfully!', 'success');
                    
                    // إعادة تعيين الحقول
                    document.getElementById('new-employee-name').value = '';
                    document.getElementById('new-employee-email').value = '';
                    document.getElementById('new-employee-department').selectedIndex = 0;
                    document.getElementById('new-employee-role').selectedIndex = 0;
                } else {
                    showToast('Please fill all fields', 'error');
                }
            });

            // تعديل القسم
            document.querySelectorAll('.edit-user-btn[data-department-id]').forEach(button => {
                button.addEventListener('click', function() {
                    document.getElementById('edit-department-modal').classList.add('show');
                });
            });

            // حفظ تعديل القسم
            document.getElementById('save-department-changes').addEventListener('click', function() {
                document.getElementById('edit-department-modal').classList.remove('show');
                showToast('Department updated successfully!', 'success');
            });

            // النقر على خلايا الشيفتات في وضع التعديل
            document.addEventListener('click', function(e) {
                if (e.target.closest('.shift-cell') && document.getElementById('schedule-table').classList.contains('edit-mode')) {
                    document.getElementById('edit-shift-modal').classList.add('show');
                    
                    // حفظ المرجع للخلية التي تم النقر عليها
                    window.currentShiftCell = e.target.closest('.shift-cell');
                }
            });

            // تحديث الشيفت
            document.getElementById('update-shift').addEventListener('click', function() {
                const selectedShift = document.getElementById('shift-options').value;
                const shiftSpan = window.currentShiftCell.querySelector('span');
                
                // تحديث النص
                shiftSpan.textContent = selectedShift;
                
                // تحديث اللون بناءً على الحالة الجديدة
                shiftSpan.className = '';
                if (selectedShift === 'on-leave') {
                    shiftSpan.className = 'on-leave';
                } else if (selectedShift === 'sick') {
                    shiftSpan.className = 'sick-leave';
                } else if (selectedShift === 'off') {
                    shiftSpan.className = 'off';
                } else {
                    shiftSpan.className = 'shift-normal';
                }
                
                // إغلاق المودال
                document.getElementById('edit-shift-modal').classList.remove('show');
                
                // إظهار رسالة نجاح
                showToast('Shift updated successfully!', 'success');
            });
        }

        // إعداد المودالات
        function setupModals() {
            // إغلاق المودالات عند النقر على زر الإغلاق
            document.querySelectorAll('.modal-close-btn').forEach(button => {
                button.addEventListener('click', function() {
                    this.closest('.modal-overlay').classList.remove('show');
                });
            });

            // إغلاق المودالات عند النقر خارجها
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('show');
                    }
                });
            });

            // إلغاء إضافة موظف
            document.getElementById('cancel-add-employee').addEventListener('click', function() {
                document.getElementById('add-employee-modal').classList.remove('show');
            });

            // إلغاء إضافة عضو
            document.getElementById('cancel-add-member').addEventListener('click', function() {
                document.getElementById('add-member-modal').classList.remove('show');
            });

            // إلغاء تعديل الشيفت
            document.getElementById('cancel-edit-shift').addEventListener('click', function() {
                document.getElementById('edit-shift-modal').classList.remove('show');
            });

            // إلغاء تعديل القسم
            document.getElementById('cancel-edit-department').addEventListener('click', function() {
                document.getElementById('edit-department-modal').classList.remove('show');
            });
        }

        // إعداد التبويبات
        function setupTabs() {
            document.querySelectorAll('.sidebar-nav a[data-tab]').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // إخفاء جميع المحتويات
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    // إزالة النشاط من جميع التبويبات
                    document.querySelectorAll('.sidebar-nav a').forEach(tab => {
                        tab.classList.remove('active');
                    });
                    
                    // إظهار المحتوى المحدد
                    document.getElementById(tabId).classList.add('active');
                    this.classList.add('active');
                    
                    // تحديث عنوان الصفحة
                    document.getElementById('page-title-header').textContent = this.textContent.trim();
                });
            });
        }

        // إعداد إعدادات التنقل
        function setupSettingsNavigation() {
            document.querySelectorAll('.settings-nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // إزالة النشاط من جميع الروابط
                    document.querySelectorAll('.settings-nav-link').forEach(link => {
                        link.classList.remove('active');
                    });
                    
                    // إخفاء جميع الأقسام
                    document.querySelectorAll('.settings-section').forEach(section => {
                        section.classList.remove('active');
                    });
                    
                    // إظهار القسم المحدد
                    const sectionId = this.getAttribute('data-settings-section') + '-settings';
                    document.getElementById(sectionId).classList.add('active');
                    this.classList.add('active');
                });
            });
        }

        // إعداد قائمة الإشعارات
        function setupNotificationDropdown() {
            document.getElementById('notification-btn').addEventListener('click', function() {
                document.getElementById('notification-dropdown').classList.toggle('show');
            });

            // إغلاق القائمة عند النقر خارجها
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.notification-bell')) {
                    document.getElementById('notification-dropdown').classList.remove('show');
                }
            });
        }

        // وظيفة لإظهار الإشعارات
        function showToast(message, type = 'info') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'ℹ️';
            let title = 'Info';
            
            switch(type) {
                case 'success':
                    icon = '✅';
                    title = 'Success';
                    break;
                case 'error':
                    icon = '❌';
                    title = 'Error';
                    break;
                case 'warning':
                    icon = '⚠️';
                    title = 'Warning';
                    break;
            }
            
            toast.innerHTML = `
                <div class="toast-icon">${icon}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">&times;</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // إغلاق الإشعار تلقائياً بعد 5 ثوان
            setTimeout(() => {
                toast.remove();
            }, 5000);
            
            // إغلاق الإشعار يدوياً
            toast.querySelector('.toast-close').addEventListener('click', function() {
                toast.remove();
            });
        }

        // تهيئة الرسوم البيانية
        document.addEventListener('DOMContentLoaded', function() {
            // Error Trend Chart
            const errorTrendCtx = document.getElementById('errorTrendChart').getContext('2d');
            const errorTrendChart = new Chart(errorTrendCtx, {
                type: 'line',
                data: {
                    labels: ['Day 1', 'Day 2', 'Day 3', 'Day 4', 'Day 5', 'Day 6', 'Day 7', 'Day 8', 'Day 9', 'Day 10', 'Day 11', 'Day 12', 'Day 13', 'Day 14', 'Day 15', 'Day 16', 'Day 17', 'Day 18', 'Day 19', 'Day 20', 'Day 21', 'Day 22', 'Day 23', 'Day 24', 'Day 25', 'Day 26', 'Day 27', 'Day 28', 'Day 29', 'Day 30'],
                    datasets: [{
                        label: 'Error Rate %',
                        data: [5.2, 4.8, 5.5, 4.9, 5.1, 4.7, 4.5, 4.3, 4.6, 4.4, 4.2, 4.1, 4.0, 3.9, 3.8, 3.7, 3.6, 3.5, 3.4, 3.3, 3.2, 3.1, 3.0, 2.9, 2.8, 2.7, 2.6, 2.5, 2.4, 2.3],
                        borderColor: '#00bfff',
                        backgroundColor: 'rgba(0, 191, 255, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#8b949e'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#8b949e'
                            }
                        }
                    }
                }
            });

            // Department Errors Chart
            const departmentErrorsCtx = document.getElementById('departmentErrorsChart').getContext('2d');
            const departmentErrorsChart = new Chart(departmentErrorsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Quality Assurance', 'Customer Service', 'Technical Support'],
                    datasets: [{
                        data: [45, 30, 25],
                        backgroundColor: [
                            'rgba(0, 191, 255, 0.7)',
                            'rgba(40, 167, 69, 0.7)',
                            'rgba(255, 193, 7, 0.7)'
                        ],
                        borderColor: [
                            'rgba(0, 191, 255, 1)',
                            'rgba(40, 167, 69, 1)',
                            'rgba(255, 193, 7, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                color: '#8b949e',
                                padding: 20
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
