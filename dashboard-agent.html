<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Performance - QualityX</title>
    <link rel="icon" href="data:image/svg+errors-filters').addEventListener('click', () => {
            document.getElementById('my-errors-search').value = '';
            document.getElementById('my-errors-status').value = 'all';
            loadUserErrorsxml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='();
            showToast('Filters reset', 'info');
        });
    }

    function setupEventListeners() {
        0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%2300bfff'/%3E%3Cdocument.querySelectorAll('.sidebar-nav a[data-tab]').forEach(tab => {
            tab.addEventListener('click', e => {
                e.preventDefault();
                document.querySelectorAll('.sidebar-nav a').forEach(text x='50' y='55' font-family='Poppins, sans-serif' font-size='t => t.classList.remove('active'));
                tab.classList.add('active');
                const tabId = tab.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(c => c.classList60' font-weight='bold' fill='white' text-anchor='middle' dominant-baseline='middle.remove('active'));
                document.getElementById(tabId).classList.add('active');
                document.'%3EQ%3C/text%3E%3C/svg%3E">
    <link hrefgetElementById('page-title-header').textContent = tab.textContent.replace(/[^\w\s]/gi, '').trim();="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;
            });
        });

        document.querySelectorAll('.settings-nav a').forEach(link => {
            600;700;800&display=swap" rel="stylesheet">
    <script src="httpslink.addEventListener('click', e => {
                e.preventDefault();
                document.querySelectorAll('.settings-nav://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module">
    import {  a').forEach(a => a.classList.remove('active'));
                link.classList.add('active');
        supabase, 
        getCurrentUser, 
        getUserById, 
        getAgentErrors, 
        submit
                const sectionId = link.dataset.section;
                document.querySelectorAll('.setting-card').forEach(s => s.style.display = 'none');
                document.getElementById(`settings-section-${sectionId}`).style.display = 'ErrorResponse,
        getPerformanceMetrics,
        getNotifications,
        markNotificationAsRead,
        subscribeToblock';
            });
        });

        document.querySelector('.main-content').addEventListener('click', (e) => {Notifications,
        subscribeToErrors,
        updateUserProfile
    } from './api-client.js';


            const viewBtn = e.target.closest('.view-error-btn');
            const appealBtn = e.    // Application State
    let currentUser = null;
    let userErrors = [];
    let filteredUserErrors = [];
    let userPerformance = {
        errorRate: 0,
        totalErrors: 0,
        totaltarget.closest('.appeal-error-btn');

            if (viewBtn) {
                openViewErrorModal(viewBtn.dataset.errorId);
            } else if (appealBtn) {
                const errorId = appealOrders: 0,
        errorTypes: {}
    };
    let notifications = [];
    let commonErrorsChartBtn.dataset.errorId;
                const modal = document.getElementById('appeal-error-modal');
                 = null;
    
    // Pagination State
    let dashboardCurrentPage = 1;
    let myif (modal) {
                    modal.querySelector('#appeal-reason').value = '';
                    modal.querySelector('#submitErrorsCurrentPage = 1;
    const ITEMS_PER_PAGE = 10;

    // Toast-appeal-btn').dataset.errorId = errorId;
                    showModal('appeal-error-modal');
                 Notification System
    function showToast(message, type = 'info', title = '') {
        const container = document.}
            }
        });
        
        document.getElementById('notification-btn').addEventListener('click', egetElementById('toast-container');
        if (!container) return;
        
        const toast = document.createElement('div'); => { e.stopPropagation(); document.getElementById('notification-dropdown').classList.toggle('show'); });
        
        document.getElementById('mark-all-read-btn').addEventListener('click', async e => {
            e.stopPropagation();
        toast.className = `toast ${type}`;
        
        const icons = {
            success: '✅',
            error: '❌',
            warning: '⚠️',
            info: 'ℹ️'
        
            const unread = notifications.filter(n => !n.is_read);
            if (unread.length === 0) return showToast('No unread notifications', 'info');
            try {
                await Promise.};
        
        toast.innerHTML = `
            <div class="toast-icon">${icons[type]}</div>all(unread.map(n => markNotificationAsRead(n.id)));
                await loadNotifications();
                
            <div class="toast-content">
                ${title ? `<div class="toast-title">${title}</div>` : ''}
                <div class="toast-message">${message}</div>
            </div>
            <showToast('All notifications marked as read', 'success');
            } catch (error) { showToast('Failedbutton class="toast-close">×</button>
        `;
        
        container.appendChild(toast);
         to mark all as read', 'error'); }
        });
        
        document.getElementById('submit-response-btn
        const removeToast = () => {
            if (toast.parentNode) {
                toast.style.opacity = '').addEventListener('click', handleResponseSubmission);
        
        document.getElementById('submit-appeal-btn').addEventListener('click0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.parentNode?.removeChild(toast), 300);
            }
        };

        setTimeout(removeToast,', async function() {
            const btn = this;
            const errorId = btn.dataset.errorId;
            const reason = document.getElementById('appeal-reason').value.trim();
            if (!reason) { showToast 5000);
        toast.querySelector('.toast-close').addEventListener('click', removeToast);
    ('Please provide a reason for your appeal.', 'warning'); return; }

            btn.disabled = true; btn.textContent =}

    // Helper Functions
    function getInitials(name) {
        if (!name) return ''; 'Submitting...';
            try {
                const { error: responseError } = await supabase.from('error
        const names = name.split(' ');
        return names.length > 1 ? 
            `${_responses').insert({
                    error_id: errorId,
                    response_by_id: currentUser.names[0][0]}${names[names.length - 1][0]}`.toUpperCase() : 
            id,
                    response_text: reason,
                    response_type: 'appeal'
                });
                `${names[0][0]}`.toUpperCase();
    }

    function formatDate(dateString) {
        if (!if(responseError) throw responseError;
                
                const { error } = await supabase.from('errorsdateString) return 'N/A';
        return new Date(dateString).toLocaleDateString('en-EG').update({ status: 'under_review' }).eq('id', errorId);
                if (error) throw error;', { 
            year: 'numeric', 
            month: 'short', 
            day: '
                
                showToast('Appeal submitted successfully!', 'success');
                hideModal('appeal-error-modalnumeric',
            timeZone: 'Africa/Cairo'
        });
    }

    function formatDateTime(dateString) {
        if (!dateString) return 'N/A';
        return new Date(dateString).toLocaleString');
                await loadUserErrors();

            } catch (error) {
                console.error('Error submitting('en-EG', { 
            year: 'numeric', 
            month: 'short', 
 appeal:', error);
                showToast('Failed to submit appeal.', 'error');
            } finally {
                btn.            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit',
disabled = false; btn.textContent = 'Submit Appeal';
            }
        });
        
        document.            timeZone: 'Africa/Cairo'
        });
    }

    function showModal(modalId) { getElementById('save-profile-btn').addEventListener('click', async () => {
            const name = document.getElementById('
        document.getElementById(modalId)?.classList.add('show'); 
    }
    
    functionprofile-fullname').value.trim();
            const phone = document.getElementById('profile-phone').value.trim hideModal(modalId) { 
        document.getElementById(modalId)?.classList.remove('show'); ();
            if (!name) return showToast('Please enter your name', 'warning');
            try {
                await updateUserProfile(currentUser.id, { name, phone });
                currentUser = { ...currentUser, name, phone };

    }

    // Confirmation Modal
    function showConfirmationModal({ title, message, confirmText = 'Confirm                updateUserInterface();
                showToast('Profile updated successfully!', 'success');
            } catch (error) { showToast', onConfirm }) {
        const modal = document.getElementById('confirmation-modal');
        modal.querySelector('#('Failed to update profile', 'error'); }
        });
        
        document.getElementById('logout-btn').addEventListener('confirmation-title').textContent = title;
        modal.querySelector('#confirmation-message').textContent = message;
        const confirmclick', () => {
            showConfirmationModal({
                title: 'Logout', message: 'Are you sure you want toBtn = modal.querySelector('#confirmation-confirm-btn');
        confirmBtn.textContent = confirmText;

        const new logout?', confirmText: 'Logout',
                onConfirm: async () => {
                    try { await supabase.authConfirmBtn = confirmBtn.cloneNode(true);
        confirmBtn.parentNode.replaceChild(newConfirmBtn, confirm.signOut(); window.location.href = 'login.html'; } catch (error) { showToast('Error during logout',Btn);

        newConfirmBtn.addEventListener('click', () => {
            onConfirm();
            hideModal('confirmation- 'error'); }
                }
            });
        });

        document.getElementById('change-password-btn').addEventListenermodal');
        });

        showModal('confirmation-modal');
    }

    // Main Application Logic
    async function initApp() {
        try {
            showToast('Loading your dashboard...', 'info');
            ('click', () => { showModal('change-password-modal'); });
        document.querySelectorAll('.setting-item .toggle-switch input').forEach(toggle => {
            toggle.addEventListener('change', () => {
                
            const user = await getCurrentUser();
            if (!user) {
                window.location.href = 'const label = toggle.closest('.setting-item').querySelector('span').textContent;
                const status = toggle.checkedlogin.html';
                return;
            }
            
            const { data: profile, error } = await supabase ? 'enabled' : 'disabled';
                showToast(`${label} ${status}.`, 'success', 'Setting Updated
                .from('users')
                .select('*')
                .eq('id', user.id)
                .');
            });
        });
        
        document.querySelectorAll('.modal-close-btn').forEach(btn => {single();
            
            if (error) throw error;
            
            currentUser = { ...user, ...
            btn.addEventListener('click', () => hideModal(btn.dataset.modalId));
        });

        profile };
            updateUserInterface();
            initCharts();
            
            await loadUserErrors();
            document.addEventListener('click', e => {
            if (!e.target.closest('.notification-bell')) {await Promise.all([
                loadUserPerformance(),
                loadNotifications()
            ]);

            initRealtimeSubscriptions();
 document.getElementById('notification-dropdown').classList.remove('show'); }
            if (e.target.classList            showToast('Dashboard loaded successfully!', 'success');
        } catch (error) {
            console.error.contains('modal-overlay')) { e.target.classList.remove('show'); }
        });

        const('Error initializing app:', error);
            showToast('Failed to load dashboard', 'error');
        }
     globalSearch = document.getElementById('global-search');
        globalSearch.addEventListener('input', e => {
}

    function updateUserInterface() {
        if (!currentUser) return;
        
        document.getElementById('            const searchTerm = e.target.value.trim().toLowerCase();
            document.getElementById('my-errors-sidebar-avatar-initials').textContent = getInitials(currentUser.name);
        document.getElementById('sidebar-search').value = searchTerm;
            document.getElementById('apply-my-errors-filters').click();
        username').textContent = currentUser.name;
        document.getElementById('sidebar-userrole').textContent = currentUser.role});
    }

    document.addEventListener('DOMContentLoaded', () => {
        initApp();
        setupEventListeners;
        
        const firstName = currentUser.name.split(' ')[0];
        document.getElementById('welcome-user();
        setupFilters();
        setupPaginationListeners();
    });
</script>

<style>
    :-h2').textContent = `Welcome back, ${firstName}!`;
        
        document.getElementById('profile-root {
        --primary-color: #00bfff;
        --primary-hover: #00fullname').value = currentUser.name;
        document.getElementById('profile-email').value = currentUser.email;
        documenta4d9;
        --bg-color: #121212;
        --sidebar.getElementById('profile-phone').value = currentUser.phone || '';
        document.getElementById('profile-department').value = currentUser-bg: #1a1a1a;
        --card-bg: #1a1a1a;
.department || 'N/A';
    }

    async function loadUserErrors(filters = {}) {
        try {        --text-color: #e6edf3;
        --text-muted: #8b949
            const errors = await getAgentErrors(currentUser.id, filters);
            userErrors = errors || [];
            e;
        --border-color: #333;
        --red: #dc354filteredUserErrors = [...userErrors]; // Initialize filtered list
            dashboardCurrentPage = 1;
            myErrorsCurrentPage5;
        --red-bg: rgba(220, 53, 69, 0 = 1;
            renderErrorTables();
        } catch (error) {
            console.error('.1);
        --green: #28a745;
        --green-bg: rgba(Error loading user errors:', error);
            showToast('Failed to load your errors', 'error');
            userErrors = [];
            filteredUserErrors = [];
            renderErrorTables();
        }
    }

    async function load40, 167, 69, 0.1);
        --yellow: #ffUserPerformance() {
        try {
            const totalErrors = userErrors.length;
            const totalOrdersc107;
        --yellow-bg: rgba(255, 193, 7 = 20; // This should ideally come from the backend
    
            const errorRate = totalOrders > 0, 0.1);
        --border-radius-base: 0.75rem;
    } ? ((totalErrors / totalOrders) * 100).toFixed(1) : 0;
            

    * { margin: 0; padding: 0; box-sizing: border-box; }
    html            document.getElementById('error-rate').textContent = `${errorRate}%`;
            document.getElementById('error-rate- { scroll-behavior: smooth; }
    body { font-family: 'Poppins', sans-serif; background-color:bar').style.width = `${Math.min(errorRate, 100)}%`;
            document.getElementById('error-rate-description').textContent = 
                `Based on ${totalErrors} errors out of ${totalOrders var(--bg-color); color: var(--text-color); display: flex; min-height: 100vh; line-height: 1.6; font-size: 16px; }
    .sidebar {} reviewed orders.`;
    
            const errorTypes = {};
            userErrors.forEach(error => {
 width: 260px; background-color: var(--sidebar-bg); height: 100vh; position: fixed; left: 0; top: 0; border-right: 1px solid var(--border-color                const type = error.error_details || 'Unknown';
                errorTypes[type] = (errorTypes[type] || 0) + 1;
            });
            userPerformance.errorTypes = errorTypes;
            ); display: flex; flex-direction: column; z-index: 1000; }
    
            updateCharts();
        } catch (error) {
            console.error('Error loading user performance:',.sidebar-header { display: flex; align-items: center; gap: 10px; padding: 2 error);
            document.getElementById('error-rate').textContent = 'N/A';
        }
    }

    function renderErrorTables() {
        renderPaginatedTable('error-table-body', userErrors, dashboard0px; border-bottom: 1px solid var(--border-color); }
    .sidebar-logo { heightCurrentPage, 'dashboard-pagination');
        renderPaginatedTable('my-errors-table-body', filteredUserErrors,: 32px; fill: var(--primary-color); }
    .sidebar-title { font-size:  myErrorsCurrentPage, 'my-errors-pagination');
    }
    
   function renderPaginatedTable(tbody1.25rem; color: var(--primary-color); font-weight: 700; }
    .sidebar-nav-container { flex-grow: 1; overflow-y: auto; padding-top: Id, data, currentPage, paginationId) {
    const tbody = document.getElementById(tbodyId);
    const1rem; }
    .nav-group { margin-bottom: 1.5rem; padding: 0 2 paginationControls = document.getElementById(paginationId);
    
    if (!tbody || !paginationControls) return;

    0px; }
    .nav-group-title { font-size: 0.75rem; textconst startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
    const endIndex = startIndex + ITEMS_PER_PAGE;
    const paginatedData = data.slice(startIndex, endIndex);
    const totalPages = Math-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 600; margin-bottom: 0.75rem; }
    .sidebar.ceil(data.length / ITEMS_PER_PAGE);

    if (data.length === 0) {-nav { list-style: none; padding: 0; margin: 0; }
    .sidebar-nav
        tbody.innerHTML = `
            <tr>
                <td colspan="5" class="empty-state">
                     a { display: flex; align-items: center; padding: 12px 15px; border-<div class="empty-state-icon">✅</div>
                    <div>No errors found.</div>
                    <small>Greatradius: 8px; color: var(--text-muted); text-decoration: none; margin-bottom:  job maintaining quality standards!</small>
                </td>
            </tr>`;
        paginationControls.style.display = '10px; transition: all 0.3s ease; gap: 15px; cursor: pointer; fontnone';
    } else {
        tbody.innerHTML = paginatedData.map(error => {
            -weight: 500; }
    .sidebar-nav a:hover, .sidebar-nav aconst orderId = error.order_id || 'N/A';
            const orderDate = error.created.active { background-color: var(--primary-color); color: #000; transform: translateX(5_at;
            const errorType = error.error_details || 'Unknown';
            const status = error.status.px); }
    .sidebar-footer { padding: 15px 20px; border-top: 1replace(/_/g, ' ');

            // --- START: NEW & IMPROVED BUTTON LOGIC ---
            let actionpx solid var(--border-color); }
    .user-profile-widget { display: flex; align-items: centerButtons = '';
            
            // Check if a final decision exists
            if (error.final_decision) {
                ; gap: 12px; }
    .avatar-initials { width: 44px; height// If decision exists, show only "View Decision" button
                actionButtons = `<button class="action-btn view-: 44px; border-radius: 50%; background-color: var(--primary-color); color: blackerror-btn" data-error-id="${error.error_id}">👁️ View Decision</button>`;
            } else; font-weight: 700; font-size: 1rem; display: inline-flex; align-items if (error.status === 'under_review') {
                // If under review, show only a "View" button: center; justify-content: center; }
    .user-name { font-weight: 600 (appeal is already submitted)
                actionButtons = `<button class="action-btn view-error-btn" data-error; font-size: 1rem; }
    .user-role { font-size: 0.8rem-id="${error.error_id}">👁️ View</button>`;
            } else if (error.status; color: var(--text-muted); }
    .main-content { margin-left: 260px === 'closed') {
                // If closed and no decision yet, allow appeal
                const viewButton = `<button class; width: calc(100% - 260px); padding: 30px; display: flex;="action-btn view-error-btn" data-error-id="${error.error_id}">👁️ flex-direction: column; }
    .content-wrapper { flex: 1; }
    .tab-content { View</button>`;
                const appealButton = `<button class="action-btn warning appeal-error-btn" data-error-id="${error.error_id}">Appeal</button>`;
                actionButtons = viewButton + display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.5s appealButton;
            } else {
                // Fallback for any other statuses
                actionButtons = `<button class; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to="action-btn view-error-btn" data-error-id="${error.error_id}">👁️ { opacity: 1; transform: translateY(0); } }
    header { display: flex; justify-content: space View</button>`;
            }
            // --- END: NEW & IMPROVED BUTTON LOGIC ---
            
            return -between; align-items: center; margin-bottom: 20px; gap: 1rem; }
`
                <tr>
                    <td><strong>${orderId}</strong></td>
                    <td>${formatDate(orderDate)}</td>
    .header-left { flex-grow: 1; }
    .header-actions { display: flex; align-items: center; gap: 1rem; }
    .page-title { font-size: 2                    <td>${errorType}</td>
                    <td><span class="status-badge status-${error.status}">${status}</span></td>
                    <td class="action-buttons">${actionButtons}</td>
                </tr>
            `;
        4px; font-weight: 700; }
    #welcome-message { margin-bottom: 3}).join('');

        paginationControls.style.display = 'flex';
        paginationControls.querySelector('.page-info').textContent0px; }
    #welcome-message h2 { font-size: 1.75rem; = `Page ${currentPage} of ${totalPages}`;
        paginationControls.querySelector('.prev-btn').disabled = currentPage font-weight: 700; margin-bottom: 0.5rem; }
    #welcome === 1;
        paginationControls.querySelector('.next-btn').disabled = currentPage === totalPages;
    }
}
    
    function setupPaginationListeners() {
        document.getElementById('dashboard-pagination').addEventListener('click-message p { color: var(--text-muted); }
    .stats-grid { display: grid; grid', e => {
            if (e.target.classList.contains('prev-btn') && dashboardCurrentPage-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2 > 1) {
                dashboardCurrentPage--;
                renderPaginatedTable('error-table-body', userErrors0px; margin-bottom: 30px; }
    .card { background: var(--card-bg); padding, dashboardCurrentPage, 'dashboard-pagination');
            } else if (e.target.classList.contains(': 25px; border-radius: var(--border-radius-base); border: 1px solid var(--bordernext-btn')) {
                 const totalPages = Math.ceil(userErrors.length / ITEMS_PER_-color); transition: transform 0.3s ease, box-shadow 0.3s ease; }
PAGE);
                if (dashboardCurrentPage < totalPages) {
                    dashboardCurrentPage++;
                    renderPaginatedTable('    .card:hover { transform: translateY(-2px); box-shadow: 0 8px 2error-table-body', userErrors, dashboardCurrentPage, 'dashboard-pagination');
                }
            }5px rgba(0, 0, 0, 0.3); }
    .card h3
        });

        document.getElementById('my-errors-pagination').addEventListener('click', e => {
            if ( { font-size: 18px; font-weight: 600; margin-bottom: 20pxe.target.classList.contains('prev-btn') && myErrorsCurrentPage > 1) {
                myErrorsCurrentPage--;
                renderPaginatedTable('my-errors-table-body', filteredUserErrors,; }
    .progress-card .progress-info { display: flex; justify-content: space-between; align myErrorsCurrentPage, 'my-errors-pagination');
            } else if (e.target.classList.-items: center; margin-bottom: 10px; }
    .progress-card .progress-contains('next-btn')) {
                const totalPages = Math.ceil(filteredUserErrors.length / ITEMS_PERvalue { font-size: 24px; font-weight: 600; }
    ._PAGE);
                if (myErrorsCurrentPage < totalPages) {
                    myErrorsCurrentPage++;
progress-bar { width: 100%; height: 10px; background-color: #2c                    renderPaginatedTable('my-errors-table-body', filteredUserErrors, myErrorsCurrentPage, '2c2c; border-radius: 5px; overflow: hidden; margin-top: 10px; }my-errors-pagination');
                }
            }
        });
    }
    
    function open
    .progress-bar-inner { height: 100%; border-radius: 5px; transition: width 0.3s ease; }
    .chart-container { position: relative; height: 2ViewErrorModal(errorId) {
        // *** FIXED: Finding error by `error_id` to match the data attribute50px; }
    .table-container { background: var(--card-bg); padding: 2 in the button ***
        const error = userErrors.find(e => String(e.error_id) ===0px; border-radius: var(--border-radius-base); border: 1px solid var(--border String(errorId));
        if (!error) {
            console.error("Error not found for ID:", errorId-color); overflow-x: auto; }
    .table-container h3 { margin-bottom: 25);
            showToast('Could not find error details.', 'error');
            return;
        }
    
        documentpx; }
    table { width: 100%; border-collapse: collapse; min-width: 6.getElementById('view-error-id').textContent = error.order_id || 'N/A';
        00px; }
    th, td { padding: 15px; text-align: left; border-bottom
        let contentHtml = `
            <div class="detail-item"><strong>Order ID</strong><p>${: 1px solid var(--border-color); vertical-align: middle; }
    th { font-weight: 600; font-size: 14px; color: var(--text-muted); text-error.order_id || 'N/A'}</p></div>
            <div class="detail-item"><strong>Datetransform: uppercase; background-color: #2c2c2c; }
    tbody tr:last-child td Recorded</strong><p>${formatDate(error.created_at)}</p></div>
            <div class="detail-item { border-bottom: none; }
    tbody tr:hover { background-color: #2c2c"><strong>Error Type</strong><p>${error.error_details || 'Unknown'}</p></div>
            <2c; }
    .status-badge { padding: 5px 12px; border-radius: div class="detail-item"><strong>Status</strong><p><span class="status-badge status-${error.status}">${error.status.replace(/_/g, ' ')}</span></p></div>
        `;

        if (error.20px; font-size: 12px; font-weight: 600; display: inline-blockfinal_decision) {
            const decisionClass = error.final_decision === 'overturned' ? 'status-overturned; text-transform: capitalize; }
    .status-pending, .status-under_review, .status-pending' : 'status-closed';
            contentHtml += `
                <hr style="border-color: var_response { background-color: var(--yellow-bg); color: var(--yellow); }
    .status-respon(--border-color); margin: 1.5rem 0;">
                <div class="detail-itemded, .status-overturned { background-color: var(--green-bg); color: var(--green); }
    .status-finalized, .status-closed { background-color: var(--red-bg); color: var(--red); }
    .action-buttons { display: flex; gap: 8px; flex-" style="background-color: #222;">
                    <strong>Senior's Final Decision</strong>
                    <p style="font-size: 1.1rem; margin-top: 0.5rem;"><span class="status-badge ${decisionClass}">${error.final_decision}</span> by ${error.decided_by_name || 'Seniorwrap: wrap; }
    .action-btn { background: #333; border: none; cursor'}</p>
                    <small style="color: var(--text-muted);">${formatDateTime(error.decided_: pointer; color: var(--text-color); font-size: 14px; padding: 10pxat)}</small>
                </div>
                <div class="detail-item">
                    <strong>Senior's Notes 18px; border-radius: 6px; transition: all 0.3s ease; white-space:</strong>
                    <p style="white-space: pre-wrap; color: var(--text-muted);">${error.decision_notes || 'No notes provided.'}</p>
                </div>
            `;
        } else if (error nowrap; }
    .action-btn:hover { background: #444; transform: translateY(-1.status === 'under_review') {
             contentHtml += `<hr style="border-color: var(--border-colorpx); }
    .action-btn.warning { background-color: var(--yellow-bg); color: var(--yellow); }
    .action-btn.warning:hover { background-color: rgba(255, 19); margin: 1rem 0;"><p style="color: var(--text-muted); padding: 1rem 3, 7, 0.2); }
    .search-input-container input[type="search"] { background: #2c2c2c; border: 1px solid var(--border-color); border0;">Your appeal is currently under review by a senior quality analyst.</p>`;
        }
        
        document.-radius: 8px; color: var(--text-color); padding: 10px 12getElementById('view-error-body').innerHTML = contentHtml;
        showModal('view-error-modal');
    }

    async function handleResponseSubmission() {
        const btn = document.getElementById('submit-responsepx; width: 250px; transition: border-color 0.3s ease; }
    .search-input-container input[type="search"]:focus { border-color: var(--primary-color);-btn');
        const errorId = btn.dataset.errorId;
        const responseText = document.getElementById('error outline: none; }
    .notification-bell { position: relative; }
    .notification-btn {-response').value.trim();
        
        if (!responseText) {
            showToast('Please enter your response before background: none; border: none; color: var(--text-muted); font-size: 24px submitting', 'warning');
            return;
        }

        btn.disabled = true;
        btn.textContent; cursor: pointer; padding: 5px; position: relative; transition: color 0.3s ease; = 'Submitting...';
        try {
            await submitErrorResponse(errorId, currentUser.id, response }
    .notification-btn:hover { color: var(--primary-color); }
    .notification-badge { positionText);
            showToast('Your response has been submitted successfully!', 'success');
            hideModal('reply-error-modal');
            await loadUserErrors();
            await loadUserPerformance();
        } catch (error) {
: absolute; top: 0px; right: 0px; background: var(--red); color: white; border            console.error('Error submitting response:', error);
            showToast('Failed to submit your response. Please try-radius: 50%; width: 18px; height: 18px; font-size:  again.', 'error');
        } finally {
            btn.disabled = false;
            btn.textContent =10px; display: flex; align-items: center; justify-content: center; border: 2px solid var(--card-bg); }
    .notification-dropdown { display: none; position: absolute; right 'Submit Response';
        }
    }

    async function loadNotifications() {
        try {
            : 0; top: 120%; background: var(--card-bg); border: 1pxnotifications = await getNotifications(currentUser.id) || [];
            updateNotificationsUI();
        } catch (error) solid var(--border-color); border-radius: var(--border-radius-base); width: 350px; box-shadow: 0 8px 16px rgba(0,0,0, {
            console.error('Error loading notifications:', error);
            notifications = [];
            updateNotificationsUI();
        0.3); z-index: 10; }
    .notification-dropdown.show { display: block; animation: slideDown 0.3s ease; }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .notification-header { padding: 1rem; border-bottom: 1px solid var}
    }

    function updateNotificationsUI() {
        const list = document.getElementById('notification-list');
        const badge = document.getElementById('notification-badge');
        const unreadCount = notifications.filter(n => !n.is_read).length;

        badge.textContent = unreadCount;
        badge.style.display = unreadCount > 0 ? 'flex' : 'none';

        if (notifications.length === (--border-color); font-weight: 600; display: flex; justify-content: space-between;0) {
            list.innerHTML = '<li class="notification-item empty">No new notifications</li>';
        } align-items: center; }
    .notification-list { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; }
    .notification-item { padding: 1rem; border-bottom: 1px solid var(--border-color); font-size: 14px; display: flex; justify-content: space-between; align-items: flex-start; else {
            list.innerHTML = notifications.map(n => `
                <li class="notification-item ${n.is_read ? 'read' : 'unread'}" data-notification-id="${n.id}">
                    <div class="notification-message">
                        <div class="notification-text">${n.message}</div>
                        <div class="notification-time">${formatDateTime(n.created_at)}</div>
                    </div>
                    ${!n.is_read transition: background-color 0.3s ease; }
    .notification-item:hover { background-color: #2c2c2c; }
    .notification-item:last-child { border-bottom: none ? `<button class="mark-read-btn" data-notification-id="${n.id}" title="Mark as read">✓</button>` : ''}
                </li>
            `).join('');
            
            list.querySelectorAll('.mark; }
    .notification-item.read { opacity: 0.6; }
    .notification--read-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    const notificationId = btn.dataset.notificationId;
                    btn.disabled = true;
                    item.empty { justify-content: center; text-align: center; color: var(--text-muted); }try {
                        await markNotificationAsRead(notificationId);
                        await loadNotifications();
                    } catch (error) {
                        console.error('Error marking notification as read:', error);
                    }
                });
            });
    .notification-message { flex: 1; }
    .notification-time { font-size: 12px; color: var(--text-muted); }
    .mark-read-btn { background: none; border: none; color: var(--primary-color); cursor: pointer; font-size: 
        }
    }

    function initRealtimeSubscriptions() {
        if (typeof subscribeToNotifications === 'function') {
            subscribeToNotifications(currentUser.id, (payload) => {
                if (payload.new14px; padding: 4px 8px; border-radius: 4px; transition: background-color && payload.new.user_id === currentUser.id) {
                    showToast(payload.new.message, 'info 0.3s ease; }
    .mark-read-btn:hover { background-color: rgba(0, 191, 255, 0.1); }
    .filter-panel', 'New Notification');
                    loadNotifications();
                }
            });
        }

        if (typeof subscribeTo { display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; paddingErrors === 'function') {
            subscribeToErrors(currentUser.id, (payload) => {
                if: 20px; background: #222; border-radius: var(--border-radius-base); margin (payload.new && payload.new.employee_id === currentUser.id) {
                    showToast('A-bottom: 30px; border: 1px solid var(--border-color); }
    . new error has been logged for you', 'warning', 'New Error');
                    loadUserErrors();
                    loadUserPerformance();filter-group { flex: 1; min-width: 150px; }
    .filter-group
                }
            });
        }
    }

    function initCharts() {
        Chart.defaults label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 14px; }
    .filter-group input, .filter-group select { width: 10.font.family = "'Poppins', sans-serif";
        const ctx = document.getElementById('commonErrorsChart').getContext0%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8('2d');
        commonErrorsChart = new Chart(ctx, {
            type: 'doughnut',
            px; font-family: 'Poppins'; background: #2c2c2c; color: #fff; }
    .btn { padding: 12px 22px; border: none; border-radius: 8px; cursordata: {
                labels: ['No Errors Yet'],
                datasets: [{ data: [1], backgroundColor: ['#333'], borderWidth: 2, borderColor: '#1a1a1a' }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {: pointer; font-weight: 600; transition: all 0.3s ease; font-family: 'Poppins'; }
    .btn:disabled { background-color: #555 !important; cursor: not-allowed position: 'bottom', labels: { color: '#e6edf3', font: { family: 'Poppins', size:; opacity: 0.6; }
    .btn-primary { background: var(--primary-color); color: #000; }
    .btn-primary:hover:not(:disabled) { background: var(--primary 14 } } },
                    tooltip: { backgroundColor: 'rgba(26, 26, 26, 0.9)', titleColor: '#00bfff', bodyColor: '#e6edf3', borderColor: '#333', borderWidth: 1, titleFont: { family: 'Poppins', size: 14, weight-hover); }
    .btn-secondary { background: #333; color: white; }
    .btn: 'bold' }, bodyFont: { family: 'Poppins', size: 12 } }
                },
                cutout: '60%'
            }
        });
    }

    function updateCharts() {
-secondary:hover:not(:disabled) { background: #444; }
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index:         if (!commonErrorsChart) return;
        
        const labels = Object.keys(userPerformance.errorTypes1001; display: none; justify-content: center; align-items: center; backdrop-filter: blur);
        const data = Object.values(userPerformance.errorTypes);
        
        if (labels.length > (5px); padding: 20px; }
    .modal-overlay.show { display: flex; animation: fadeIn 0.3s ease; }
    .modal-box { background: var(--card-bg); padding: 2.5rem; border-radius: var(--border-radius-base); border: 1px solid var(--border-color); width: 90%; max-width: 550px;0) {
            commonErrorsChart.data.labels = labels;
            commonErrorsChart.data.datasets[0].data = data;
            commonErrorsChart.data.datasets[0].backgroundColor = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'];
        } else {
            commonErrorsChart.data.labels = ['No Errors'];
            commonErrorsChart.data.datasets[0].data = [1];
             box-shadow: 0 10px 30px rgba(0,0,0,0.commonErrorsChart.data.datasets[0].backgroundColor = ['#333'];
        }
        common5); max-height: 90vh; overflow-y: auto; }
    .modal-header { displayErrorsChart.update();
    }
    
    // *** THIS IS THE SEARCH/FILTER LOGIC FROM THE: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1.5rem; margin-bottom: 1.5rem; }
    .modal-title { font-size: 1.25rem; font-weight:  OLD VERSION ***
    function setupFilters() {
        // Apply filters for dashboard
        document.getElementById('apply700; }
    .modal-close-btn { background: none; border: none; color: var(--text-filters-btn').addEventListener('click', () => {
            const orderId = document.getElementById('filter-order-muted); font-size: 1.5rem; cursor: pointer; padding: 5px; border-radius: 4px; transition: background-color 0.3s ease; }
    .modal--id').value;
            const fromDate = document.getElementById('filter-from-date').value;
            constclose-btn:hover { background-color: #2c2c2c; }
    .detail- toDate = document.getElementById('filter-to-date').value;
            
            loadUserErrors({
                order_id: orderId,
                from_date: fromDate,
                to_date: toDate
item { background: #2c2c2c; padding: 1rem; border-radius: 8px; margin            });
            
            showToast('Filters applied', 'success');
        });
        
        // Reset-bottom: 1rem; }
    .detail-item strong { display: block; color: var(--primary-color filters for dashboard
        document.getElementById('reset-filters-btn').addEventListener('click', () => {
            document); font-size: 0.8rem; text-transform: uppercase; margin-bottom: 0.5rem.getElementById('filter-order-id').value = '';
            document.getElementById('filter-from-date').value = '';
            document.getElementById('filter-to-date').value = '';
            loadUserErrors();; letter-spacing: 0.5px; }
    .modal-footer { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; }
    .form-group { margin-bottom: 1.5rem; }
    .form-group label { display
            showToast('Filters reset', 'info');
        });
        
        // Apply filters for my errors
        : block; font-weight: 500; margin-bottom: 0.5rem; }
document.getElementById('apply-my-errors-filters').addEventListener('click', () => {
            const search = document.getElementById    .form-group input, .form-group textarea, .form-group select { width: 100%; background('my-errors-search').value;
            const status = document.getElementById('my-errors-status').value;: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 10px 12px; font
            
            const filters = {};
            if (search) filters.search = search;
            if (status !== 'all') filters.status = status;
            
            loadUserErrors(filters);
            showToast('Filters-family: 'Poppins'; transition: border-color 0.3s ease; }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(-- applied', 'success');
        });
        
        // Reset filters for my errors
        document.getElementById('reset-my-errors-filters').addEventListener('click', () => {
            document.getElementById('my-errorsprimary-color); outline: none; }
    .form-group textarea { min-height: 120px-search').value = '';
            document.getElementById('my-errors-status').value = 'all';
; resize: vertical; }
    .page-actions { display: flex; justify-content: flex-end; gap            loadUserErrors();
            showToast('Filters reset', 'info');
        });
    }

    function setupEventListeners: 1rem; margin-top: 1.5rem; border-top: 1px solid var() {
        document.querySelectorAll('.sidebar-nav a[data-tab]').forEach(tab => {
            (--border-color); padding-top: 1.5rem; }
    .settings-layout { display: flex; gap: 2rem; }
    .settings-nav { flex: 0 0 200px; }
    .settings-nav ul { list-style: none; padding: 0; }
    .tab.addEventListener('click', e => {
                e.preventDefault();
                document.querySelectorAll('.sidebar-nav a').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const tabId = tab.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(c => csettings-nav a { display: block; padding: 0.75rem 1rem; text-decoration: none.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
                document.getElementById('page-title-header').textContent = tab.textContent.replace(/[^\w\s]/gi; color: var(--text-muted); border-radius: 8px; font-weight: 500; margin-bottom: 5px; transition: all 0.3s ease; }
    .settings-nav a:, '').trim();
            });
        });

        document.querySelectorAll('.settings-nav a').forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                document.querySelectorAllhover, .settings-nav a.active { background-color: #2c2c2c; color: var(--text('.settings-nav a').forEach(a => a.classList.remove('active'));
                link.classList.-color); }
    .settings-content { flex-grow: 1; }
    .setting-add('active');
                const sectionId = link.dataset.section;
                document.querySelectorAll('.setting-card').forEachcard { background-color: #222; padding: 1.5rem; border-radius: var(--border-(s => s.style.display = 'none');
                document.getElementById(`settings-section-${sectionId}`).styleradius-base); }
    .setting-item { display: flex; justify-content: space-between;.display = 'block';
            });
        });

        document.querySelector('.main-content').addEventListener(' align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--border-color); }
    .setting-item:last-child { border-bottom: none; }
    .toggleclick', (e) => {
            const viewBtn = e.target.closest('.view-error-btn');
            const appealBtn = e.target.closest('.appeal-error-btn');

            if (viewBtn) {-switch .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
    .toggle-switch .switch input { opacity: 0; width: 0; height: 0
                openViewErrorModal(viewBtn.dataset.errorId);
            } else if (appealBtn); }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0 {
                const errorId = appealBtn.dataset.errorId;
                const modal = document.getElementById('appeal-error-modal');
                if (modal) {
                    modal.querySelector('#appeal-reason').value = '';; right: 0; bottom: 0; background-color: #3c3c3c; transition: .4s; border-radius: 24px; }
    .slider:before { position: absolute; content
                    modal.querySelector('#submit-appeal-btn').dataset.errorId = errorId;
                    showModal('appeal-error-modal');
                }
            }
        });
        
        document.getElementById('notification-btn').addEventListener('click', e => { e.stopPropagation(); document.getElementById('notification-dropdown').classList.toggle('show: ""; height: 16px; width: 16px; left: 4px; bottom: 4px'); });
        
        document.getElementById('mark-all-read-btn').addEventListener('click', async e => {
; background-color: white; transition: .4s; border-radius: 50%; }
    input            e.stopPropagation();
            const unread = notifications.filter(n => !n.is_read);:checked + .slider { background-color: var(--primary-color); }
    input:checked + .slider
            if (unread.length === 0) return showToast('No unread notifications', 'info');
:before { transform: translateX(20px); }
    .toast-container { position: fixed; top            try {
                await Promise.all(unread.map(n => markNotificationAsRead(n.id)));
                await loadNotifications();
                showToast('All notifications marked as read', 'success');
            } catch (error: 20px; right: 20px; z-index: 9999; }
    .toast { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-base); padding: 15px 20px; margin-bottom: ) { showToast('Failed to mark all as read', 'error'); }
        });
        
        document10px; box-shadow: 0 4px 12px rgba(0,0,0.getElementById('submit-response-btn').addEventListener('click', handleResponseSubmission);
        
        document.getElementById('submit,0.3); display: flex; align-items: center; gap: 10px; max-width:-appeal-btn').addEventListener('click', async function() {
            const btn = this;
            const errorId = btn 350px; animation: slideInRight 0.3s ease; }
    .toast.success.dataset.errorId;
            const reason = document.getElementById('appeal-reason').value.trim();
 { border-left: 4px solid var(--green); }
    .toast.error { border-left:             if (!reason) { showToast('Please provide a reason for your appeal.', 'warning'); return; }

            btn.disabled = true; btn.textContent = 'Submitting...';
            try {
                const { error: response4px solid var(--red); }
    .toast.warning { border-left: 4px solid var(--yellow); }
    .toast.info { border-left: 4px solid var(--primary-color); }Error } = await supabase.from('error_responses').insert({
                    error_id: errorId,
                    
    .toast-icon { font-size: 20px; }
    .toast-content { flex: 1; }
    .toast-title { font-weight: 600; margin-bottom: response_by_id: currentUser.id,
                    response_text: reason,
                    response_type: 'appeal'
                });
                if(responseError) throw responseError;
                
                const { error } = await supabase.5px; }
    .toast-message { font-size: 14px; color: var(--from('errors').update({ status: 'under_review' }).eq('id', errorId);
                if (errortext-muted); }
    .toast-close { background: none; border: none; color: var(--) throw error;
                
                showToast('Appeal submitted successfully!', 'success');
                hideModal('appealtext-muted); cursor: pointer; font-size: 18px; padding: 0; width: 24-error-modal');
                await loadUserErrors();

            } catch (error) {
                console.px; height: 24px; display: flex; align-items: center; justify-content: centererror('Error submitting appeal:', error);
                showToast('Failed to submit appeal.', 'error');
            } finally {
                btn.disabled = false; btn.textContent = 'Submit Appeal';
            }
        });
        ; border-radius: 4px; transition: background-color 0.3s ease; }
    .toast-close:hover { background-color: #2c2c2c; }
    @keyframes slideInRight
        document.getElementById('save-profile-btn').addEventListener('click', async () => {
            const name = document { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0.getElementById('profile-fullname').value.trim();
            const phone = document.getElementById('profile-phone').); opacity: 1; } }
    .empty-state { text-align: center; padding: value.trim();
            if (!name) return showToast('Please enter your name', 'warning');
            try {
40px; color: var(--text-muted); }
    .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    .site-                await updateUserProfile(currentUser.id, { name, phone });
                currentUser = { ...currentUser, name, phone };
                updateUserInterface();
                showToast('Profile updated successfully!', 'success');
            } catch (errorfooter { text-align: center; padding: 20px; color: var(--text-muted); font) { showToast('Failed to update profile', 'error'); }
        });
        
        document.getElementById-size: 0.9rem; border-top: 1px solid var(--border-color); flex('logout-btn').addEventListener('click', () => {
            showConfirmationModal({
                title: 'Logout', message: 'Are you sure you want to logout?', confirmText: 'Logout',
                onConfirm: async () => {
-shrink: 0; margin-top: auto; }
    .placeholder-content { display: flex; flex                    try { await supabase.auth.signOut(); window.location.href = 'login.html'; } catch (error) {-direction: column; justify-content: center; align-items: center; text-align: center; min-height: 200px; }
    .pagination-controls { display: flex; justify-content: flex showToast('Error during logout', 'error'); }
                }
            });
        });

        document.getElementById('change-password-btn').addEventListener('click', () => { showModal('change-password-modal'); });
        document.querySelectorAll('.setting-item .toggle-switch input').forEach(toggle => {
            toggle.addEventListener('-end; align-items: center; gap: 1rem; margin-top: 1.5rem; }
    .pagination-controls .btn { padding: 8px 16px; }
    .pagination-controls .page-info { font-size: 0.9rem; color: var(--text-mutedchange', () => {
                const label = toggle.closest('.setting-item').querySelector('span').textContent;); }
    @media (max-width: 768px) {
        body { flex-direction: column
                const status = toggle.checked ? 'enabled' : 'disabled';
                showToast(`${label} ${status}.`, 'success', 'Setting Updated');
            });
        });
        
        document.querySelectorAll('.modal; }
        .sidebar { width: 100%; height: auto; position: relative; }
        .main-content { margin-left: 0; width: 100%; padding: 20px; }
        .stats-grid { grid-template-columns: 1fr; }
        .filter--close-btn').forEach(btn => {
            btn.addEventListener('click', () => hideModal(btn.dataset.modalId));
        });

        document.addEventListener('click', e => {
            if (!e.panel { flex-direction: column; }
        .filter-group { min-width: 100%;target.closest('.notification-bell')) { document.getElementById('notification-dropdown').classList.remove('show'); }
            if (e.target.classList.contains('modal-overlay')) { e.target.classList.remove('show }
        .settings-layout { flex-direction: column; }
        .settings-nav { flex: none; }
        .notification-dropdown { width: 300px; right: -50px; }'); }
        });

        const globalSearch = document.getElementById('global-search');
        globalSearch.
        .site-footer { margin-left: 0; }
    }
</style>

</addEventListener('input', e => {
            const searchTerm = e.target.value.trim().toLowerCase();
            head>
<body>
    <aside class="sidebar">
        <div>
            <div class="sidebar-header">document.getElementById('my-errors-search').value = searchTerm;
            document.getElementById('apply-my-
                <svg class="sidebar-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10errors-filters').click();
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        initApp();
        setupEventListeners();
        setupFilters();
        setupPaginationListeners();
    });
</script>

<style>
    :root {
        --primary-color: #00bfff;
        --primary-hover: #00a4d9;
        --bg-color: #12121 5 10-5-10-5-10 5z" stroke="#FFF" stroke2;
        --sidebar-bg: #1a1a1a;
        --card-bg: #-width="1" stroke-linecap="round" stroke-linejoin="round" fill-opacity="0.3"></path><path d="M12 22V12" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <h1 class="sidebar-title1a1a1a;
        --text-color: #e6edf3;
        --text-muted: #8b949e;
        --border-color: #333;
        --red: #dc3545;
        --red-bg: rgba(220, 5">QualityX</h1>
            </div>
            <div class="sidebar-nav-container">
                <div class="nav-group"><h2 class="nav-group-title">Menu</h2><ul class="sidebar-nav"><li>3, 69, 0.1);
        --green: #28a745;
        --green-bg: rgba(40, 167, 69, 0.1);
        --yellow: #ffc107;
        --yellow-bg: rgba(255,<a class="active" data-tab="dashboard"><span>📊</span>Dashboard</a></li><li><a data-tab="my-errors"><span>❌</span>My Errors</a></li></ul></div>
                <div class="nav-group"><h2 193, 7, 0.1);
        --border-radius-base: 0.75rem;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body { font-family: 'Poppins', sans-serif; background-color: var(--bg-color); color: var(--text-color); display: flex; min class="nav-group-title">Account</h2><ul class="sidebar-nav"><li><a data-tab="profile"><span>👤</span>Profile</a></li><li><a data-tab="settings"><span>⚙️</span>Settings</a>-height: 100vh; line-height: 1.6; font-size: 1</li><li><a data-tab="help"><span>❓</span>Get Help</a></li><li><a id="logout-btn6px; }
    .sidebar { width: 260px; background-color: var(--sidebar-bg"><span>🚪</span>Logout</a></li></ul></div>
            </div>
        </div>
        <div class="sidebar-footer">
            ); height: 100vh; position: fixed; left: 0; top: 0; border<div class="user-profile-widget"><div class="avatar-initials" id="sidebar-avatar-initials">-right: 1px solid var(--border-color); display: flex; flex-direction: column; z--</div><div><div class="user-name" id="sidebar-username">Loading...</div><div class="user-index: 1000; }
    .sidebar-header { display: flex; align-items: center; gap: 10px; padding: 20px; border-bottom: 1px solid var-role" id="sidebar-userrole">Loading...</div></div></div>
        </div>
    </aside>

    <main class="main-content">
    <div class="content-wrapper">
        <header>
            <div(--border-color); }
    .sidebar-logo { height: 32px; fill: var(--primary class="header-left"><h2 class="page-title" id="page-title-header">Dashboard</h2></div>
-color); }
    .sidebar-title { font-size: 1.25rem; color: var(--primary            <div class="header-actions">
                <div class="search-input-container"><input type="search" id-color); font-weight: 700; }
    .sidebar-nav-container { flex-grow: ="global-search" placeholder="Search my errors..."></div>
                <div class="notification-bell">
                    1; overflow-y: auto; padding-top: 1rem; }
    .nav-group { margin-bottom: 1.5rem; padding: 0 20px; }
    .nav-group-title<button id="notification-btn" class="notification-btn"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0  { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.0524 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" strokeem; color: var(--text-muted); font-weight: 600; margin-bottom: 0.75rem; }
    .sidebar-nav { list-style: none; padding: 0;-linejoin="round"><path d="M18 8A6 6 0 0 0 6  margin: 0; }
    .sidebar-nav a { display: flex; align-items: center; padding8c0 7-3 9-3 9h18s-3-2-3-: 12px 15px; border-radius: 8px; color: var(--text-muted); text9"/><path d="M13.73 21a2 2 0 0 1-3.-decoration: none; margin-bottom: 10px; transition: all 0.3s ease; gap: 15px; cursor: pointer; font-weight: 500; }
    .sidebar-nav a:hover, .sidebar-nav a.active { background-color: var(--primary-color); color: #000; transform: translateX(5px); }
    .sidebar-footer { padding: 1546 0"/></svg><span class="notification-badge" id="notification-badge" style="display: none;">0</span></button>
                    <div id="notification-dropdown" class="notification-dropdown">
                        <div class="notification-header"><span>Notifications</span><button id="mark-all-read-btn" classpx 20px; border-top: 1px solid var(--border-color); }
    .user-="mark-read-btn">Mark all as read</button></div>
                        <ul class="notification-listprofile-widget { display: flex; align-items: center; gap: 12px; }
    .avatar-initials { width: 44px; height: 44px; border-radius: 5" id="notification-list"><li class="notification-item">Loading notifications...</li></ul>
                    </div>
                </div>
            </div>
        </header>

        <div id="dashboard" class="tab-content active">
0%; background-color: var(--primary-color); color: black; font-weight: 700; font            <div id="welcome-message"><h2 id="welcome-user-h2">Welcome back!</h2><-size: 1rem; display: inline-flex; align-items: center; justify-content: center; }
    .user-name { font-weight: 600; font-size: 1rem; }
    .user-role { font-size: 0.8rem; color: var(--text-mutedp>Here's a look at your performance metrics for this month.</p></div>
            <section class="stats-grid">
                <div class="card progress-card"><h3>Your Current Error Rate</h3><div class="progress-); }
    .main-content { margin-left: 260px; width: calc(1info"><span class="progress-label">This Month</span><span class="progress-value" id="error-rate">0%</span></div><div class="progress-bar"><div class="progress-bar-inner" id="error-00% - 260px); padding: 30px; display: flex; flex-direction: columnrate-bar" style="width: 0%; background-color: var(--red);"></div></div><p style="; }
    .content-wrapper { flex: 1; }
    .tab-content { display: none;font-size: 12px; color: var(--text-muted); margin-top: 10px;" }
    .tab-content.active { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: id="error-rate-description">Based on 0 errors out of 0 reviewed orders.</p></div>
                <div class="card"><h3>Most Frequent Error Types</h3><div class="chart-container"><canvas id="common 1; transform: translateY(0); } }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 1rem; }
ErrorsChart"></canvas></div></div>
            </section>
            <section class="filter-panel"><div class="filter-    .header-left { flex-grow: 1; }
    .header-actions { display: flex; align-group"><label for="filter-order-id">Order ID</label><input type="search" id="filter-order-id" placeholder="Search by Order ID..."></div><div class="filter-group"><label for="filteritems: center; gap: 1rem; }
    .page-title { font-size: 24px; font-weight: 700; }
    #welcome-message { margin-bottom: 3-from-date">From</label><input type="date" id="filter-from-date" style="color-0px; }
    #welcome-message h2 { font-size: 1.75rem; fontscheme: dark;"></div><div class="filter-group"><label for="filter-to-date">To</-weight: 700; margin-bottom: 0.5rem; }
    #welcome-label><input type="date" id="filter-to-date" style="color-scheme: dark;"></div>message p { color: var(--text-muted); }
    .stats-grid { display: grid; grid<button class="btn btn-primary" id="apply-filters-btn">Apply Filters</button><button class="btn-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap:  btn-secondary" id="reset-filters-btn">Reset</button></section>
            <section class="20px; margin-bottom: 30px; }
    .card { background: var(--cardtable-container"><h3>Recent Errors Logged</h3><table><thead><tr><th>Order ID</th><th>Order Date</th><th>Error Type</th><th>Status-bg); padding: 25px; border-radius: var(--border-radius-base); border: 1px</th><th>Action</th></tr></thead><tbody id="error-table-body"><tr><td colspan="5" class=" solid var(--border-color); transition: transform 0.3s ease, box-shadow 0.3sempty-state">Loading your errors...</td></tr></tbody></table><div class="pagination-controls" id="dashboard-pagination ease; }
    .card:hover { transform: translateY(-2px); box-shadow: 0 8"><span class="page-info">Page 1 of 1</span><button class="btn btn-secondary prevpx 25px rgba(0, 0, 0, 0.3); }
    .card h3-btn">Previous</button><button class="btn btn-secondary next-btn">Next</button></div></ { font-size: 18px; font-weight: 600; margin-bottom: 20px; }
    .progress-card .progress-info { display: flex; justify-content: space-between; alignsection>
        </div>

        <div id="my-errors" class="tab-content">
            <div class="card"><h3>All My Errors</h3><p class="text-muted" style="margin-top:-1rem;-items: center; margin-bottom: 10px; }
    .progress-card .progress-value { font-size: 24px; font-weight: 600; }
    .progress-bar margin-bottom: 2rem;">A detailed list and history of all your errors.</p>
                <div class=" { width: 100%; height: 10px; background-color: #2c2c2filter-panel"><div class="filter-group"><label for="my-errors-search">Search</label><input typec; border-radius: 5px; overflow: hidden; margin-top: 10px; }="search" id="my-errors-search" placeholder="Search by Order ID or Error Type..."></div><div class
    .progress-bar-inner { height: 100%; border-radius: 5px; transition="filter-group"><label for="my-errors-status">Status</label><select id="my-errors-status"><: width 0.3s ease; }
    .chart-container { position: relative; height: 2option value="all">All Statuses</option><option value="closed">Closed</option><option value="under_review">50px; }
    .table-container { background: var(--card-bg); padding: 2Under Review</option><option value="overturned">Overturned</option></select></div><button class="btn0px; border-radius: var(--border-radius-base); border: 1px solid var(--border btn-primary" id="apply-my-errors-filters">Apply Filters</button><button class="btn btn-color); overflow-x: auto; }
    .table-container h3 { margin-bottom: -secondary" id="reset-my-errors-filters">Reset</button></div>
                <div class="25px; }
    table { width: 100%; border-collapse: collapse; min-widthtable-container"><table><thead><tr><th>Order ID</th><th>Error Date</th><th>Error Type</th><th>Status</th><th>Action</th></tr>: 600px; }
    th, td { padding: 15px; text-align: left</thead><tbody id="my-errors-table-body"><tr><td colspan="5" class="empty-state">Loading your errors...</td></tr></tbody></table><div class="pagination-controls" id="my-errors-pagination"><; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
    th { font-weight: 600; font-size: 14px; color: var(--text-mutedspan class="page-info">Page 1 of 1</span><button class="btn btn-secondary prev-); text-transform: uppercase; background-color: #2c2c2c; }
    tbody tr:btn">Previous</button><button class="btn btn-secondary next-btn">Next</button></div></div>
last-child td { border-bottom: none; }
    tbody tr:hover { background-color: #2c2            </div>
        </div>

        <div id="profile" class="tab-content"><div class="card">c2c; }
    .status-badge { padding: 5px 12px; border-<h3>Edit Profile</h3><div class="form-group"><label for="profile-fullname">Full Name</label><inputradius: 20px; font-size: 12px; font-weight: 600 type="text" id="profile-fullname"></div><div class="form-group"><label for="profile-; display: inline-block; text-transform: capitalize; }
    .status-pending, .status-email">Email Address</label><input type="email" id="profile-email" readonly style="background: #333under_review, .status-pending_response { background-color: var(--yellow-bg); color: var(--yellow);;"></div><div class="form-group"><label for="profile-phone">Phone Number</label><input type="tel" id="profile-phone"></div><div class="form-group"><label for="profile-department">Department</label><input }
    .status-responded, .status-overturned { background-color: var(--green-bg); color: type="text" id="profile-department" readonly style="background: #333;"></div><div class="page var(--green); }
    .status-finalized, .status-closed { background-color: var(---actions"><button class="btn btn-secondary" id="cancel-profile-btn">Cancel</button><buttonred-bg); color: var(--red); }
    .action-buttons { display: flex; gap: 8 class="btn btn-primary" id="save-profile-btn">Save Changes</button></div></div></div>

        <divpx; flex-wrap: wrap; }
    .action-btn { background: #333; border id="settings" class="tab-content">
            <div class="card"><h3>Account Settings</h3><p: none; cursor: pointer; color: var(--text-color); font-size: 14px; padding class="text-muted" style="margin-top:-1rem; margin-bottom: 2rem;">Manage: 10px 18px; border-radius: 6px; transition: all 0. your notification and account preferences.</p>
                <div class="settings-layout">
                    <nav class="3s ease; white-space: nowrap; }
    .action-btn:hover { background: #444settings-nav"><ul><li><a href="#" class="active" data-section="notifications">Notifications</a></li><li><; transform: translateY(-1px); }
    .action-btn.warning { background-color: var(--a href="#" data-section="security">Security</a></li></ul></nav>
                    <div class="settings-content">yellow-bg); color: var(--yellow); }
    .action-btn.warning:hover { background-color: rgba(255, 193, 7, 0.2); }
    .search
                        <section class="setting-card active" id="settings-section-notifications"><div class="setting-item-input-container input[type="search"] { background: #2c2c2c; border: 1px"><span>Email me when an error is logged</span><div class="toggle-switch"><label class="switch"><input type=" solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 10px 12px; width: 250px; transition: border-color checkbox" id="email-errors" checked><span class="slider"></span></label></div></div><div class="setting0.3s ease; }
    .search-input-container input[type="search"]:focus { border--item"><span>Email me a weekly performance summary</span><div class="toggle-switch"><label class="switch"><input type="color: var(--primary-color); outline: none; }
    .notification-bell { position: relative;checkbox" id="email-summary" checked><span class="slider"></span></label></div></div><div class="setting }
    .notification-btn { background: none; border: none; color: var(--text-muted); font-item"><span>Enable Push Notifications</span><div class="toggle-switch"><label class="switch"><input type="checkbox" id-size: 24px; cursor: pointer; padding: 5px; position: relative; transition:="push-notifications"><span class="slider"></span></label></div></div></section>
                        <section class color 0.3s ease; }
    .notification-btn:hover { color: var(--primary-color); }="setting-card" id="settings-section-security" style="display:none;"><div class="setting-item"><span>
    .notification-badge { position: absolute; top: 0px; right: 0px; backgroundPassword</span><button class="btn btn-secondary" id="change-password-btn">Change Password</button>: var(--red); color: white; border-radius: 50%; width: 18px; height:</div></section>
                    </div>
                </div>
            </div>
        </div>

        <div id="help" class=" 18px; font-size: 10px; display: flex; align-items: center; justify-tab-content"><div class="card"><div class="placeholder-content"><h3>Help Center</h3><p>Findcontent: center; border: 2px solid var(--card-bg); }
    .notification-dropdown { display answers to common questions or contact support for assistance.</p><div style="margin-top: 20px;"><: none; position: absolute; right: 0; top: 120%; background: var(--cardbutton class="btn btn-primary" id="contact-support-btn">Contact Support</button></div></div></div>-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius</div>
    </div>
    <footer class="site-footer">© 2025 Mohamed Elmenisy. All-base); width: 350px; box-shadow: 0 8px 16px rgba(0,0,0,0.3); z-index: 10; }
    . rights reserved.</footer>
</main>

<!-- Modals -->
<div class="modal-overlay" id="viewnotification-dropdown.show { display: block; animation: slideDown 0.3s ease; }
    -error-modal"><div class="modal-box"><div class="modal-header"><h3 class="modal-@keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity:title">Error Details: <span id="view-error-id" style="color: var(--primary-color 1; transform: translateY(0); } }
    .notification-header { padding: 1rem; border);"></span></h3><button class="modal-close-btn" data-modal-id="view-error-modal">×</-bottom: 1px solid var(--border-color); font-weight: 600; display: flex;button></div><div class="modal-body" id="view-error-body"></div><div class=" justify-content: space-between; align-items: center; }
    .notification-list { list-style: nonemodal-footer"><button class="btn btn-primary modal-close-btn" data-modal-id="view-error; padding: 0; max-height: 300px; overflow-y: auto; }
    .notification-modal">Close</button></div></div></div>
<div class="modal-overlay" id="reply-error-modal-item { padding: 1rem; border-bottom: 1px solid var(--border-color); font-size: 14px; display: flex; justify-content: space-between; align-items:"><div class="modal-box"><div class="modal-header"><h3 class="modal-title">Reply to Error: <span id="reply-error-id" style="color: var(--primary-color);"></span> flex-start; transition: background-color 0.3s ease; }
    .notification-item:hover {</h3><button class="modal-close-btn" data-modal-id="reply-error-modal">×</button></div> background-color: #2c2c2c; }
    .notification-item:last-child {<div class="modal-body"><div class="detail-item"><strong>Error Type</strong><p id="reply border-bottom: none; }
    .notification-item.read { opacity: 0.6; }-error-type">Loading...</p></div><div class="detail-item"><strong>Date</strong><p id="reply-
    .notification-item.empty { justify-content: center; text-align: center; color: var(--texterror-date">Loading...</p></div><div class="form-group"><label for="error-response">-muted); }
    .notification-message { flex: 1; }
    .notification-time {Your Response *</label><textarea id="error-response" placeholder="Please provide your response to this error..." required></textarea>< font-size: 12px; color: var(--text-muted); }
    .mark-readsmall style="color: var(--text-muted);">This response will be reviewed by the quality team.</small></div></div>-btn { background: none; border: none; color: var(--primary-color); cursor: pointer; font-size: 14px; padding: 4px 8px; border-radius: 4px; transition<div class="modal-footer"><button class="btn btn-secondary modal-close-btn" data-modal-id: background-color 0.3s ease; }
    .mark-read-btn:hover { background="reply-error-modal">Cancel</button><button class="btn btn-primary" id="submit-response-btn">-color: rgba(0, 191, 255, 0.1); }
    .Submit Response</button></div></div></div>
<div class="modal-overlay" id="change-password-modalfilter-panel { display: flex; gap: 15px; flex-wrap: wrap; align-items: flex"><div class="modal-box"><div class="modal-header"><h3 class="modal-title">Change-end; padding: 20px; background: #222; border-radius: var(--border-radius- Password</h3><button class="modal-close-btn" data-modal-id="change-password-modal">base); margin-bottom: 30px; border: 1px solid var(--border-color); }
    .×</button></div><div class="modal-body"><div class="form-group"><label for="current-password">Current Password</label><input type="password" id="current-password"></div><div class="form-group"><filter-group { flex: 1; min-width: 150px; }
    .filter-grouplabel for="new-password">New Password</label><input type="password" id="new-password"></div> label { display: block; margin-bottom: 5px; font-weight: 500; font-size:<div class="form-group"><label for="confirm-password">Confirm New Password</label><input type="password 14px; }
    .filter-group input, .filter-group select { width: 10" id="confirm-password"></div></div><div class="modal-footer"><button class="btn btn-secondary modal-0%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8close-btn" data-modal-id="change-password-modal">Cancel</button><button class="btnpx; font-family: 'Poppins'; background: #2c2c2c; color: #fff; } btn-primary" id="submit-password-change-btn">Update Password</button></div></div></div>
<div class="
    .btn { padding: 12px 22px; border: none; border-radius: modal-overlay" id="confirmation-modal"><div class="modal-box" style="max-width: 400px; text-align: center;"><div class="modal-header" style="border: none; justify8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-family: 'Poppins'; }
    .btn:disabled { background-color: #555 !-content: center;"><h3 class="modal-title" id="confirmation-title">Are you sure?</h3>important; cursor: not-allowed; opacity: 0.6; }
    .btn-primary { background:</div><div class="modal-body" style="padding: 0 1rem 1rem;"><p id var(--primary-color); color: #000; }
    .btn-primary:hover:not(:disabled) { background: var(--primary-hover); }
    .btn-secondary { background: #33="confirmation-message" style="color: var(--text-muted);">This action cannot be undone.</p></div><div class="modal-footer" style="justify-content: center;"><button class="btn btn-secondary modal-close-btn3; color: white; }
    .btn-secondary:hover:not(:disabled) { background: #444" data-modal-id="confirmation-modal">Cancel</button><button class="btn btn-primary" id="confirmation-; }
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7confirm-btn">Confirm</button></div></div></div>

<div class="toast-container" id="toast-container"></div>
<!-- Appeal Error Modal -->
<div class="modal-overlay" id="appeal-error-modal">
    <div class="modal-box" style="max-width: 500px;">
        ); z-index: 1001; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); padding: 20px; }
    .modal-overlay.show { display: flex; animation: fadeIn 0.3s ease; }
    .modal-box { background: var(--card-bg); padding: 2.5rem; border-radius: var<div class="modal-header">
            <h3 class="modal-title">Appeal Error</h3>
            <button class="modal-close-btn" data-modal-id="appeal-error-modal">×</button>
        </div>
        <div class="modal-body">
            <p style="color: var(--text-(--border-radius-base); border: 1px solid var(--border-color); width: 90%; max-muted); margin-bottom: 1rem;">Please provide the reason for your appeal. This will be sent to awidth: 550px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto; }
 senior quality analyst for review.</p>
            <div class="form-group">
                <label for="    .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottomappeal-reason">Reason for Appeal *</label>
                <textarea id="appeal-reason" rows="4" placeholder: 1px solid var(--border-color); padding-bottom: 1.5rem; margin-bottom="Explain why you believe the quality assessment was incorrect..."></textarea>
            </div>
        </div>
        <div class="modal: 1.5rem; }
    .modal-title { font-size: 1.25-footer">
            <button class="btn btn-secondary modal-close-btn" data-modal-idrem; font-weight: 700; }
    .modal-close-btn { background: none; border="appeal-error-modal">Cancel</button>
            <button class="btn btn-primary" id="submit-: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; paddingappeal-btn">Submit Appeal</button>
        </div>
    </div>
</div>

<!-- *** FIXED: ADDED AUTO: 5px; border-radius: 4px; transition: background-color 0.3s ease; }
FILL PREVENTION SCRIPT *** -->
<script>
document.addEventListener("DOMContentLoaded", function() {
    // حل    .modal-close-btn:hover { background-color: #2c2c2c; }
    .detail-item { background: #2c2c2c; padding: 1rem; border- أقوى - نمنع الـ autofill من مستوى أعلى
    const observer = new MutationObserver(function(radius: 8px; margin-bottom: 1rem; }
    .detail-item strong { displaymutations) {
        mutations.forEach(function(mutation) {
            mutation.addedNodes.forEach(: block; color: var(--primary-color); font-size: 0.8rem; text-transform: uppercase; margin-bottom: 0.5rem; letter-spacing: 0.5px; }
    .function(node) {
                if (node.nodeType === 1) { // Element node
                    const inputs = node.querySelectorAll ? node.querySelectorAll('input[type="search"]') : [];
                    inputs.forEach(disablemodal-footer { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; }
    .form-group { margin-bottom: 1.5rem; }
    Autofill);
                    
                    // إذا كان الـ node نفسه input
                    if (node.tagName === 'INPUT'.form-group label { display: block; font-weight: 500; margin-bottom: 0.5 && node.type === 'search') {
                        disableAutofill(node);
                    }
                }
            });
        });
    });
    
    function disableAutofill(input) {
        rem; }
    .form-group input, .form-group textarea, .form-group select { width: 100%; background: #2c2c2c; border: 1px solid var(--border-colorif (input.value.includes('@')) {
            input.value = '';
        }
        input.autocomplete = 'new-password';
        input.autocorrect = 'off';
        input.autocapitalize =); border-radius: 8px; color: var(--text-color); padding: 10px 12 'off';
        input.spellcheck = false;
        input.name = 'search-' + Math.random().toStringpx; font-family: 'Poppins'; transition: border-color 0.3s ease; }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-(36).substring(7);
    }
    
    // بدء المراقبة
    observer.observe(color: var(--primary-color); outline: none; }
    .form-group textarea { min-height: document.body, {
        childList: true,
        subtree: true
    });
    
    120px; resize: vertical; }
    .page-actions { display: flex; justify-content// تطبيق على الحقول الموجودة حالياً
    document.querySelectorAll('input[type="search"]').forEach(disableAutofill: flex-end; gap: 1rem; margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem; }
    .settings);
    
    // حل إضافي: إخفاء الحقول مؤقتاً ثم إظهارها-layout { display: flex; gap: 2rem; }
    .settings-nav { flex: 0
    setTimeout(() => {
        document.querySelectorAll('input[type="search"]').forEach(input => {
            input. 0 200px; }
    .settings-nav ul { list-style: none; paddingstyle.visibility = 'hidden';
            setTimeout(() => {
                input.value = '';
                input.style.visibility = 'visible';
            }, 100);
        });
    }, 10);
: 0; }
    .settings-nav a { display: block; padding: 0.75rem });
</script>

</body>
</html>
