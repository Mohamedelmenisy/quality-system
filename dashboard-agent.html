<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <title>My Performance - QualityX</title>
    <link href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%2300bfff'/><text x='50' y='55' font-family='Poppins, sans-serif' font-size='60' font-weight='bold' fill='white' text-anchor='middle' dominant-baseline='middle'>Q</text></svg>" rel="icon">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #00bfff;
            --primary-hover: #00a4d9;
            --bg-color: #121212;
            --sidebar-bg: #1a1a1a;
            --card-bg: #1a1a1a;
            --text-color: #e6edf3;
            --text-muted: #8b949e;
            --border-color: #333;
            --red: #dc3545;
            --red-bg: rgba(220, 53, 69, 0.1);
            --green: #28a745;
            --border-radius-base: 0.75rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: Poppins, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-logo {
            height: 32px;
            fill: var(--primary-color);
        }

        .sidebar-title {
            font-size: 1.25rem;
            color: var(--primary-color);
            font-weight: 700;
        }

        .sidebar-nav-container {
            flex-grow: 1;
            overflow-y: auto;
            padding-top: 1rem;
        }

        .nav-group {
            margin-bottom: 1.5rem;
            padding: 0 20px;
        }

        .nav-group-title {
            font-size: .75rem;
            text-transform: uppercase;
            letter-spacing: .05em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: .75rem;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            color: var(--text-muted);
            text-decoration: none;
            margin-bottom: 10px;
            transition: all .3s ease;
            gap: 15px;
            cursor: pointer;
        }

        .sidebar-nav a.active,
        .sidebar-nav a:hover {
            background-color: var(--primary-color);
            color: #000;
        }

        .sidebar-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
        }

        .user-profile-widget {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar-initials {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: #000;
            font-weight: 700;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .user-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .user-role {
            font-size: .8rem;
            color: var(--text-muted);
        }

        .main-content {
            margin-left: 260px;
            width: calc(100% - 260px);
            padding: 20px;
            min-height: 100vh;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn .5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .header-left {
            flex-grow: 1;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
        }

        #welcome-message {
            margin-bottom: 2rem;
        }

        #welcome-message h2 {
            font-size: 1.75rem;
            font-weight: 700;
        }

        #welcome-message p {
            color: var(--text-muted);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--card-bg);
            padding: 25px;
            border-radius: var(--border-radius-base);
            border: 1px solid var(--border-color);
        }

        .card h3 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
        }

        .progress-card .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .progress-card .progress-label {
            font-size: 14px;
            color: var(--text-muted);
        }

        .progress-card .progress-value {
            font-size: 24px;
            font-weight: 600;
            color: var(--red);
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background-color: #2c2c2c;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-bar-inner {
            height: 100%;
            background-color: var(--red);
            border-radius: 5px;
        }

        .chart-container {
            position: relative;
            height: 250px;
        }

        .table-container {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius-base);
            border: 1px solid var(--border-color);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
        }

        td, th {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        th {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-muted);
            text-transform: uppercase;
            background-color: #2c2c2c;
        }

        tbody tr:last-child td {
            border-bottom: none;
        }

        tbody tr:hover {
            background-color: #2c2c2c;
        }

        .status-error {
            background-color: var(--red-bg);
            color: var(--red);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .action-btn {
            background: #333;
            border: none;
            cursor: pointer;
            color: var(--text-color);
            font-size: 14px;
            padding: 5px 10px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }

        .action-btn:hover {
            background: #444;
        }

        .placeholder-content {
            padding: 40px;
            text-align: center;
            color: var(--text-muted);
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius-base);
        }

        .search-input-container {
            position: relative;
        }

        .search-input-container input[type=search] {
            background: #2c2c2c;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            padding: 10px 12px;
            width: 250px;
        }

        .notification-bell {
            position: relative;
        }

        .notification-btn {
            background: 0 0;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .notification-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 120%;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-base);
            width: 320px;
            box-shadow: 0 8px 16px rgba(0,0,0,.3);
            z-index: 10;
        }

        .notification-dropdown.show {
            display: block;
        }

        .notification-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }

        .notification-list {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        .filter-panel {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
            padding: 20px;
            background: var(--card-bg);
            border-radius: var(--border-radius-base);
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 14px;
        }

        .filter-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: Poppins;
            background: #2c2c2c;
            color: #fff;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-primary {
            background: var(--primary-color);
            color: #000;
        }

        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,.7);
            z-index: 1001;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-overlay.show {
            display: flex;
            animation: fadeIn .3s ease;
        }

        .modal-box {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--border-radius-base);
            border: 1px solid var(--border-color);
            width: 90%;
            max-width: 550px;
            box-shadow: 0 10px 30px rgba(0,0,0,.5);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .modal-close-btn {
            background: 0 0;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }

        .detail-item {
            background: #2c2c2c;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .detail-item strong {
            display: block;
            color: var(--primary-color);
            font-size: .8rem;
            text-transform: uppercase;
            margin-bottom: .5rem;
            letter-spacing: .5px;
        }

        .detail-item p {
            margin: 0;
            font-size: 1rem;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: .5rem;
        }

        .form-group input {
            width: 100%;
            background: #2c2c2c;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            padding: 10px 12px;
        }

        .page-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1.5rem;
        }

        .settings-layout {
            display: flex;
            gap: 2rem;
        }

        .settings-nav {
            flex: 0 0 200px;
        }

        .settings-nav ul {
            list-style: none;
            padding: 0;
        }

        .settings-nav a {
            display: block;
            padding: .75rem 1rem;
            text-decoration: none;
            color: var(--text-muted);
            border-radius: 8px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .settings-nav a.active,
        .settings-nav a:hover {
            background-color: #2c2c2c;
            color: var(--text-color);
        }

        .settings-content {
            flex-grow: 1;
        }

        .setting-card {
            background-color: #222;
            padding: 1.5rem;
            border-radius: var(--border-radius-base);
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .toggle-switch .switch {
            position: relative;
            display: inline-block;
            width: 44px;
            height: 24px;
        }

        .toggle-switch .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #3c3c3c;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: #fff;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked+.slider {
            background-color: var(--primary-color);
        }

        input:checked+.slider:before {
            transform: translateX(20px);
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
        }

        .toast {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-base);
            padding: 1rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            max-width: 400px;
        }

        .toast.success {
            border-left: 4px solid var(--green);
        }

        .toast.error {
            border-left: 4px solid var(--red);
        }

        .toast.warning {
            border-left: 4px solid var(--warning-color);
        }

        .toast.info {
            border-left: 4px solid var(--info-color);
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .empty-state svg {
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .response-form {
            margin-top: 1.5rem;
        }

        .response-form textarea {
            width: 100%;
            background: #2c2c2c;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            padding: 12px;
            font-family: inherit;
            resize: vertical;
            min-height: 120px;
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .sidebar {
                width: 220px;
            }
            .main-content {
                margin-left: 220px;
                width: calc(100% - 220px);
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                display: none;
            }
            .main-content {
                margin-left: 0;
                width: 100%;
                padding: 15px;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .filter-panel {
                flex-direction: column;
                align-items: stretch;
            }
            .filter-group {
                min-width: auto;
            }
            header {
                flex-direction: column;
                align-items: flex-start;
            }
            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
        }

        @media (max-width: 480px) {
            .main-content {
                padding: 10px;
            }
            .card {
                padding: 15px;
            }
            .modal-box {
                padding: 1.5rem;
                width: 95%;
            }
            .page-title {
                font-size: 20px;
            }
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-color);
            font-size: 24px;
            cursor: pointer;
            padding: 10px;
        }

        @media (max-width: 768px) {
            .mobile-menu-btn {
                display: block;
            }
        }
    </style>
</head>

<body>
    <!-- Toast Container for Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Mobile Menu Button -->
    <button class="mobile-menu-btn" id="mobile-menu-btn">‚ò∞</button>

    <aside class="sidebar" id="sidebar">
        <div>
            <div class="sidebar-header">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="sidebar-logo">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5-10-5-10 5z" stroke="#FFF" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="1" fill-opacity="0.3"></path>
                    <path d="M12 22V12" stroke="#FFF" stroke-linecap="round" stroke-linejoin="round" stroke-width="1">
                    </path>
                </svg>
                <h1 class="sidebar-title">QualityX</h1>
            </div>
            <div class="sidebar-nav-container">
                <div class="nav-group">
                    <h2 class="nav-group-title">Menu</h2>
                    <ul class="sidebar-nav">
                        <li><a data-tab="dashboard" class="active">
                                <span>üìä</span>Dashboard
                            </a></li>
                        <li><a data-tab="my-errors">
                                <span>‚ùå</span>My Errors
                            </a></li>
                    </ul>
                </div>
                <div class="nav-group">
                    <h2 class="nav-group-title">Account</h2>
                    <ul class="sidebar-nav">
                        <li><a data-tab="profile">
                                <span>üë§</span>Profile
                            </a></li>
                        <li><a data-tab="settings">
                                <span>‚öôÔ∏è</span>Settings
                            </a></li>
                        <li><a data-tab="help">
                                <span>‚ùì</span>Get Help
                            </a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="sidebar-footer">
            <div class="user-profile-widget">
                <div class="avatar-initials" id="sidebar-avatar-initials">--</div>
                <div>
                    <div class="user-name" id="sidebar-username">Loading...</div>
                    <div class="user-role" id="sidebar-userrole">Customer Service Agent</div>
                </div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <header>
            <div class="header-left">
                <h2 class="page-title" id="page-title-header">Dashboard</h2>
            </div>
            <div class="header-actions">
                <div class="search-input-container">
                    <input type="search" placeholder="Search my errors..." id="errors-search">
                </div>
                <div class="notification-bell">
                    <button class="notification-btn" id="notification-btn">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="22"
                            stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            width="22">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                            <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                        </svg>
                    </button>
                    <div class="notification-dropdown" id="notification-dropdown">
                        <div class="notification-header">Notifications</div>
                        <ul class="notification-list" id="notification-list">
                            <li class="notification-item">Loading notifications...</li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div id="welcome-message">
                <h2 id="welcome-user-h2">Welcome back!</h2>
                <p>Here's a look at your performance metrics for this month.</p>
            </div>
            <section class="stats-grid">
                <div class="card progress-card">
                    <h3>Your Current Error Rate</h3>
                    <div class="progress-info">
                        <span class="progress-label">This Month</span>
                        <span class="progress-value" id="current-error-rate">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-bar-inner" id="error-rate-bar" style="width: 0%"></div>
                    </div>
                    <p style="font-size:12px;color:var(--text-muted);margin-top:10px" id="error-rate-description">Based on 0 errors out of 0 reviewed orders.</p>
                </div>
                <div class="card">
                    <h3>Most Frequent Error Types</h3>
                    <div class="chart-container">
                        <canvas id="commonErrorsChart"></canvas>
                    </div>
                </div>
            </section>
            <section class="filter-panel">
                <div class="filter-group">
                    <label for="filter-order-id">Order ID</label>
                    <input type="search" id="filter-order-id" placeholder="Search by Order ID...">
                </div>
                <div class="filter-group">
                    <label for="filter-from-date">From</label>
                    <input type="date" id="filter-from-date" style="color-scheme:dark">
                </div>
                <div class="filter-group">
                    <label for="filter-to-date">To</label>
                    <input type="date" id="filter-to-date" style="color-scheme:dark">
                </div>
                <button class="btn btn-primary" id="apply-filters-btn">Apply Filters</button>
            </section>
            <section class="table-container">
                <h3>Recent Errors Logged</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Order Date</th>
                            <th>Error Type</th>
                            <th>Reviewed By</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="error-table-body">
                        <!-- Errors will be populated dynamically -->
                    </tbody>
                </table>
            </section>
        </div>

        <!-- My Errors Tab -->
        <div class="tab-content" id="my-errors">
            <div class="card">
                <h3>All My Errors</h3>
                <p style="margin-top:-1rem;margin-bottom:2rem" class="text-muted">Complete history of errors logged against your work.</p>
                <div class="filter-panel">
                    <div class="filter-group">
                        <label for="all-errors-search">Search Errors</label>
                        <input type="search" id="all-errors-search" placeholder="Search by order ID or error type...">
                    </div>
                    <div class="filter-group">
                        <label for="error-status-filter">Status</label>
                        <select id="error-status-filter">
                            <option value="all">All Status</option>
                            <option value="pending">Pending Response</option>
                            <option value="responded">Responded</option>
                            <option value="finalized">Finalized</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="refresh-errors-btn">Refresh</button>
                </div>
                <div class="table-container" style="margin-top: 20px;">
                    <table>
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Error Type</th>
                                <th>Date Logged</th>
                                <th>Status</th>
                                <th>Reviewed By</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="all-errors-table">
                            <!-- All errors will be populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div class="tab-content" id="profile">
            <div class="card">
                <h3>Edit Profile</h3>
                <div class="form-group">
                    <label for="profile-fullname">Full Name</label>
                    <input id="profile-fullname">
                </div>
                <div class="form-group">
                    <label for="profile-email">Email Address</label>
                    <input type="email" id="profile-email">
                </div>
                <div class="form-group">
                    <label for="profile-phone">Phone Number</label>
                    <input type="tel" id="profile-phone">
                </div>
                <div class="page-actions">
                    <button class="action-btn" style="padding:10px 20px">Cancel</button>
                    <button class="btn btn-primary" id="save-profile-btn">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="card">
                <h3>Account Settings</h3>
                <p style="margin-top:-1rem;margin-bottom:2rem" class="text-muted">Manage your notification and account preferences.</p>
                <div class="settings-layout">
                    <nav class="settings-nav">
                        <ul>
                            <li><a class="active" data-section="notifications" href="#">Notifications</a></li>
                            <li><a data-section="security" href="#">Security</a></li>
                        </ul>
                    </nav>
                    <div class="settings-content">
                        <section class="active setting-card" id="settings-section-notifications">
                            <div class="setting-item">
                                <span>Email me when an error is logged</span>
                                <div class="toggle-switch">
                                    <label class="switch">
                                        <input type="checkbox" checked id="email-notifications">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                            <div class="setting-item">
                                <span>Email me a weekly performance summary</span>
                                <div class="toggle-switch">
                                    <label class="switch">
                                        <input type="checkbox" checked id="weekly-summary">
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </section>
                        <section class="setting-card" id="settings-section-security" style="display:none">
                            <div class="setting-item">
                                <span>Password</span>
                                <button class="action-btn" id="change-password-btn">Change Password</button>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>

        <!-- Help Tab -->
        <div class="tab-content" id="help">
            <div class="card">
                <div class="placeholder-content">
                    <h3>Help Center</h3>
                    <p>Find answers to common questions or contact support for assistance.</p>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary">Contact Support</button>
                        <button class="action-btn" style="margin-left: 10px;">View FAQ</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- View Error Details Modal -->
    <div class="modal-overlay" id="view-error-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Error Details: <span id="view-error-id" style="color:var(--primary-color)"></span></h3>
                <button class="modal-close-btn" data-modal-id="view-error-modal">√ó</button>
            </div>
            <div class="modal-body" id="view-error-body">
                <!-- Error details will be populated dynamically -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary modal-close-btn" data-modal-id="view-error-modal">Close</button>
            </div>
        </div>
    </div>

    <!-- Reply to Error Modal -->
    <div class="modal-overlay" id="reply-error-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h3 class="modal-title">Reply to Error: <span id="reply-error-id" style="color:var(--primary-color)"></span></h3>
                <button class="modal-close-btn" data-modal-id="reply-error-modal">√ó</button>
            </div>
            <div class="modal-body">
                <div id="reply-error-details">
                    <!-- Error details for reply will be populated dynamically -->
                </div>
                <div class="response-form">
                    <label for="response-text">Your Response:</label>
                    <textarea id="response-text" placeholder="Please provide your response or explanation for this error..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close-btn" data-modal-id="reply-error-modal">Cancel</button>
                <button class="btn btn-primary" id="submit-response-btn">Submit Response</button>
            </div>
        </div>
    </div>

    <script>
        // ================================
        // Agent Dashboard - Dynamic Implementation
        // ================================

        // Supabase Configuration
        const SUPABASE_URL = "https://otaztiyatvbajswowdgs.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im90YXp0aXlhdHZiYWpzd293ZGdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MDI4NTYsImV4cCI6MjA3NjI3ODg1Nn0.wmAvCpj8TpKjeuWF1OrjvXnxucMCFhhQrK0skA0SQhc";

        // Global State
        let currentUser = null;
        let userData = null;
        let userErrors = [];
        let currentErrorId = null;

        // Initialize Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Toast Notification System
        function showToast(message, type = 'info', duration = 5000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="background:none;border:none;color:var(--text-muted);cursor:pointer;margin-left:auto;">√ó</button>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, duration);
        }

        // API Client Functions
        const apiClient = {
            async getCurrentUser() {
                try {
                    const { data: { user }, error } = await supabase.auth.getUser();
                    if (error) throw error;
                    return user;
                } catch (error) {
                    console.error('Get current user error:', error);
                    showToast('Failed to get user data', 'error');
                    return null;
                }
            },

            async getUserData(userId) {
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .select('*')
                        .eq('id', userId)
                        .maybeSingle(); // FIX: Use maybeSingle() to prevent error on 0 rows. Returns null instead.
                    if (error) throw error;
                    return data;
                } catch (error) {
                    console.error('Get user data error:', error);
                    showToast('Failed to load user profile', 'error');
                    return null;
                }
            },

            async getUserErrors(userId) {
                try {
                    const { data, error } = await supabase
                        .from('errors')
                        .select(`
                            *,
                            quality_reviews!review_id(*), 
                            orders!inner(*),
                            users!errors_recorded_by_fkey(name)
                        `) // FIX: Changed join to be explicit assuming 'review_id' is the foreign key in the 'errors' table. Removed 'inner' to be more robust.
                        .eq('employee_id', userId)
                        .order('created_at', { ascending: false });
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('Get user errors error:', error);
                    showToast('Failed to load your errors', 'error');
                    return [];
                }
            },

            async getNotifications(userId) {
                try {
                    const { data, error } = await supabase
                        .from('notifications')
                        .select('*')
                        .eq('user_id', userId)
                        .order('created_at', { ascending: false })
                        .limit(10);
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('Get notifications error:', error);
                    return [];
                }
            },

            async submitErrorResponse(errorId, responseText, respondedBy) {
                try {
                    const { data, error } = await supabase
                        .from('error_responses')
                        .insert([{
                            error_id: errorId,
                            response_by: respondedBy,
                            response_text: responseText,
                            responded_at: new Date().toISOString()
                        }])
                        .select();
                    
                    if (error) throw error;

                    // Update error status to responded
                    const { error: updateError } = await supabase
                        .from('errors')
                        .update({ status: 'responded' })
                        .eq('id', errorId);

                    if (updateError) throw updateError;

                    showToast('Response submitted successfully', 'success');
                    return data;
                } catch (error) {
                    console.error('Submit error response error:', error);
                    showToast('Failed to submit response', 'error');
                    throw error;
                }
            },

            async updateUserProfile(userId, profileData) {
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .update(profileData)
                        .eq('id', userId)
                        .select();
                    if (error) throw error;
                    showToast('Profile updated successfully', 'success');
                    return data;
                } catch (error) {
                    console.error('Update profile error:', error);
                    showToast('Failed to update profile', 'error');
                    throw error;
                }
            },

            async getPerformanceStats(userId) {
                try {
                    // Get total errors for this user
                    const { data: errors, error: errorsError } = await supabase
                        .from('errors')
                        .select('id', { count: 'exact' }) // More efficient count
                        .eq('employee_id', userId);

                    if (errorsError) throw errorsError;

                    // Get total orders reviewed (this would need proper tracking in a real system)
                    // For now, we'll use a simulated number
                    const totalOrders = 205; // This would come from order_assignments in a real system
                    const totalErrors = errors?.length || 0;
                    
                    return {
                        totalOrders,
                        totalErrors,
                        errorRate: totalOrders > 0 ? (totalErrors / totalOrders * 100).toFixed(1) : 0,
                        errorTypes: await this.getErrorTypes(userId)
                    };
                } catch (error) {
                    console.error('Get performance stats error:', error);
                    return {
                        totalOrders: 0,
                        totalErrors: 0,
                        errorRate: 0,
                        errorTypes: []
                    };
                }
            },

            async getErrorTypes(userId) {
                try {
                    // This would aggregate error types from quality_reviews in a real system
                    // For now, return simulated data
                    return [
                        { type: 'Incorrect Information', count: 6 },
                        { type: 'Policy Violation', count: 4 },
                        { type: 'System Entry Error', count: 2 }
                    ];
                } catch (error) {
                    console.error('Get error types error:', error);
                    return [];
                }
            }
        };

        // Core Application Logic
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize the application
                await initializeApp();
                
                // Set up event listeners
                setupEventListeners();
                
                // Load initial data only if initialization was successful
                if (currentUser && userData) {
                    await loadInitialData();
                }
                
            } catch (error) {
                console.error('Application initialization error:', error);
                showToast('Failed to initialize application', 'error');
            }
        });

        async function initializeApp() {
            // Get current user
            currentUser = await apiClient.getCurrentUser();
            if (!currentUser) {
                // In a real app, you might redirect: window.location.href = '/login.html';
                showToast('You are not logged in.', 'error');
                return;
            }

            // Get user data
            userData = await apiClient.getUserData(currentUser.id);
            
            // Update UI with user data (even if it's null, the function will handle it)
            updateUserInterface();
        }

        function updateUserInterface() {
            // FIX: Add a guard to handle cases where the user profile doesn't exist.
            if (!userData) {
                showToast('Could not load your profile data.', 'error');
                document.getElementById('sidebar-username').textContent = 'Unknown User';
                document.getElementById('sidebar-userrole').textContent = 'Agent';
                document.getElementById('sidebar-avatar-initials').textContent = '!!';
                document.getElementById('welcome-user-h2').textContent = `Welcome back!`;
                return; // Stop further execution if no user data
            }

            // Update sidebar user info
            document.getElementById('sidebar-username').textContent = userData.name || 'Agent';
            document.getElementById('sidebar-userrole').textContent = userData.role || 'Customer Service Agent';
            
            // Update avatar initials
            const initials = getInitials(userData.name);
            document.getElementById('sidebar-avatar-initials').textContent = initials;
            
            // Update welcome message
            const firstName = userData.name?.split(' ')[0] || 'there';
            document.getElementById('welcome-user-h2').textContent = `Welcome back, ${firstName}!`;
            
            // Initialize profile form
            initializeProfileForm();
        }

        function getInitials(name) {
            if (!name) return '--';
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        function initializeProfileForm() {
            if (userData) {
                document.getElementById('profile-fullname').value = userData.name || '';
                document.getElementById('profile-email').value = userData.email || '';
                document.getElementById('profile-phone').value = userData.phone || '';
            }
        }

        function setupEventListeners() {
            // Mobile menu toggle
            document.getElementById('mobile-menu-btn').addEventListener('click', () => {
                document.getElementById('sidebar').style.display = 
                    document.getElementById('sidebar').style.display === 'none' ? 'flex' : 'none';
            });

            // Tab navigation
            document.querySelectorAll('.sidebar-nav a[data-tab]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = link.dataset.tab;
                    switchTab(tabId);
                    // Update active state
                    document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
                    link.classList.add('active');

                    // Hide sidebar on mobile after selection
                    if (window.innerWidth <= 768) {
                        document.getElementById('sidebar').style.display = 'none';
                    }
                });
            });

            // Notification bell
            document.getElementById('notification-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                document.getElementById('notification-dropdown').classList.toggle('show');
            });

            // Close notification dropdown when clicking outside
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.notification-bell')) {
                    document.getElementById('notification-dropdown').classList.remove('show');
                }
            });

            // Apply filters button
            document.getElementById('apply-filters-btn').addEventListener('click', () => {
                filterRecentErrors();
            });

            // Refresh errors button
            document.getElementById('refresh-errors-btn').addEventListener('click', async () => {
                await loadAllErrors();
            });

            // Save profile button
            document.getElementById('save-profile-btn').addEventListener('click', async () => {
                await saveProfile();
            });

            // Submit response button
            document.getElementById('submit-response-btn').addEventListener('click', async () => {
                await submitErrorResponse();
            });

            // Settings navigation
            document.querySelectorAll('.settings-nav a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = `settings-section-${link.dataset.section}`;
                    document.querySelectorAll('.settings-nav a').forEach(l => l.classList.remove('active'));
                    document.querySelectorAll('.settings-content .setting-card').forEach(s => s.style.display = 'none');
                    link.classList.add('active');
                    document.getElementById(sectionId).style.display = 'block';
                });
            });

            // Change password button
            document.getElementById('change-password-btn').addEventListener('click', () => {
                showToast('Password change feature coming soon', 'info');
            });

            // Modal close buttons
            document.querySelectorAll('.modal-close-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    hideModal(btn.dataset.modalId);
                });
            });

            // Search functionality
            document.getElementById('errors-search').addEventListener('input', () => {
                filterAllErrors();
            });

            document.getElementById('all-errors-search').addEventListener('input', () => {
                filterAllErrors();
            });

            // Error status filter
            document.getElementById('error-status-filter').addEventListener('change', () => {
                filterAllErrors();
            });
        }

        async function loadInitialData() {
            // Load notifications
            await loadNotifications();
            
            // Load performance stats
            await loadPerformanceStats();
            
            // Load user errors
            await loadUserErrors();
            
            // Initialize chart
            initializeChart();
        }

        async function loadNotifications() {
            const notifications = await apiClient.getNotifications(currentUser.id);
            const notificationList = document.getElementById('notification-list');
            
            if (notifications.length === 0) {
                notificationList.innerHTML = '<li class="notification-item">No new notifications</li>';
                return;
            }

            notificationList.innerHTML = notifications.map(notification => 
                `<li class="notification-item">${notification.message}</li>`
            ).join('');
        }

        async function loadPerformanceStats() {
            const stats = await apiClient.getPerformanceStats(currentUser.id);
            
            // Update error rate display
            document.getElementById('current-error-rate').textContent = `${stats.errorRate}%`;
            document.getElementById('error-rate-bar').style.width = `${stats.errorRate}%`;
            document.getElementById('error-rate-description').textContent = 
                `Based on ${stats.totalErrors} errors out of ${stats.totalOrders} reviewed orders.`;
        }

        async function loadUserErrors() {
            userErrors = await apiClient.getUserErrors(currentUser.id);
            await loadRecentErrors();
            await loadAllErrors();
        }

        async function loadRecentErrors() {
            const errorTableBody = document.getElementById('error-table-body');
            const recentErrors = userErrors.slice(0, 5); // Show only 5 most recent

            if (recentErrors.length === 0) {
                errorTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-muted)">
                            No errors logged against your work. Great job!
                        </td>
                    </tr>
                `;
                return;
            }

            errorTableBody.innerHTML = recentErrors.map(error => `
                <tr>
                    <td>${error.orders?.order_id || 'N/A'}</td>
                    <td>${new Date(error.created_at).toLocaleDateString()}</td>
                    <td>${error.quality_reviews?.error_cause || 'Unknown'}</td>
                    <td>${error.users?.name || 'Quality Team'}</td>
                    <td><span class="status-error">Error Found</span></td>
                    <td>
                        <button class="action-btn" data-error-id="${error.id}" data-action="view">
                            View Details
                        </button>
                        ${error.status === 'pending_response' ? 
                            `<button class="action-btn" style="margin-left: 5px; background: var(--primary-color); color: #000;" 
                                    data-error-id="${error.id}" data-action="reply">
                                Reply
                            </button>` : ''
                        }
                    </td>
                </tr>
            `).join('');

            // Add event listeners to action buttons
            errorTableBody.querySelectorAll('button[data-action="view"]').forEach(btn => {
                btn.addEventListener('click', () => viewErrorDetails(btn.dataset.errorId));
            });

            errorTableBody.querySelectorAll('button[data-action="reply"]').forEach(btn => {
                btn.addEventListener('click', () => replyToError(btn.dataset.errorId));
            });
        }

        async function loadAllErrors() {
            const allErrorsTable = document.getElementById('all-errors-table');

            if (userErrors.length === 0) {
                allErrorsTable.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-muted)">
                            No errors found in your record.
                        </td>
                    </tr>
                `;
                return;
            }

            allErrorsTable.innerHTML = userErrors.map(error => `
                <tr>
                    <td>${error.orders?.order_id || 'N/A'}</td>
                    <td>${error.quality_reviews?.error_cause || 'Unknown'}</td>
                    <td>${new Date(error.created_at).toLocaleDateString()}</td>
                    <td>
                        <span class="status-error ${getStatusClass(error.status)}">
                            ${getStatusText(error.status)}
                        </span>
                    </td>
                    <td>${error.users?.name || 'Quality Team'}</td>
                    <td>
                        <button class="action-btn" data-error-id="${error.id}" data-action="view">
                            View
                        </button>
                        ${error.status === 'pending_response' ? 
                            `<button class="action-btn" style="margin-left: 5px; background: var(--primary-color); color: #000;" 
                                    data-error-id="${error.id}" data-action="reply">
                                Reply
                            </button>` : ''
                        }
                    </td>
                </tr>
            `).join('');

            // Add event listeners to action buttons
            allErrorsTable.querySelectorAll('button[data-action="view"]').forEach(btn => {
                btn.addEventListener('click', () => viewErrorDetails(btn.dataset.errorId));
            });

            allErrorsTable.querySelectorAll('button[data-action="reply"]').forEach(btn => {
                btn.addEventListener('click', () => replyToError(btn.dataset.errorId));
            });

            // Apply initial filters
            filterAllErrors();
        }

        function getStatusClass(status) {
            switch (status) {
                case 'pending_response': return 'status-pending';
                case 'responded': return 'status-responded';
                case 'finalized': return 'status-finalized';
                default: return '';
            }
        }

        function getStatusText(status) {
            switch (status) {
                case 'pending_response': return 'Pending Response';
                case 'responded': return 'Responded';
                case 'finalized': return 'Finalized';
                default: return status;
            }
        }

        function filterRecentErrors() {
            const orderIdFilter = document.getElementById('filter-order-id').value.toLowerCase();
            const fromDate = document.getElementById('filter-from-date').value;
            const toDate = document.getElementById('filter-to-date').value;

            const filteredErrors = userErrors.filter(error => {
                const orderId = error.orders?.order_id?.toLowerCase() || '';
                const errorDate = new Date(error.created_at);
                
                const matchesOrderId = !orderIdFilter || orderId.includes(orderIdFilter);
                const matchesFromDate = !fromDate || errorDate >= new Date(fromDate);
                const matchesToDate = !toDate || errorDate <= new Date(toDate + 'T23:59:59');

                return matchesOrderId && matchesFromDate && matchesToDate;
            }).slice(0, 5); // Still show only 5 most recent after filtering

            const errorTableBody = document.getElementById('error-table-body');
            
            if (filteredErrors.length === 0) {
                errorTableBody.innerHTML = `
                    <tr>
                        <td colspan="6" style="text-align: center; padding: 2rem; color: var(--text-muted)">
                            No errors match your filters.
                        </td>
                    </tr>
                `;
                return;
            }

            errorTableBody.innerHTML = filteredErrors.map(error => `
                <tr>
                    <td>${error.orders?.order_id || 'N/A'}</td>
                    <td>${new Date(error.created_at).toLocaleDateString()}</td>
                    <td>${error.quality_reviews?.error_cause || 'Unknown'}</td>
                    <td>${error.users?.name || 'Quality Team'}</td>
                    <td><span class="status-error">Error Found</span></td>
                    <td>
                        <button class="action-btn" data-error-id="${error.id}" data-action="view">
                            View Details
                        </button>
                        ${error.status === 'pending_response' ? 
                            `<button class="action-btn" style="margin-left: 5px; background: var(--primary-color); color: #000;" 
                                    data-error-id="${error.id}" data-action="reply">
                                Reply
                            </button>` : ''
                        }
                    </td>
                </tr>
            `).join('');

            // Re-attach event listeners
            errorTableBody.querySelectorAll('button[data-action="view"]').forEach(btn => {
                btn.addEventListener('click', () => viewErrorDetails(btn.dataset.errorId));
            });

            errorTableBody.querySelectorAll('button[data-action="reply"]').forEach(btn => {
                btn.addEventListener('click', () => replyToError(btn.dataset.errorId));
            });
        }

        function filterAllErrors() {
            const searchTerm = document.getElementById('all-errors-search').value.toLowerCase();
            const statusFilter = document.getElementById('error-status-filter').value;
            const rows = document.getElementById('all-errors-table').querySelectorAll('tr');

            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                // FIX: Check for correct number of cells to avoid error on empty/header rows.
                if (cells.length < 6) return;

                const orderId = cells[0].textContent.toLowerCase();
                const errorType = cells[1].textContent.toLowerCase();
                const status = cells[3].querySelector('.status-error').textContent.toLowerCase();

                const matchesSearch = !searchTerm || 
                    orderId.includes(searchTerm) || 
                    errorType.includes(searchTerm);
                const matchesStatus = statusFilter === 'all' || 
                    status.includes(statusFilter.replace('_', ' '));

                row.style.display = matchesSearch && matchesStatus ? '' : 'none';
            });
        }

        function viewErrorDetails(errorId) {
            const error = userErrors.find(e => e.id === errorId);
            if (!error) return;

            document.getElementById('view-error-id').textContent = error.orders?.order_id || 'N/A';
            
            const modalBody = document.getElementById('view-error-body');
            modalBody.innerHTML = `
                <div class="detail-item">
                    <strong>Error Type</strong>
                    <p>${error.quality_reviews?.error_cause || 'Unknown'}</p>
                </div>
                <div class="detail-item">
                    <strong>Order Date</strong>
                    <p>${new Date(error.created_at).toLocaleDateString()}</p>
                </div>
                <div class="detail-item">
                    <strong>Reviewed By</strong>
                    <p>${error.users?.name || 'Quality Team'}</p>
                </div>
                <div class="detail-item" style="background-color: var(--red-bg); border: 1px solid var(--red);">
                    <strong>Details from Quality Team</strong>
                    <p>${error.quality_reviews?.modification_details || 'No additional details provided.'}</p>
                </div>
                ${error.status === 'responded' || error.status === 'finalized' ? `
                    <div class="detail-item" style="background-color: rgba(0, 191, 255, 0.1); border: 1px solid var(--primary-color); margin-top: 1rem;">
                        <strong>Your Response</strong>
                        <p>${getLatestResponse(error.id) || 'No response recorded.'}</p>
                    </div>
                ` : ''}
            `;

            showModal('view-error-modal');
        }

        function replyToError(errorId) {
            const error = userErrors.find(e => e.id === errorId);
            if (!error) return;

            currentErrorId = errorId;
            document.getElementById('reply-error-id').textContent = error.orders?.order_id || 'N/A';
            
            const replyDetails = document.getElementById('reply-error-details');
            replyDetails.innerHTML = `
                <div class="detail-item">
                    <strong>Error Type</strong>
                    <p>${error.quality_reviews?.error_cause || 'Unknown'}</p>
                </div>
                <div class="detail-item">
                    <strong>Quality Team Comments</strong>
                    <p>${error.quality_reviews?.modification_details || 'No additional comments provided.'}</p>
                </div>
            `;

            // Clear previous response
            document.getElementById('response-text').value = '';

            showModal('reply-error-modal');
        }

        async function submitErrorResponse() {
            const responseText = document.getElementById('response-text').value.trim();

            if (!responseText) {
                showToast('Please provide a response before submitting', 'warning');
                return;
            }

            if (!currentErrorId) {
                showToast('No error selected for response', 'error');
                return;
            }

            try {
                await apiClient.submitErrorResponse(currentErrorId, responseText, currentUser.id);
                
                // Refresh the errors data
                await loadUserErrors();
                
                // Close the modal
                hideModal('reply-error-modal');
                
                // Reset current error ID
                currentErrorId = null;
                
            } catch (error) {
                console.error('Error submitting response:', error);
            }
        }

        function getLatestResponse(errorId) {
            // In a real implementation, this would fetch from error_responses table
            // For now, return a placeholder
            return "I understand the issue and will be more careful with policy information in the future.";
        }

        function initializeChart() {
            Chart.defaults.font.family = 'Poppins';
            Chart.defaults.color = '#e6edf3';
            
            const commonErrorsCtx = document.getElementById('commonErrorsChart').getContext('2d');
            new Chart(commonErrorsCtx, {
                type: 'bar',
                data: {
                    labels: ['Incorrect Info', 'Policy Violation', 'System Entry'],
                    datasets: [{
                        label: 'Number of Errors',
                        data: [6, 4, 2],
                        backgroundColor: [ 
                            'rgba(220, 53, 69, 0.7)', 
                            'rgba(255, 193, 7, 0.7)', 
                            'rgba(0, 123, 255, 0.7)' 
                        ],
                        borderWidth: 0,
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                precision: 0
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        function switchTab(tabId) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.add('active');
                document.getElementById('page-title-header').textContent = 
                    document.querySelector(`[data-tab="${tabId}"]`).textContent.trim().replace(/^[^\w\s]+/, '');
                
                // Load tab-specific data if needed
                if (tabId === 'my-errors') {
                    filterAllErrors();
                }
            }
        }

        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function hideModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        async function saveProfile() {
            const fullName = document.getElementById('profile-fullname').value;
            const email = document.getElementById('profile-email').value;
            const phone = document.getElementById('profile-phone').value;

            if (!fullName || !email) {
                showToast('Please fill in required fields', 'warning');
                return;
            }

            if (!userData) {
                showToast('Cannot save profile, user data not loaded.', 'error');
                return;
            }

            try {
                await apiClient.updateUserProfile(currentUser.id, {
                    name: fullName,
                    email: email,
                    phone: phone
                });
                
                // Refresh user data and update UI
                userData = await apiClient.getUserData(currentUser.id);
                updateUserInterface();
                
            } catch (error) {
                console.error('Error saving profile:', error);
            }
        }

        // Handle window resize for responsive behavior
        window.addEventListener('resize', () => {
            if (window.innerWidth > 768) {
                document.getElementById('sidebar').style.display = 'flex';
            } else {
                document.getElementById('sidebar').style.display = 'none';
            }
        });

        // Close modals when clicking outside
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                e.target.classList.remove('show');
            }
        });
    </script>
</body>
</html>
