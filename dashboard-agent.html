<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Performance - QualityX</title>
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%2300bfff'/%3E%3Ctext x='50' y='55' font-family='Poppins, sans-serif' font-size='60' font-weight='bold' fill='white' text-anchor='middle' dominant-baseline='middle'%3EQ%3C/text%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script type="module">
    import { 
        supabase, 
        getCurrentUser, 
        getUserById, 
        getAgentErrors, 
        submitErrorResponse,
        getPerformanceMetrics,
        getNotifications,
        markNotificationAsRead,
        subscribeToNotifications,
        subscribeToErrors,
        updateUserProfile
    } from './api-client.js';

    // Application State
    let currentUser = null;
    let userErrors = [];
    let filteredUserErrors = [];
    let userPerformance = {
        errorRate: 0,
        totalErrors: 0,
        totalOrders: 0,
        errorTypes: {}
    };
    let notifications = [];
    let commonErrorsChart = null;
    
    // Pagination State
    let dashboardCurrentPage = 1;
    let myErrorsCurrentPage = 1;
    const ITEMS_PER_PAGE = 10;

    // Toast Notification System
    function showToast(message, type = 'info', title = '') {
        const container = document.getElementById('toast-container');
        if (!container) return;
        
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        
        const icons = {
            success: '‚úÖ',
            error: '‚ùå',
            warning: '‚ö†Ô∏è',
            info: '‚ÑπÔ∏è'
        };
        
        toast.innerHTML = `
            <div class="toast-icon">${icons[type]}</div>
            <div class="toast-content">
                ${title ? `<div class="toast-title">${title}</div>` : ''}
                <div class="toast-message">${message}</div>
            </div>
            <button class="toast-close">√ó</button>
        `;
        
        container.appendChild(toast);
        
        const removeToast = () => {
            if (toast.parentNode) {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.parentNode?.removeChild(toast), 300);
            }
        };

        setTimeout(removeToast, 5000);
        toast.querySelector('.toast-close').addEventListener('click', removeToast);
    }

    // Helper Functions
    function getInitials(name) {
        if (!name) return '';
        const names = name.split(' ');
        return names.length > 1 ? 
            `${names[0][0]}${names[names.length - 1][0]}`.toUpperCase() : 
            `${names[0][0]}`.toUpperCase();
    }

    function formatDate(dateString) {
        if (!dateString) return 'N/A';
        return new Date(dateString).toLocaleDateString('en-EG', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric',
            timeZone: 'Africa/Cairo'
        });
    }

    function formatDateTime(dateString) {
        if (!dateString) return 'N/A';
        return new Date(dateString).toLocaleString('en-EG', { 
            year: 'numeric', 
            month: 'short', 
            day: 'numeric', 
            hour: '2-digit', 
            minute: '2-digit',
            timeZone: 'Africa/Cairo'
        });
    }

    function showModal(modalId) { 
        document.getElementById(modalId)?.classList.add('show'); 
    }
    
    function hideModal(modalId) { 
        document.getElementById(modalId)?.classList.remove('show'); 
    }

    // Confirmation Modal
    function showConfirmationModal({ title, message, confirmText = 'Confirm', onConfirm }) {
        const modal = document.getElementById('confirmation-modal');
        modal.querySelector('#confirmation-title').textContent = title;
        modal.querySelector('#confirmation-message').textContent = message;
        const confirmBtn = modal.querySelector('#confirmation-confirm-btn');
        confirmBtn.textContent = confirmText;

        const newConfirmBtn = confirmBtn.cloneNode(true);
        confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn);

        newConfirmBtn.addEventListener('click', () => {
            onConfirm();
            hideModal('confirmation-modal');
        });

        showModal('confirmation-modal');
    }

    // Main Application Logic
    async function initApp() {
        try {
            showToast('Loading your dashboard...', 'info');
            
            const user = await getCurrentUser();
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            
            const { data: profile, error } = await supabase
                .from('users')
                .select('*')
                .eq('id', user.id)
                .single();
            
            if (error) throw error;
            
            currentUser = { ...user, ...profile };
            updateUserInterface();
            initCharts();
            
            await loadUserErrors();
            await Promise.all([
                loadUserPerformance(),
                loadNotifications()
            ]);

            initRealtimeSubscriptions();
            showToast('Dashboard loaded successfully!', 'success');
        } catch (error) {
            console.error('Error initializing app:', error);
            showToast('Failed to load dashboard', 'error');
        }
    }

    function updateUserInterface() {
        if (!currentUser) return;
        
        document.getElementById('sidebar-avatar-initials').textContent = getInitials(currentUser.name);
        document.getElementById('sidebar-username').textContent = currentUser.name;
        document.getElementById('sidebar-userrole').textContent = currentUser.role;
        
        const firstName = currentUser.name.split(' ')[0];
        document.getElementById('welcome-user-h2').textContent = `Welcome back, ${firstName}!`;
        
        document.getElementById('profile-fullname').value = currentUser.name;
        document.getElementById('profile-email').value = currentUser.email;
        document.getElementById('profile-phone').value = currentUser.phone || '';
        document.getElementById('profile-department').value = currentUser.department || 'N/A';
    }

    async function loadUserErrors(filters = {}) {
        try {
            const errors = await getAgentErrors(currentUser.id, filters);
            userErrors = errors || [];
            filteredUserErrors = [...userErrors]; // Initialize filtered list
            dashboardCurrentPage = 1;
            myErrorsCurrentPage = 1;
            renderErrorTables();
        } catch (error) {
            console.error('Error loading user errors:', error);
            showToast('Failed to load your errors', 'error');
            userErrors = [];
            filteredUserErrors = [];
            renderErrorTables();
        }
    }

    async function loadUserPerformance() {
        try {
            const totalErrors = userErrors.length;
            const totalOrders = 20; // This should ideally come from the backend
    
            const errorRate = totalOrders > 0 ? ((totalErrors / totalOrders) * 100).toFixed(1) : 0;
            
            document.getElementById('error-rate').textContent = `${errorRate}%`;
            document.getElementById('error-rate-bar').style.width = `${Math.min(errorRate, 100)}%`;
            document.getElementById('error-rate-description').textContent = 
                `Based on ${totalErrors} errors out of ${totalOrders} reviewed orders.`;
    
            const errorTypes = {};
            userErrors.forEach(error => {
                const type = error.error_type || 'Unknown';
                errorTypes[type] = (errorTypes[type] || 0) + 1;
            });
            userPerformance.errorTypes = errorTypes;
            
            updateCharts();
        } catch (error) {
            console.error('Error loading user performance:', error);
            document.getElementById('error-rate').textContent = 'N/A';
        }
    }

    function renderErrorTables() {
        renderPaginatedTable('error-table-body', userErrors, dashboardCurrentPage, 'dashboard-pagination');
        renderPaginatedTable('my-errors-table-body', filteredUserErrors, myErrorsCurrentPage, 'my-errors-pagination');
    }
    
    // *** UPDATED/REPLACED FUNCTION ***
    function renderPaginatedTable(tbodyId, data, currentPage, paginationId) {
        const tbody = document.getElementById(tbodyId);
        const paginationControls = document.getElementById(paginationId);
        
        if (!tbody || !paginationControls) return;

        const startIndex = (currentPage - 1) * ITEMS_PER_PAGE;
        const endIndex = startIndex + ITEMS_PER_PAGE;
        const paginatedData = data.slice(startIndex, endIndex);
        const totalPages = Math.ceil(data.length / ITEMS_PER_PAGE);

        if (data.length === 0) {
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="empty-state">
                        <div class="empty-state-icon">‚úÖ</div>
                        <div>No errors found.</div>
                        <small>Great job maintaining quality standards!</small>
                    </td>
                </tr>`;
            paginationControls.style.display = 'none';
        } else {
            tbody.innerHTML = paginatedData.map(error => {
                const orderId = error.order_id || 'N/A';
                const orderDate = error.created_at;
                const errorType = error.error_type || 'Unknown';
                const status = error.status.replace(/_/g, ' ');

                let actionButtons = '';
                const viewButtonText = error.final_decision ? 'View Decision' : 'View';
                const viewButton = `<button class="action-btn view-error-btn" data-error-id="${error.error_id}">üëÅÔ∏è ${viewButtonText}</button>`;
                const appealButton = `<button class="action-btn warning appeal-error-btn" data-error-id="${error.error_id}">Appeal</button>`;

                if (error.status === 'closed' && !error.final_decision) {
                    actionButtons = viewButton + appealButton;
                } else {
                    actionButtons = viewButton;
                }
                
                return `
                    <tr>
                        <td><strong>${orderId}</strong></td>
                        <td>${formatDate(orderDate)}</td>
                        <td>${errorType}</td>
                        <td><span class="status-badge status-${error.status}">${status}</span></td>
                        <td class="action-buttons">${actionButtons}</td>
                    </tr>
                `;
            }).join('');

            paginationControls.style.display = 'flex';
            paginationControls.querySelector('.page-info').textContent = `Page ${currentPage} of ${totalPages}`;
            paginationControls.querySelector('.prev-btn').disabled = currentPage === 1;
            paginationControls.querySelector('.next-btn').disabled = currentPage === totalPages;
        }
    }


    function setupPaginationListeners() {
        document.getElementById('dashboard-pagination').addEventListener('click', e => {
            if (e.target.classList.contains('prev-btn') && dashboardCurrentPage > 1) {
                dashboardCurrentPage--;
                renderPaginatedTable('error-table-body', userErrors, dashboardCurrentPage, 'dashboard-pagination');
            } else if (e.target.classList.contains('next-btn')) {
                 const totalPages = Math.ceil(userErrors.length / ITEMS_PER_PAGE);
                if (dashboardCurrentPage < totalPages) {
                    dashboardCurrentPage++;
                    renderPaginatedTable('error-table-body', userErrors, dashboardCurrentPage, 'dashboard-pagination');
                }
            }
        });

        document.getElementById('my-errors-pagination').addEventListener('click', e => {
            if (e.target.classList.contains('prev-btn') && myErrorsCurrentPage > 1) {
                myErrorsCurrentPage--;
                renderPaginatedTable('my-errors-table-body', filteredUserErrors, myErrorsCurrentPage, 'my-errors-pagination');
            } else if (e.target.classList.contains('next-btn')) {
                const totalPages = Math.ceil(filteredUserErrors.length / ITEMS_PER_PAGE);
                if (myErrorsCurrentPage < totalPages) {
                    myErrorsCurrentPage++;
                    renderPaginatedTable('my-errors-table-body', filteredUserErrors, myErrorsCurrentPage, 'my-errors-pagination');
                }
            }
        });
    }
    
    // *** UPDATED/REPLACED FUNCTION ***
    function openViewErrorModal(errorId) {
        const error = userErrors.find(e => String(e.error_id) === String(errorId));
        if (!error) return;
    
        document.getElementById('view-error-id').textContent = error.order_id || 'N/A';
        
        let contentHtml = `
            <div class="detail-item"><strong>Order ID</strong><p>${error.order_id || 'N/A'}</p></div>
            <div class="detail-item"><strong>Date Recorded</strong><p>${formatDate(error.created_at)}</p></div>
            <div class="detail-item"><strong>Error Type</strong><p>${error.error_type || 'Unknown'}</p></div>
            <div class="detail-item"><strong>Status</strong><p><span class="status-badge status-${error.status}">${error.status.replace(/_/g, ' ')}</span></p></div>
        `;

        if (error.final_decision) {
            const decisionClass = error.final_decision === 'overturned' ? 'status-overturned' : 'status-closed';
            contentHtml += `
                <hr style="border-color: var(--border-color); margin: 1.5rem 0;">
                <div class="detail-item" style="background-color: #222;">
                    <strong>Senior's Final Decision</strong>
                    <p style="font-size: 1.1rem; margin-top: 0.5rem;"><span class="status-badge ${decisionClass}">${error.final_decision}</span> by ${error.decided_by_name || 'Senior'}</p>
                    <small style="color: var(--text-muted);">${formatDateTime(error.decided_at)}</small>
                </div>
                <div class="detail-item">
                    <strong>Senior's Notes</strong>
                    <p style="white-space: pre-wrap; color: var(--text-muted);">${error.decision_notes || 'No notes provided.'}</p>
                </div>
            `;
        } else if (error.status === 'under_review') {
             contentHtml += `<hr style="border-color: var(--border-color); margin: 1rem 0;"><p style="color: var(--text-muted); padding: 1rem 0;">Your appeal is currently under review by a senior quality analyst.</p>`;
        }
        
        document.getElementById('view-error-body').innerHTML = contentHtml;
        showModal('view-error-modal');
    }

    async function handleResponseSubmission() {
        const btn = document.getElementById('submit-response-btn');
        const errorId = btn.dataset.errorId;
        const responseText = document.getElementById('error-response').value.trim();
        
        if (!responseText) {
            showToast('Please enter your response before submitting', 'warning');
            return;
        }

        btn.disabled = true;
        btn.textContent = 'Submitting...';
        try {
            await submitErrorResponse(errorId, currentUser.id, responseText);
            showToast('Your response has been submitted successfully!', 'success');
            hideModal('reply-error-modal');
            await loadUserErrors();
            await loadUserPerformance();
        } catch (error) {
            console.error('Error submitting response:', error);
            showToast('Failed to submit your response. Please try again.', 'error');
        } finally {
            btn.disabled = false;
            btn.textContent = 'Submit Response';
        }
    }

    async function loadNotifications() {
        try {
            notifications = await getNotifications(currentUser.id) || [];
            updateNotificationsUI();
        } catch (error) {
            console.error('Error loading notifications:', error);
            notifications = [];
            updateNotificationsUI();
        }
    }

    function updateNotificationsUI() {
        const list = document.getElementById('notification-list');
        const badge = document.getElementById('notification-badge');
        const unreadCount = notifications.filter(n => !n.is_read).length;

        badge.textContent = unreadCount;
        badge.style.display = unreadCount > 0 ? 'flex' : 'none';

        if (notifications.length === 0) {
            list.innerHTML = '<li class="notification-item empty">No new notifications</li>';
        } else {
            list.innerHTML = notifications.map(n => `
                <li class="notification-item ${n.is_read ? 'read' : 'unread'}" data-notification-id="${n.id}">
                    <div class="notification-message">
                        <div class="notification-text">${n.message}</div>
                        <div class="notification-time">${formatDateTime(n.created_at)}</div>
                    </div>
                    ${!n.is_read ? `<button class="mark-read-btn" data-notification-id="${n.id}" title="Mark as read">‚úì</button>` : ''}
                </li>
            `).join('');
            
            list.querySelectorAll('.mark-read-btn').forEach(btn => {
                btn.addEventListener('click', async (e) => {
                    e.stopPropagation();
                    const notificationId = btn.dataset.notificationId;
                    btn.disabled = true;
                    try {
                        await markNotificationAsRead(notificationId);
                        await loadNotifications();
                    } catch (error) {
                        console.error('Error marking notification as read:', error);
                    }
                });
            });
        }
    }

    function initRealtimeSubscriptions() {
        if (typeof subscribeToNotifications === 'function') {
            subscribeToNotifications(currentUser.id, (payload) => {
                if (payload.new && payload.new.user_id === currentUser.id) {
                    showToast(payload.new.message, 'info', 'New Notification');
                    loadNotifications();
                }
            });
        }

        if (typeof subscribeToErrors === 'function') {
            subscribeToErrors(currentUser.id, (payload) => {
                if (payload.new && payload.new.employee_id === currentUser.id) {
                    showToast('A new error has been logged for you', 'warning', 'New Error');
                    loadUserErrors();
                    loadUserPerformance();
                }
            });
        }
    }

    function initCharts() {
        Chart.defaults.font.family = "'Poppins', sans-serif";
        const ctx = document.getElementById('commonErrorsChart').getContext('2d');
        commonErrorsChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['No Errors Yet'],
                datasets: [{ data: [1], backgroundColor: ['#333'], borderWidth: 2, borderColor: '#1a1a1a' }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'bottom', labels: { color: '#e6edf3', font: { family: 'Poppins', size: 14 } } },
                    tooltip: { backgroundColor: 'rgba(26, 26, 26, 0.9)', titleColor: '#00bfff', bodyColor: '#e6edf3', borderColor: '#333', borderWidth: 1, titleFont: { family: 'Poppins', size: 14, weight: 'bold' }, bodyFont: { family: 'Poppins', size: 12 } }
                },
                cutout: '60%'
            }
        });
    }

    function updateCharts() {
        if (!commonErrorsChart) return;
        
        const labels = Object.keys(userPerformance.errorTypes);
        const data = Object.values(userPerformance.errorTypes);
        
        if (labels.length > 0) {
            commonErrorsChart.data.labels = labels;
            commonErrorsChart.data.datasets[0].data = data;
            commonErrorsChart.data.datasets[0].backgroundColor = ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40'];
        } else {
            commonErrorsChart.data.labels = ['No Errors'];
            commonErrorsChart.data.datasets[0].data = [1];
            commonErrorsChart.data.datasets[0].backgroundColor = ['#333'];
        }
        commonErrorsChart.update();
    }

    function setupFilters() {
        document.getElementById('apply-filters-btn').addEventListener('click', () => {
            const filters = {
                order_id: document.getElementById('filter-order-id')?.value || null,
                from_date: document.getElementById('filter-from-date')?.value || null,
                to_date: document.getElementById('filter-to-date')?.value || null
            };
            Object.keys(filters).forEach(key => filters[key] == null && delete filters[key]);
            loadUserErrors(filters);
        });
        
        document.getElementById('reset-filters-btn').addEventListener('click', () => {
            document.getElementById('filter-order-id').value = '';
            document.getElementById('filter-from-date').value = '';
            document.getElementById('filter-to-date').value = '';
            loadUserErrors();
        });

        document.getElementById('apply-my-errors-filters').addEventListener('click', () => {
            const searchTerm = document.getElementById('my-errors-search').value.toLowerCase().trim();
            const statusFilter = document.getElementById('my-errors-status').value;
            
            filteredUserErrors = userErrors.filter(error => {
                const searchMatch = !searchTerm || 
                                    (error.order_id && error.order_id.toLowerCase().includes(searchTerm)) || 
                                    (error.error_type && error.error_type.toLowerCase().includes(searchTerm));
                const statusMatch = statusFilter === 'all' || error.status === statusFilter;
                return searchMatch && statusMatch;
            });
            myErrorsCurrentPage = 1;
            renderErrorTables();
        });
        
        document.getElementById('reset-my-errors-filters').addEventListener('click', () => {
            document.getElementById('my-errors-search').value = '';
            document.getElementById('my-errors-status').value = 'all';
            filteredUserErrors = [...userErrors];
            myErrorsCurrentPage = 1;
            renderErrorTables();
        });
    }

    function setupEventListeners() {
        document.querySelectorAll('.sidebar-nav a[data-tab]').forEach(tab => {
            tab.addEventListener('click', e => {
                e.preventDefault();
                document.querySelectorAll('.sidebar-nav a').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                const tabId = tab.dataset.tab;
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                document.getElementById(tabId).classList.add('active');
                document.getElementById('page-title-header').textContent = tab.textContent.replace(/[^\w\s]/gi, '').trim();
            });
        });

        document.querySelectorAll('.settings-nav a').forEach(link => {
            link.addEventListener('click', e => {
                e.preventDefault();
                document.querySelectorAll('.settings-nav a').forEach(a => a.classList.remove('active'));
                link.classList.add('active');
                const sectionId = link.dataset.section;
                document.querySelectorAll('.setting-card').forEach(s => s.style.display = 'none');
                document.getElementById(`settings-section-${sectionId}`).style.display = 'block';
            });
        });

        document.querySelector('.main-content').addEventListener('click', (e) => {
            const viewBtn = e.target.closest('.view-error-btn');
            const appealBtn = e.target.closest('.appeal-error-btn');

            if (viewBtn) {
                openViewErrorModal(viewBtn.dataset.errorId);
            } else if (appealBtn) {
                const errorId = appealBtn.dataset.errorId;
                const modal = document.getElementById('appeal-error-modal');
                if (modal) {
                    modal.querySelector('#appeal-reason').value = '';
                    modal.querySelector('#submit-appeal-btn').dataset.errorId = errorId;
                    showModal('appeal-error-modal');
                }
            }
        });
        
        document.getElementById('notification-btn').addEventListener('click', e => { e.stopPropagation(); document.getElementById('notification-dropdown').classList.toggle('show'); });
        
        document.getElementById('mark-all-read-btn').addEventListener('click', async e => {
            e.stopPropagation();
            const unread = notifications.filter(n => !n.is_read);
            if (unread.length === 0) return showToast('No unread notifications', 'info');
            try {
                await Promise.all(unread.map(n => markNotificationAsRead(n.id)));
                await loadNotifications();
                showToast('All notifications marked as read', 'success');
            } catch (error) { showToast('Failed to mark all as read', 'error'); }
        });
        
        document.getElementById('submit-response-btn').addEventListener('click', handleResponseSubmission);
        
        document.getElementById('submit-appeal-btn').addEventListener('click', async function() {
            const btn = this;
            const errorId = btn.dataset.errorId;
            const reason = document.getElementById('appeal-reason').value.trim();
            if (!reason) { showToast('Please provide a reason for your appeal.', 'warning'); return; }

            btn.disabled = true; btn.textContent = 'Submitting...';
            try {
                const { error: responseError } = await supabase.from('error_responses').insert({
                    error_id: errorId,
                    response_by_id: currentUser.id,
                    response_text: reason,
                    response_type: 'appeal'
                });
                if(responseError) throw responseError;
                
                const { error } = await supabase.from('errors').update({ status: 'under_review' }).eq('id', errorId);
                if (error) throw error;
                
                showToast('Appeal submitted successfully!', 'success');
                hideModal('appeal-error-modal');
                await loadUserErrors();

            } catch (error) {
                console.error('Error submitting appeal:', error);
                showToast('Failed to submit appeal.', 'error');
            } finally {
                btn.disabled = false; btn.textContent = 'Submit Appeal';
            }
        });
        
        document.getElementById('save-profile-btn').addEventListener('click', async () => {
            const name = document.getElementById('profile-fullname').value.trim();
            const phone = document.getElementById('profile-phone').value.trim();
            if (!name) return showToast('Please enter your name', 'warning');
            try {
                await updateUserProfile(currentUser.id, { name, phone });
                currentUser = { ...currentUser, name, phone };
                updateUserInterface();
                showToast('Profile updated successfully!', 'success');
            } catch (error) { showToast('Failed to update profile', 'error'); }
        });
        
        document.getElementById('logout-btn').addEventListener('click', () => {
            showConfirmationModal({
                title: 'Logout', message: 'Are you sure you want to logout?', confirmText: 'Logout',
                onConfirm: async () => {
                    try { await supabase.auth.signOut(); window.location.href = 'login.html'; } catch (error) { showToast('Error during logout', 'error'); }
                }
            });
        });

        document.getElementById('change-password-btn').addEventListener('click', () => { showModal('change-password-modal'); });
        document.querySelectorAll('.setting-item .toggle-switch input').forEach(toggle => {
            toggle.addEventListener('change', () => {
                const label = toggle.closest('.setting-item').querySelector('span').textContent;
                const status = toggle.checked ? 'enabled' : 'disabled';
                showToast(`${label} ${status}.`, 'success', 'Setting Updated');
            });
        });
        
        document.querySelectorAll('.modal-close-btn').forEach(btn => {
            btn.addEventListener('click', () => hideModal(btn.dataset.modalId));
        });

        document.addEventListener('click', e => {
            if (!e.target.closest('.notification-bell')) { document.getElementById('notification-dropdown').classList.remove('show'); }
            if (e.target.classList.contains('modal-overlay')) { e.target.classList.remove('show'); }
        });

        const globalSearch = document.getElementById('global-search');
        globalSearch.addEventListener('input', e => {
            const searchTerm = e.target.value.trim().toLowerCase();
            document.getElementById('my-errors-search').value = searchTerm;
            document.getElementById('apply-my-errors-filters').click();
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        initApp();
        setupEventListeners();
        setupFilters();
        setupPaginationListeners();
    });
</script>

<style>
    :root {
        --primary-color: #00bfff;
        --primary-hover: #00a4d9;
        --bg-color: #121212;
        --sidebar-bg: #1a1a1a;
        --card-bg: #1a1a1a;
        --text-color: #e6edf3;
        --text-muted: #8b949e;
        --border-color: #333;
        --red: #dc3545;
        --red-bg: rgba(220, 53, 69, 0.1);
        --green: #28a745;
        --green-bg: rgba(40, 167, 69, 0.1);
        --yellow: #ffc107;
        --yellow-bg: rgba(255, 193, 7, 0.1);
        --border-radius-base: 0.75rem;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html { scroll-behavior: smooth; }
    body { font-family: 'Poppins', sans-serif; background-color: var(--bg-color); color: var(--text-color); display: flex; min-height: 100vh; line-height: 1.6; font-size: 16px; }
    .sidebar { width: 260px; background-color: var(--sidebar-bg); height: 100vh; position: fixed; left: 0; top: 0; border-right: 1px solid var(--border-color); display: flex; flex-direction: column; z-index: 1000; }
    .sidebar-header { display: flex; align-items: center; gap: 10px; padding: 20px; border-bottom: 1px solid var(--border-color); }
    .sidebar-logo { height: 32px; fill: var(--primary-color); }
    .sidebar-title { font-size: 1.25rem; color: var(--primary-color); font-weight: 700; }
    .sidebar-nav-container { flex-grow: 1; overflow-y: auto; padding-top: 1rem; }
    .nav-group { margin-bottom: 1.5rem; padding: 0 20px; }
    .nav-group-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); font-weight: 600; margin-bottom: 0.75rem; }
    .sidebar-nav { list-style: none; padding: 0; margin: 0; }
    .sidebar-nav a { display: flex; align-items: center; padding: 12px 15px; border-radius: 8px; color: var(--text-muted); text-decoration: none; margin-bottom: 10px; transition: all 0.3s ease; gap: 15px; cursor: pointer; font-weight: 500; }
    .sidebar-nav a:hover, .sidebar-nav a.active { background-color: var(--primary-color); color: #000; transform: translateX(5px); }
    .sidebar-footer { padding: 15px 20px; border-top: 1px solid var(--border-color); }
    .user-profile-widget { display: flex; align-items: center; gap: 12px; }
    .avatar-initials { width: 44px; height: 44px; border-radius: 50%; background-color: var(--primary-color); color: black; font-weight: 700; font-size: 1rem; display: inline-flex; align-items: center; justify-content: center; }
    .user-name { font-weight: 600; font-size: 1rem; }
    .user-role { font-size: 0.8rem; color: var(--text-muted); }
    .main-content { margin-left: 260px; width: calc(100% - 260px); padding: 30px; flex: 1; display: flex; flex-direction: column; }
    .content-wrapper { flex: 1; }
    .tab-content { display: none; }
    .tab-content.active { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; gap: 1rem; }
    .header-left { flex-grow: 1; }
    .header-actions { display: flex; align-items: center; gap: 1rem; }
    .page-title { font-size: 24px; font-weight: 700; }
    #welcome-message { margin-bottom: 30px; }
    #welcome-message h2 { font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem; }
    #welcome-message p { color: var(--text-muted); }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .card { background: var(--card-bg); padding: 25px; border-radius: var(--border-radius-base); border: 1px solid var(--border-color); transition: transform 0.3s ease, box-shadow 0.3s ease; }
    .card:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3); }
    .card h3 { font-size: 18px; font-weight: 600; margin-bottom: 20px; }
    .progress-card .progress-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .progress-card .progress-value { font-size: 24px; font-weight: 600; }
    .progress-bar { width: 100%; height: 10px; background-color: #2c2c2c; border-radius: 5px; overflow: hidden; margin-top: 10px; }
    .progress-bar-inner { height: 100%; border-radius: 5px; transition: width 0.3s ease; }
    .chart-container { position: relative; height: 250px; }
    .table-container { background: var(--card-bg); padding: 20px; border-radius: var(--border-radius-base); border: 1px solid var(--border-color); overflow-x: auto; }
    .table-container h3 { margin-bottom: 25px; }
    table { width: 100%; border-collapse: collapse; min-width: 600px; }
    th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: middle; }
    th { font-weight: 600; font-size: 14px; color: var(--text-muted); text-transform: uppercase; background-color: #2c2c2c; }
    tbody tr:last-child td { border-bottom: none; }
    tbody tr:hover { background-color: #2c2c2c; }
    .status-badge { padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; display: inline-block; text-transform: capitalize; }
    .status-pending, .status-under_review, .status-pending_response { background-color: var(--yellow-bg); color: var(--yellow); }
    .status-responded, .status-overturned { background-color: var(--green-bg); color: var(--green); }
    .status-finalized, .status-closed { background-color: var(--red-bg); color: var(--red); }
    .action-buttons { display: flex; gap: 8px; flex-wrap: wrap; }
    .action-btn { background: #333; border: none; cursor: pointer; color: var(--text-color); font-size: 14px; padding: 10px 18px; border-radius: 6px; transition: all 0.3s ease; white-space: nowrap; }
    .action-btn:hover { background: #444; transform: translateY(-1px); }
    .action-btn.warning { background-color: var(--yellow-bg); color: var(--yellow); }
    .action-btn.warning:hover { background-color: rgba(255, 193, 7, 0.2); }
    .search-input-container input[type="search"] { background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 10px 12px; width: 250px; transition: border-color 0.3s ease; }
    .search-input-container input[type="search"]:focus { border-color: var(--primary-color); outline: none; }
    .notification-bell { position: relative; }
    .notification-btn { background: none; border: none; color: var(--text-muted); font-size: 24px; cursor: pointer; padding: 5px; position: relative; transition: color 0.3s ease; }
    .notification-btn:hover { color: var(--primary-color); }
    .notification-badge { position: absolute; top: 0px; right: 0px; background: var(--red); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 10px; display: flex; align-items: center; justify-content: center; border: 2px solid var(--card-bg); }
    .notification-dropdown { display: none; position: absolute; right: 0; top: 120%; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-base); width: 350px; box-shadow: 0 8px 16px rgba(0,0,0,0.3); z-index: 10; }
    .notification-dropdown.show { display: block; animation: slideDown 0.3s ease; }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .notification-header { padding: 1rem; border-bottom: 1px solid var(--border-color); font-weight: 600; display: flex; justify-content: space-between; align-items: center; }
    .notification-list { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; }
    .notification-item { padding: 1rem; border-bottom: 1px solid var(--border-color); font-size: 14px; display: flex; justify-content: space-between; align-items: flex-start; transition: background-color 0.3s ease; }
    .notification-item:hover { background-color: #2c2c2c; }
    .notification-item:last-child { border-bottom: none; }
    .notification-item.read { opacity: 0.6; }
    .notification-item.empty { justify-content: center; text-align: center; color: var(--text-muted); }
    .notification-message { flex: 1; }
    .notification-time { font-size: 12px; color: var(--text-muted); }
    .mark-read-btn { background: none; border: none; color: var(--primary-color); cursor: pointer; font-size: 14px; padding: 4px 8px; border-radius: 4px; transition: background-color 0.3s ease; }
    .mark-read-btn:hover { background-color: rgba(0, 191, 255, 0.1); }
    .filter-panel { display: flex; gap: 15px; flex-wrap: wrap; align-items: flex-end; padding: 20px; background: #222; border-radius: var(--border-radius-base); margin-bottom: 30px; border: 1px solid var(--border-color); }
    .filter-group { flex: 1; min-width: 150px; }
    .filter-group label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 14px; }
    .filter-group input, .filter-group select { width: 100%; padding: 10px; border: 1px solid var(--border-color); border-radius: 8px; font-family: 'Poppins'; background: #2c2c2c; color: #fff; }
    .btn { padding: 12px 22px; border: none; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; font-family: 'Poppins'; }
    .btn:disabled { background-color: #555 !important; cursor: not-allowed; opacity: 0.6; }
    .btn-primary { background: var(--primary-color); color: #000; }
    .btn-primary:hover:not(:disabled) { background: var(--primary-hover); }
    .btn-secondary { background: #333; color: white; }
    .btn-secondary:hover:not(:disabled) { background: #444; }
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1001; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); padding: 20px; }
    .modal-overlay.show { display: flex; animation: fadeIn 0.3s ease; }
    .modal-box { background: var(--card-bg); padding: 2.5rem; border-radius: var(--border-radius-base); border: 1px solid var(--border-color); width: 90%; max-width: 550px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); max-height: 90vh; overflow-y: auto; }
    .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1.5rem; margin-bottom: 1.5rem; }
    .modal-title { font-size: 1.25rem; font-weight: 700; }
    .modal-close-btn { background: none; border: none; color: var(--text-muted); font-size: 1.5rem; cursor: pointer; padding: 5px; border-radius: 4px; transition: background-color 0.3s ease; }
    .modal-close-btn:hover { background-color: #2c2c2c; }
    .detail-item { background: #2c2c2c; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
    .detail-item strong { display: block; color: var(--primary-color); font-size: 0.8rem; text-transform: uppercase; margin-bottom: 0.5rem; letter-spacing: 0.5px; }
    .modal-footer { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; }
    .form-group { margin-bottom: 1.5rem; }
    .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
    .form-group input, .form-group textarea, .form-group select { width: 100%; background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 10px 12px; font-family: 'Poppins'; transition: border-color 0.3s ease; }
    .form-group input:focus, .form-group textarea:focus, .form-group select:focus { border-color: var(--primary-color); outline: none; }
    .form-group textarea { min-height: 120px; resize: vertical; }
    .page-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; border-top: 1px solid var(--border-color); padding-top: 1.5rem; }
    .settings-layout { display: flex; gap: 2rem; }
    .settings-nav { flex: 0 0 200px; }
    .settings-nav ul { list-style: none; padding: 0; }
    .settings-nav a { display: block; padding: 0.75rem 1rem; text-decoration: none; color: var(--text-muted); border-radius: 8px; font-weight: 500; margin-bottom: 5px; transition: all 0.3s ease; }
    .settings-nav a:hover, .settings-nav a.active { background-color: #2c2c2c; color: var(--text-color); }
    .settings-content { flex-grow: 1; }
    .setting-card { background-color: #222; padding: 1.5rem; border-radius: var(--border-radius-base); }
    .setting-item { display: flex; justify-content: space-between; align-items: center; padding: 1rem 0; border-bottom: 1px solid var(--border-color); }
    .setting-item:last-child { border-bottom: none; }
    .toggle-switch .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
    .toggle-switch .switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #3c3c3c; transition: .4s; border-radius: 24px; }
    .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--primary-color); }
    input:checked + .slider:before { transform: translateX(20px); }
    .toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
    .toast { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-base); padding: 15px 20px; margin-bottom: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: flex; align-items: center; gap: 10px; max-width: 350px; animation: slideInRight 0.3s ease; }
    .toast.success { border-left: 4px solid var(--green); }
    .toast.error { border-left: 4px solid var(--red); }
    .toast.warning { border-left: 4px solid var(--yellow); }
    .toast.info { border-left: 4px solid var(--primary-color); }
    .toast-icon { font-size: 20px; }
    .toast-content { flex: 1; }
    .toast-title { font-weight: 600; margin-bottom: 5px; }
    .toast-message { font-size: 14px; color: var(--text-muted); }
    .toast-close { background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 18px; padding: 0; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 4px; transition: background-color 0.3s ease; }
    .toast-close:hover { background-color: #2c2c2c; }
    @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .empty-state { text-align: center; padding: 40px; color: var(--text-muted); }
    .empty-state-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.5; }
    .site-footer { text-align: center; padding: 20px; color: var(--text-muted); font-size: 0.9rem; border-top: 1px solid var(--border-color); flex-shrink: 0; margin-top: auto; }
    .placeholder-content { display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; min-height: 200px; }
    .pagination-controls { display: flex; justify-content: flex-end; align-items: center; gap: 1rem; margin-top: 1.5rem; }
    .pagination-controls .btn { padding: 8px 16px; }
    .pagination-controls .page-info { font-size: 0.9rem; color: var(--text-muted); }
    @media (max-width: 768px) {
        body { flex-direction: column; }
        .sidebar { width: 100%; height: auto; position: relative; }
        .main-content { margin-left: 0; width: 100%; padding: 20px; }
        .stats-grid { grid-template-columns: 1fr; }
        .filter-panel { flex-direction: column; }
        .filter-group { min-width: 100%; }
        .settings-layout { flex-direction: column; }
        .settings-nav { flex: none; }
        .notification-dropdown { width: 300px; right: -50px; }
        .site-footer { margin-left: 0; }
    }
</style>

</head>
<body>
    <aside class="sidebar">
        <div>
            <div class="sidebar-header">
                <svg class="sidebar-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5-10-5-10 5z" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" fill-opacity="0.3"></path><path d="M12 22V12" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                <h1 class="sidebar-title">QualityX</h1>
            </div>
            <div class="sidebar-nav-container">
                <div class="nav-group"><h2 class="nav-group-title">Menu</h2><ul class="sidebar-nav"><li><a class="active" data-tab="dashboard"><span>üìä</span>Dashboard</a></li><li><a data-tab="my-errors"><span>‚ùå</span>My Errors</a></li></ul></div>
                <div class="nav-group"><h2 class="nav-group-title">Account</h2><ul class="sidebar-nav"><li><a data-tab="profile"><span>üë§</span>Profile</a></li><li><a data-tab="settings"><span>‚öôÔ∏è</span>Settings</a></li><li><a data-tab="help"><span>‚ùì</span>Get Help</a></li><li><a id="logout-btn"><span>üö™</span>Logout</a></li></ul></div>
            </div>
        </div>
        <div class="sidebar-footer">
            <div class="user-profile-widget"><div class="avatar-initials" id="sidebar-avatar-initials">--</div><div><div class="user-name" id="sidebar-username">Loading...</div><div class="user-role" id="sidebar-userrole">Loading...</div></div></div>
        </div>
    </aside>

    <main class="main-content">
        <div class="content-wrapper">
            <header>
                <div class="header-left"><h2 class="page-title" id="page-title-header">Dashboard</h2></div>
                <div class="header-actions">
                    <div class="search-input-container"><input type="search" id="global-search" placeholder="Search my errors..." autocomplete="off" name="agent-search-global" autocorrect="off" autocapitalize="off" spellcheck="false"></div>
                    <div class="notification-bell">
                        <button id="notification-btn" class="notification-btn"><svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><span class="notification-badge" id="notification-badge" style="display: none;">0</span></button>
                        <div id="notification-dropdown" class="notification-dropdown">
                            <div class="notification-header"><span>Notifications</span><button id="mark-all-read-btn" class="mark-read-btn">Mark all as read</button></div>
                            <ul class="notification-list" id="notification-list"><li class="notification-item">Loading notifications...</li></ul>
                        </div>
                    </div>
                </div>
            </header>

            <div id="dashboard" class="tab-content active">
                <div id="welcome-message"><h2 id="welcome-user-h2">Welcome back!</h2><p>Here's a look at your performance metrics for this month.</p></div>
                <section class="stats-grid">
                    <div class="card progress-card"><h3>Your Current Error Rate</h3><div class="progress-info"><span class="progress-label">This Month</span><span class="progress-value" id="error-rate">0%</span></div><div class="progress-bar"><div class="progress-bar-inner" id="error-rate-bar" style="width: 0%; background-color: var(--red);"></div></div><p style="font-size: 12px; color: var(--text-muted); margin-top: 10px;" id="error-rate-description">Based on 0 errors out of 0 reviewed orders.</p></div>
                    <div class="card"><h3>Most Frequent Error Types</h3><div class="chart-container"><canvas id="commonErrorsChart"></canvas></div></div>
                </section>
                <section class="filter-panel"><div class="filter-group"><label for="filter-order-id">Order ID</label><input type="search" id="filter-order-id" autocomplete="off" placeholder="Search by Order ID..." autocorrect="off" autocapitalize="off" spellcheck="false"></div><div class="filter-group"><label for="filter-from-date">From</label><input type="date" id="filter-from-date" style="color-scheme: dark;"></div><div class="filter-group"><label for="filter-to-date">To</label><input type="date" id="filter-to-date" style="color-scheme: dark;"></div><button class="btn btn-primary" id="apply-filters-btn">Apply Filters</button><button class="btn btn-secondary" id="reset-filters-btn">Reset</button></section>
                <section class="table-container"><h3>Recent Errors Logged</h3><table><thead><tr><th>Order ID</th><th>Order Date</th><th>Error Type</th><th>Status</th><th>Action</th></tr></thead><tbody id="error-table-body"><tr><td colspan="5" class="empty-state">Loading your errors...</td></tr></tbody></table><div class="pagination-controls" id="dashboard-pagination"><span class="page-info">Page 1 of 1</span><button class="btn btn-secondary prev-btn">Previous</button><button class="btn btn-secondary next-btn">Next</button></div></section>
            </div>

            <div id="my-errors" class="tab-content">
                <div class="card"><h3>All My Errors</h3><p class="text-muted" style="margin-top:-1rem; margin-bottom: 2rem;">A detailed list and history of all your errors.</p>
                    <div class="filter-panel"><div class="filter-group"><label for="my-errors-search">Search</label><input type="search" id="my-errors-search" name="agent-search-errors" placeholder="Search by Order ID or Error Type..." autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></div><div class="filter-group"><label for="my-errors-status">Status</label><select id="my-errors-status"><option value="all">All Statuses</option><option value="closed">Closed</option><option value="under_review">Under Review</option><option value="overturned">Overturned</option></select></div><button class="btn btn-primary" id="apply-my-errors-filters">Apply Filters</button><button class="btn btn-secondary" id="reset-my-errors-filters">Reset</button></div>
                    <div class="table-container"><table><thead><tr><th>Order ID</th><th>Error Date</th><th>Error Type</th><th>Status</th><th>Action</th></tr></thead><tbody id="my-errors-table-body"><tr><td colspan="5" class="empty-state">Loading your errors...</td></tr></tbody></table><div class="pagination-controls" id="my-errors-pagination"><span class="page-info">Page 1 of 1</span><button class="btn btn-secondary prev-btn">Previous</button><button class="btn btn-secondary next-btn">Next</button></div></div>
                </div>
            </div>

            <div id="profile" class="tab-content"><div class="card"><h3>Edit Profile</h3><div class="form-group"><label for="profile-fullname">Full Name</label><input type="text" id="profile-fullname"></div><div class="form-group"><label for="profile-email">Email Address</label><input type="email" id="profile-email" readonly style="background: #333;"></div><div class="form-group"><label for="profile-phone">Phone Number</label><input type="tel" id="profile-phone"></div><div class="form-group"><label for="profile-department">Department</label><input type="text" id="profile-department" readonly style="background: #333;"></div><div class="page-actions"><button class="btn btn-secondary" id="cancel-profile-btn">Cancel</button><button class="btn btn-primary" id="save-profile-btn">Save Changes</button></div></div></div>

            <div id="settings" class="tab-content">
                <div class="card"><h3>Account Settings</h3><p class="text-muted" style="margin-top:-1rem; margin-bottom: 2rem;">Manage your notification and account preferences.</p>
                    <div class="settings-layout">
                        <nav class="settings-nav"><ul><li><a href="#" class="active" data-section="notifications">Notifications</a></li><li><a href="#" data-section="security">Security</a></li></ul></nav>
                        <div class="settings-content">
                            <section class="setting-card active" id="settings-section-notifications"><div class="setting-item"><span>Email me when an error is logged</span><div class="toggle-switch"><label class="switch"><input type="checkbox" id="email-errors" checked><span class="slider"></span></label></div></div><div class="setting-item"><span>Email me a weekly performance summary</span><div class="toggle-switch"><label class="switch"><input type="checkbox" id="email-summary" checked><span class="slider"></span></label></div></div><div class="setting-item"><span>Enable Push Notifications</span><div class="toggle-switch"><label class="switch"><input type="checkbox" id="push-notifications"><span class="slider"></span></label></div></div></section>
                            <section class="setting-card" id="settings-section-security" style="display:none;"><div class="setting-item"><span>Password</span><button class="btn btn-secondary" id="change-password-btn">Change Password</button></div></section>
                        </div>
                    </div>
                </div>
            </div>

            <div id="help" class="tab-content"><div class="card"><div class="placeholder-content"><h3>Help Center</h3><p>Find answers to common questions or contact support for assistance.</p><div style="margin-top: 20px;"><button class="btn btn-primary" id="contact-support-btn">Contact Support</button></div></div></div></div>
        </div>
        <footer class="site-footer">¬© 2025 Mohamed Elmenisy. All rights reserved.</footer>
    </main>

    <!-- Modals -->
    <div class="modal-overlay" id="view-error-modal"><div class="modal-box"><div class="modal-header"><h3 class="modal-title">Error Details: <span id="view-error-id" style="color: var(--primary-color);"></span></h3><button class="modal-close-btn" data-modal-id="view-error-modal">√ó</button></div><div class="modal-body" id="view-error-body"></div><div class="modal-footer"><button class="btn btn-primary modal-close-btn" data-modal-id="view-error-modal">Close</button></div></div></div>
    <div class="modal-overlay" id="reply-error-modal"><div class="modal-box"><div class="modal-header"><h3 class="modal-title">Reply to Error: <span id="reply-error-id" style="color: var(--primary-color);"></span></h3><button class="modal-close-btn" data-modal-id="reply-error-modal">√ó</button></div><div class="modal-body"><div class="detail-item"><strong>Error Type</strong><p id="reply-error-type">Loading...</p></div><div class="detail-item"><strong>Date</strong><p id="reply-error-date">Loading...</p></div><div class="form-group"><label for="error-response">Your Response *</label><textarea id="error-response" placeholder="Please provide your response to this error..." required></textarea><small style="color: var(--text-muted);">This response will be reviewed by the quality team.</small></div></div><div class="modal-footer"><button class="btn btn-secondary modal-close-btn" data-modal-id="reply-error-modal">Cancel</button><button class="btn btn-primary" id="submit-response-btn">Submit Response</button></div></div></div>
    <div class="modal-overlay" id="change-password-modal"><div class="modal-box"><div class="modal-header"><h3 class="modal-title">Change Password</h3><button class="modal-close-btn" data-modal-id="change-password-modal">√ó</button></div><div class="modal-body"><div class="form-group"><label for="current-password">Current Password</label><input type="password" id="current-password"></div><div class="form-group"><label for="new-password">New Password</label><input type="password" id="new-password"></div><div class="form-group"><label for="confirm-password">Confirm New Password</label><input type="password" id="confirm-password"></div></div><div class="modal-footer"><button class="btn btn-secondary modal-close-btn" data-modal-id="change-password-modal">Cancel</button><button class="btn btn-primary" id="submit-password-change-btn">Update Password</button></div></div></div>
    <div class="modal-overlay" id="confirmation-modal"><div class="modal-box" style="max-width: 400px; text-align: center;"><div class="modal-header" style="border: none; justify-content: center;"><h3 class="modal-title" id="confirmation-title">Are you sure?</h3></div><div class="modal-body" style="padding: 0 1rem 1rem;"><p id="confirmation-message" style="color: var(--text-muted);">This action cannot be undone.</p></div><div class="modal-footer" style="justify-content: center;"><button class="btn btn-secondary modal-close-btn" data-modal-id="confirmation-modal">Cancel</button><button class="btn btn-primary" id="confirmation-confirm-btn">Confirm</button></div></div></div>

    <div class="toast-container" id="toast-container"></div>
    <!-- Appeal Error Modal -->
    <div class="modal-overlay" id="appeal-error-modal">
        <div class="modal-box" style="max-width: 500px;">
            <div class="modal-header">
                <h3 class="modal-title">Appeal Error</h3>
                <button class="modal-close-btn" data-modal-id="appeal-error-modal">√ó</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-muted); margin-bottom: 1rem;">Please provide the reason for your appeal. This will be sent to a senior quality analyst for review.</p>
                <div class="form-group">
                    <label for="appeal-reason">Reason for Appeal *</label>
                    <textarea id="appeal-reason" rows="4" placeholder="Explain why you believe the quality assessment was incorrect..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary modal-close-btn" data-modal-id="appeal-error-modal">Cancel</button>
                <button class="btn btn-primary" id="submit-appeal-btn">Submit Appeal</button>
            </div>
        </div>
    </div>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // ÿßÿ≥ÿ™ŸáÿØÿßŸÅ ŸÉŸÑ ŸÖÿ±ÿ®ÿπÿßÿ™ ÿßŸÑÿ®ÿ≠ÿ´ Ÿàÿ•ŸÑÿ∫ÿßÿ° ÿ£Ÿä ŸÖÿ≠ÿßŸàŸÑÿ© Autofill
  document.querySelectorAll('input[type="search"]').forEach(inp => {
    // ÿßŸÖÿ≥ÿ≠ ÿ£Ÿä ŸÇŸäŸÖÿ© ŸÖÿ≠ŸÅŸàÿ∏ÿ©
    inp.value = "";
    // ÿ∫ŸäŸëÿ± ÿßŸÑÿßÿ≥ŸÖ ÿ®ÿ≠Ÿäÿ´ Chrome ŸÖÿß Ÿäÿ±ÿ®ÿ∑Ÿàÿ¥ ÿ®ÿßŸÑŸÄ Email Autofill
    inp.name = "no-autofill-" + Math.random().toString(36).substring(2);
    // ÿÆŸÑŸäŸá ŸÜŸàÿπ ÿ¨ÿØŸäÿØ ŸÖÿ™ÿ∫Ÿäÿ± ŸÖÿ¥ ŸÖÿ™ÿπÿ±ŸÅ ŸÉŸÄemail
    inp.setAttribute("autocomplete", "new-password");
    inp.setAttribute("autocorrect", "off");
    inp.setAttribute("autocapitalize", "off");
    inp.setAttribute("spellcheck", "false");

    // hack ÿ•ÿ∂ÿßŸÅŸä ŸäŸÖŸÜÿπ chrome autofill ÿ™ŸÖÿßŸÖŸãÿß
    inp.addEventListener("focus", () => {
      if (inp.value.includes("@")) inp.value = "";
    });
  });
});
</script>
</body>
</html>
