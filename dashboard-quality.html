<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quality Command Center</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%2300bfff'/><text x='50' y='55' font-family='Arial' font-size='60' font-weight='bold' fill='white' text-anchor='middle' dominant-baseline='middle'>Q</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00bfff;
            --primary-dark: #007BFF;
            --bg: #121212;
            --sidebar-bg: #1a1a1a;
            --card-bg: #1a1a1a;
            --text: #e6edf3;
            --text-muted: #8b949e;
            --border: #333;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --radius: 8px;
            --font: 'Inter', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font); background: var(--bg); color: var(--text); line-height: 1.6; }
        
        .layout { display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar {
            width: 240px; background: var(--sidebar-bg); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; position: fixed; height: 100%; z-index: 1000;
        }
        .sidebar-header { padding: 20px; border-bottom: 1px solid var(--border); }
        .sidebar-title { color: var(--primary); font-size: 20px; font-weight: 700; }
        .nav-group { padding: 20px 0; border-bottom: 1px solid var(--border); }
        .nav-group-title { font-size: 12px; color: var(--text-muted); text-transform: uppercase; margin-bottom: 10px; padding: 0 20px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 20px; color: var(--text-muted); text-decoration: none; transition: all 0.2s; }
        .nav-item:hover, .nav-item.active { background: rgba(0, 191, 255, 0.1); color: var(--primary); }
        .nav-item svg { width: 18px; height: 18px; }
        
        /* Main Content */
        .main { flex: 1; margin-left: 240px; display: flex; flex-direction: column; min-height: 100vh; }
        .topbar { background: var(--sidebar-bg); border-bottom: 1px solid var(--border); padding: 16px 24px; display: flex; justify-content: space-between; align-items: center; }
        .page-title { font-size: 24px; font-weight: 700; }
        .topbar-actions { display: flex; align-items: center; gap: 16px; }
        
        /* Content */
        .content { padding: 24px; flex: 1; }
        
        /* Cards */
        .card { background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; margin-bottom: 20px; }
        .card-header { display: flex; justify-content: between; align-items: center; margin-bottom: 16px; }
        .card-title { font-size: 18px; font-weight: 600; }
        
        /* KPI Grid */
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .kpi-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; }
        .kpi-title { font-size: 14px; color: var(--text-muted); margin-bottom: 8px; }
        .kpi-value { font-size: 28px; font-weight: 700; margin-bottom: 4px; }
        .kpi-change { font-size: 12px; font-weight: 500; }
        
        /* Tables */
        .table-container { overflow-x: auto; }
        .table { width: 100%; border-collapse: collapse; }
        .table th { background: #2c2c2c; padding: 12px 16px; text-align: left; font-size: 12px; text-transform: uppercase; color: var(--text-muted); font-weight: 600; }
        .table td { padding: 12px 16px; border-bottom: 1px solid var(--border); }
        .table tr:hover { background: #2c2c2c; }
        
        /* Badges */
        .badge { padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 600; }
        .badge-success { background: var(--success); color: white; }
        .badge-error { background: var(--danger); color: white; }
        .badge-warning { background: var(--warning); color: black; }
        .badge-info { background: var(--info); color: white; }
        
        /* Buttons */
        .btn { padding: 8px 16px; border-radius: var(--radius); border: none; cursor: pointer; font-weight: 500; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .btn-primary { background: var(--primary); color: black; }
        .btn-secondary { background: #333; color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        
        /* Forms */
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; margin-bottom: 8px; font-weight: 500; }
        .form-control { width: 100%; background: #2c2c2c; border: 1px solid var(--border); border-radius: var(--radius); color: var(--text); padding: 8px 12px; }
        
        /* Toast */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 9999; }
        .toast { background: var(--card-bg); border: 1px solid var(--border); border-radius: var(--radius); padding: 12px 16px; margin-bottom: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); }
        
        /* Footer */
        .footer { background: var(--sidebar-bg); border-top: 1px solid var(--border); padding: 16px 24px; text-align: center; color: var(--text-muted); font-size: 14px; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { width: 60px; }
            .sidebar .nav-text { display: none; }
            .main { margin-left: 60px; }
            .kpi-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">QualityX</div>
            </div>
            
            <div class="nav-group">
                <div class="nav-group-title">Menu</div>
                <a href="#" class="nav-item active" data-tab="dashboard">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 15.2"/>
                    </svg>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-tab="orders">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/>
                    </svg>
                    <span class="nav-text">Assigned Orders</span>
                </a>
                <a href="#" class="nav-item" data-tab="schedule">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
                    </svg>
                    <span class="nav-text">Team Schedule</span>
                </a>
            </div>
            
            <div class="nav-group">
                <div class="nav-group-title">Account</div>
                <a href="#" class="nav-item" data-tab="profile">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/>
                    </svg>
                    <span class="nav-text">Profile</span>
                </a>
                <a href="#" class="nav-item" data-tab="settings">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06-.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    <span class="nav-text">Settings</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main">
            <!-- Topbar -->
            <header class="topbar">
                <h1 class="page-title" id="pageTitle">Dashboard</h1>
                <div class="topbar-actions">
                    <div id="userWelcome">Welcome, <span id="userName">Loading...</span></div>
                    <button class="btn btn-primary" id="newReviewBtn">New Review</button>
                </div>
            </header>

            <!-- Content -->
            <main class="content">
                <!-- Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <div class="kpi-title">Today's Reviews</div>
                            <div class="kpi-value" id="todayReviews">0</div>
                            <div class="kpi-change" style="color: var(--success);">Loading...</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Open Cases</div>
                            <div class="kpi-value" id="openCases">0</div>
                            <div class="kpi-change" style="color: var(--warning);">Loading...</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Quality Score</div>
                            <div class="kpi-value" id="qualityScore">0%</div>
                            <div class="kpi-change" style="color: var(--success);">Loading...</div>
                        </div>
                        <div class="kpi-card">
                            <div class="kpi-title">Escalation Rate</div>
                            <div class="kpi-value" id="escalationRate">0%</div>
                            <div class="kpi-change" style="color: var(--danger);">Loading...</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Recent Activity</h2>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Action</th>
                                        <th>Status</th>
                                        <th>Time</th>
                                    </tr>
                                </thead>
                                <tbody id="activityTable">
                                    <!-- Activity data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Orders Tab -->
                <div id="orders" class="tab-content">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Assigned Orders</h2>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <input type="text" id="searchOrders" class="form-control" placeholder="Search orders..." style="width: 200px;">
                                <select id="filterStatus" class="form-control" style="width: 150px;">
                                    <option value="">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="in_progress">In Progress</option>
                                    <option value="completed">Completed</option>
                                    <option value="escalated">Escalated</option>
                                </select>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Order ID</th>
                                        <th>Issue Type</th>
                                        <th>Assigned Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="ordersTable">
                                    <!-- Orders data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 16px;">
                            <div id="paginationInfo">Showing 0 orders</div>
                            <div style="display: flex; gap: 8px;">
                                <button class="btn btn-secondary" id="prevPage">Previous</button>
                                <button class="btn btn-secondary" id="nextPage">Next</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add other tabs content here -->
                <div id="schedule" class="tab-content">
                    <div class="card">
                        <h2 class="card-title">Team Schedule</h2>
                        <p>Schedule functionality will be implemented with real data</p>
                    </div>
                </div>

                <div id="profile" class="tab-content">
                    <div class="card">
                        <h2 class="card-title">User Profile</h2>
                        <p>Profile management will be implemented with real data</p>
                    </div>
                </div>

                <div id="settings" class="tab-content">
                    <div class="card">
                        <h2 class="card-title">Settings</h2>
                        <p>Settings management will be implemented with real data</p>
                    </div>
                </div>
            </main>

            <!-- Footer -->
            <footer class="footer">
                <div>© 2025 QualityX System. All rights reserved.</div>
            </footer>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Toast System
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.borderLeft = `4px solid ${getToastColor(type)}`;
            toast.textContent = message;
            
            const container = document.getElementById('toastContainer');
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        function getToastColor(type) {
            const colors = {
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8'
            };
            return colors[type] || colors.info;
        }

        // API Integration
        class QualityAPI {
            static async getUserData() {
                // This will be replaced with actual Supabase call
                return new Promise(resolve => {
                    setTimeout(() => {
                        resolve({
                            name: 'Mohamed Elmenisy',
                            role: 'Quality Agent',
                            stats: {
                                todayReviews: 42,
                                openCases: 6,
                                qualityScore: 98.2,
                                escalationRate: 2.1
                            }
                        });
                    }, 500);
                });
            }

            static async getAssignedOrders(page = 1, search = '', status = '') {
                // This will be replaced with actual Supabase call
                return new Promise(resolve => {
                    setTimeout(() => {
                        const orders = [
                            { id: 'CZ-84382', issue: 'Missing Item', date: '2025-07-30', status: 'pending' },
                            { id: 'CZ-84381', issue: 'Wrong Item', date: '2025-07-30', status: 'in_progress' },
                            { id: 'CZ-84380', issue: 'Driver Behavior', date: '2025-07-30', status: 'pending' },
                            { id: 'CZ-84375', issue: 'Missing Item', date: '2025-07-28', status: 'completed' },
                            { id: 'CZ-84374', issue: 'Wrong Order', date: '2025-07-28', status: 'escalated' }
                        ];
                        
                        // Filter based on search and status
                        let filtered = orders.filter(order => 
                            order.id.toLowerCase().includes(search.toLowerCase()) &&
                            (status === '' || order.status === status)
                        );
                        
                        resolve({
                            orders: filtered,
                            total: filtered.length,
                            page: page,
                            totalPages: Math.ceil(filtered.length / 10)
                        });
                    }, 300);
                });
            }

            static async submitReview(orderId, decision, comments) {
                // This will be replaced with actual Supabase call
                return new Promise(resolve => {
                    setTimeout(() => {
                        showToast(`Order ${orderId} marked as ${decision}`, 'success');
                        resolve({ success: true });
                    }, 500);
                });
            }

            static async escalateOrder(orderId, toRole, notes) {
                // This will be replaced with actual Supabase call
                return new Promise(resolve => {
                    setTimeout(() => {
                        showToast(`Order ${orderId} escalated to ${toRole}`, 'warning');
                        resolve({ success: true });
                    }, 500);
                });
            }
        }

        // Application State
        class AppState {
            constructor() {
                this.currentUser = null;
                this.currentPage = 1;
                this.ordersSearch = '';
                this.ordersStatus = '';
                this.autoRefresh = true;
            }

            async initialize() {
                await this.loadUserData();
                this.setupEventListeners();
                this.startAutoRefresh();
            }

            async loadUserData() {
                try {
                    this.currentUser = await QualityAPI.getUserData();
                    this.updateUI();
                } catch (error) {
                    showToast('Failed to load user data', 'error');
                }
            }

            async loadOrders() {
                try {
                    const result = await QualityAPI.getAssignedOrders(
                        this.currentPage,
                        this.ordersSearch,
                        this.ordersStatus
                    );
                    this.renderOrders(result.orders);
                    this.updatePagination(result);
                } catch (error) {
                    showToast('Failed to load orders', 'error');
                }
            }

            updateUI() {
                if (this.currentUser) {
                    document.getElementById('userName').textContent = this.currentUser.name;
                    document.getElementById('todayReviews').textContent = this.currentUser.stats.todayReviews;
                    document.getElementById('openCases').textContent = this.currentUser.stats.openCases;
                    document.getElementById('qualityScore').textContent = this.currentUser.stats.qualityScore + '%';
                    document.getElementById('escalationRate').textContent = this.currentUser.stats.escalationRate + '%';
                }
            }

            renderOrders(orders) {
                const tbody = document.getElementById('ordersTable');
                tbody.innerHTML = orders.map(order => `
                    <tr>
                        <td>${order.id}</td>
                        <td>${order.issue}</td>
                        <td>${order.date}</td>
                        <td><span class="badge badge-${this.getStatusBadge(order.status)}">${this.formatStatus(order.status)}</span></td>
                        <td>
                            <button class="btn btn-sm btn-primary" onclick="app.reviewOrder('${order.id}', 'correct')">Correct</button>
                            <button class="btn btn-sm btn-danger" onclick="app.reviewOrder('${order.id}', 'error')">Error</button>
                            <button class="btn btn-sm btn-secondary" onclick="app.escalateOrder('${order.id}')">Escalate</button>
                        </td>
                    </tr>
                `).join('');
            }

            getStatusBadge(status) {
                const badges = {
                    pending: 'warning',
                    in_progress: 'info',
                    completed: 'success',
                    escalated: 'danger'
                };
                return badges[status] || 'info';
            }

            formatStatus(status) {
                const statusMap = {
                    pending: 'Pending',
                    in_progress: 'In Progress',
                    completed: 'Completed',
                    escalated: 'Escalated'
                };
                return statusMap[status] || status;
            }

            updatePagination(result) {
                document.getElementById('paginationInfo').textContent = 
                    `Showing ${result.orders.length} of ${result.total} orders`;
                
                document.getElementById('prevPage').disabled = this.currentPage === 1;
                document.getElementById('nextPage').disabled = this.currentPage === result.totalPages;
            }

            async reviewOrder(orderId, decision) {
                if (confirm(`Are you sure you want to mark order ${orderId} as ${decision}?`)) {
                    await QualityAPI.submitReview(orderId, decision, '');
                    await this.loadOrders();
                }
            }

            async escalateOrder(orderId) {
                const toRole = prompt('Escalate to (Helper/Senior/Manager):', 'Helper');
                if (toRole) {
                    const notes = prompt('Add escalation notes:');
                    await QualityAPI.escalateOrder(orderId, toRole, notes || '');
                    await this.loadOrders();
                }
            }

            setupEventListeners() {
                // Tab navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const tab = item.getAttribute('data-tab');
                        this.switchTab(tab);
                    });
                });

                // Orders search and filter
                document.getElementById('searchOrders').addEventListener('input', (e) => {
                    this.ordersSearch = e.target.value;
                    this.currentPage = 1;
                    this.loadOrders();
                });

                document.getElementById('filterStatus').addEventListener('change', (e) => {
                    this.ordersStatus = e.target.value;
                    this.currentPage = 1;
                    this.loadOrders();
                });

                // Pagination
                document.getElementById('prevPage').addEventListener('click', () => {
                    if (this.currentPage > 1) {
                        this.currentPage--;
                        this.loadOrders();
                    }
                });

                document.getElementById('nextPage').addEventListener('click', () => {
                    this.currentPage++;
                    this.loadOrders();
                });

                // New review button
                document.getElementById('newReviewBtn').addEventListener('click', () => {
                    showToast('New review functionality will be implemented', 'info');
                });
            }

            switchTab(tabName) {
                // Update active nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

                // Update page title
                document.getElementById('pageTitle').textContent = 
                    tabName.charAt(0).toUpperCase() + tabName.slice(1);

                // Show correct tab content
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });
                document.getElementById(tabName).classList.add('active');

                // Load data for the tab
                if (tabName === 'orders') {
                    this.loadOrders();
                }
            }

            startAutoRefresh() {
                if (this.autoRefresh) {
                    setInterval(() => {
                        this.loadUserData();
                        if (document.getElementById('orders').classList.contains('active')) {
                            this.loadOrders();
                        }
                    }, 30000); // 30 seconds
                }
            }
        }

        // Initialize application
        const app = new AppState();
        document.addEventListener('DOMContentLoaded', () => {
            app.initialize();
        });
    </script>
</body>
</html>
