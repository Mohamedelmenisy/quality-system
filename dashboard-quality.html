<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quality Command Center</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%2300bfff'/><text x='50' y='55' font-family='Poppins, sans-serif' font-size='60' font-weight='bold' fill='white' text-anchor='middle' dominant-baseline='middle'>Q</text></svg>">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #00bfff;
            --primary-color-darker: #007BFF;
            --bg-color: #121212;
            --sidebar-bg: #1a1a1a;
            --card-bg: #1a1a1a;
            --text-color: #e6edf3;
            --text-muted-color: #8b949e;
            --border-color: #333;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --font-body: 'Poppins', sans-serif;
            --border-radius-base: 0.75rem;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: var(--font-body); background-color: var(--bg-color); color: var(--text-color); }
        .layout { display: flex; min-height: 100vh; }
        .sidebar {
            width: 250px; background-color: var(--sidebar-bg); border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column; padding: 1.5rem 0; position: fixed; height: 100%; z-index: 1000;
        }
        .sidebar-header {
            padding: 0 1.5rem 1.5rem 1.5rem; display: flex; align-items: center; gap: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }
        .sidebar-logo { height: 32px; fill: var(--primary-color); }
        .sidebar-title { font-size: 1.25rem; color: var(--primary-color); font-weight: 700; }
        .sidebar-nav-container { flex-grow: 1; overflow-y: auto; padding-top: 1rem; }
        .nav-group { margin-bottom: 1.5rem; padding: 0 1.5rem; }
        .nav-group-title {
            font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em;
            color: var(--text-muted-color); font-weight: 600; margin-bottom: 0.75rem;
        }
        .sidebar-nav { list-style: none; }
        .sidebar-nav a {
            display: flex; align-items: center; gap: 1rem; padding: 0.75rem 1rem; margin: 0.25rem 0;
            text-decoration: none; color: var(--text-muted-color); font-weight: 500; border-radius: 0.5rem;
            transition: all 0.2s ease; cursor: pointer;
        }
        .sidebar-nav a:hover { background-color: rgba(0, 191, 255, 0.1); color: var(--primary-color); }
        .sidebar-nav li.active a { background-color: var(--primary-color); color: black; }
        .sidebar-footer { padding: 1.5rem; border-top: 1px solid var(--border-color); }
        .user-profile-widget { display: flex; align-items: center; gap: 12px; }
        .avatar-initials {
            width: 44px; height: 44px; border-radius: 50%; background-color: var(--primary-color);
            color: black; font-weight: 700; font-size: 1rem;
            display: inline-flex; align-items: center; justify-content: center;
        }
        .user-info .user-name { font-weight: 600; font-size: 1rem; }
        .user-info .user-role { font-size: 0.8rem; color: var(--text-muted-color); }
        .user-status { font-size: 0.75rem; color: var(--success-color); margin-top: 2px; }

        .main-wrapper { flex-grow: 1; margin-left: 250px; display: flex; flex-direction: column; }
        .topbar {
            background-color: var(--sidebar-bg); border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 900;
        }
        .topbar-left { display: flex; align-items: center; gap: 1rem; }
        #search-bar { background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 8px 12px; width: 250px; }
        .page-title { font-size: 1.5rem; color: var(--text-color); font-weight: 700; }
        .topbar-actions { display: flex; align-items: center; gap: 1rem; }
        .notification-bell { position: relative; }
        .notification-btn { background: none; border: none; color: var(--text-muted-color); font-size: 22px; cursor: pointer; }
        .notification-dropdown { display: none; position: absolute; right: 0; top: 120%; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-base); width: 320px; box-shadow: 0 8px 16px rgba(0,0,0,0.3); z-index: 10; }
        .notification-dropdown.show { display: block; }
        .notification-header { padding: 1rem; border-bottom: 1px solid var(--border-color); font-weight: 600; }
        .notification-list { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; }
        .notification-item { padding: 1rem; border-bottom: 1px solid var(--border-color); font-size: 14px; }
        .notification-item:last-child { border-bottom: none; }
        .main-content { padding: 2rem; flex-grow: 1; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;}
        .kpi-card { background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-base); padding: 1.5rem; }
        .kpi-card .kpi-title { font-size: 0.9rem; color: var(--text-muted-color); margin-bottom: 0.5rem; }
        .kpi-card .kpi-value { font-size: 2rem; font-weight: 700; color: var(--text-color); }
        .kpi-card .kpi-change { font-size: 0.9rem; font-weight: 500; margin-top: 0.25rem; }
        .dashboard-grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 1.5rem; }
        .grid-col-span-12 { grid-column: span 12; }
        .grid-col-span-4 { grid-column: span 4; }
        .grid-col-span-8 { grid-column: span 8; }
        .widget { background-color: var(--card-bg); border-radius: var(--border-radius-base); padding: 1.5rem; border: 1px solid var(--border-color); }
        .widget h3 { font-size: 1.25rem; margin-bottom: 1rem; color: var(--text-color); font-weight: 700; }
        .chart-container { height: 350px; width: 100%; }
        .chart-container img { width: 100%; height: 100%; }
        .activity-feed { list-style: none; }
        .activity-item { display: flex; gap: 1rem; padding: 1rem 0; border-bottom: 1px solid var(--border-color); }
        .activity-item:last-child { border-bottom: none; }
        .activity-icon { width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .activity-text { font-size: 0.9rem; }
        .activity-text strong { color: var(--text-color); }
        .activity-time { font-size: 0.8rem; color: var(--text-muted-color); margin-top: 4px; }

        .results-table-container { overflow-x: auto; }
        .results-table { width: 100%; border-collapse: collapse; }
        .results-table thead th { padding: 1rem 1.5rem; text-align: left; background-color: #2c2c2c; font-size: 0.8rem; text-transform: uppercase; color: var(--text-muted-color); font-weight: 600; }
        .results-table tbody td { padding: 1rem 1.5rem; text-align: left; border-bottom: 1px solid var(--border-color); vertical-align: middle;}
        .results-table tbody tr:last-child td { border-bottom: none; }
        .results-table tbody tr:hover { background-color: #2c2c2c; }
        .status-badge { padding: 0.3em 0.7em; border-radius: 20px; font-size: 0.75rem; font-weight: 600; color: white; text-align: center; display: inline-block; }
        .status-new { background-color: var(--primary-color); color: black;}
        .status-open { background-color: var(--info-color); }
        .status-correct { background-color: var(--success-color); }
        .status-error { background-color: var(--danger-color); }
        .status-escalated { background-color: var(--warning-color); color: #000; }
        
        /* MODIFIED: Consolidated filter bar styles */
        .filter-bar { display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; padding: 1rem; background-color: var(--card-bg); border-radius: var(--border-radius-base); margin-bottom: 1.5rem; border: 1px solid var(--border-color);}
        .filter-bar .filter-group { display: flex; align-items: center; gap: 0.5rem;}
        .filter-bar label { font-size: 0.9rem; font-weight: 500; color: var(--text-muted-color); margin-right: 0.25rem; }
        .filter-bar select, .filter-bar input[type="date"] { background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 8px 12px; min-width: 160px; }
        
        /* ADDED: New, improved search input styles */
        .search-input-container { position: relative; }
        .search-input-container .search-icon { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: var(--text-muted-color); }
        .search-input-container input[type="search"] { background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 8px 12px 8px 38px; width: 250px; }
        
        .btn { padding: 0.5rem 1rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; transition: all 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;}
        .btn-primary { background-color: var(--primary-color); color: black; }
        .btn-secondary { background-color: #333; color: white; }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }

        /* ADDED: Modal styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1001; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-overlay.show { display: flex; animation: fadeIn 0.3s ease; }
        .modal-box { background: var(--card-bg); padding: 2rem; border-radius: var(--border-radius-base); border: 1px solid var(--border-color); width: 90%; max-width: 550px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); animation: fadeIn 0.3s ease; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1rem; }
        .modal-title { font-size: 1.25rem; font-weight: 700; }
        .modal-close-btn { background: none; border: none; color: var(--text-muted-color); font-size: 1.5rem; cursor: pointer; }
        .modal-body .form-group { margin-bottom: 1rem; }
        .modal-body label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .modal-body textarea, .modal-body select, .modal-body input { width: 100%; background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 8px 12px; font-family: inherit; resize: vertical;}
        .modal-footer { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; }

        /* ADDED: Improved view order modal styles */
        .order-details-grid { display: grid; grid-template-columns: 1fr; gap: 1.5rem; }
        .detail-item { background: #2c2c2c; padding: 1rem; border-radius: 8px; }
        .detail-item strong { display: block; color: var(--primary-color); font-size: 0.8rem; text-transform: uppercase; margin-bottom: 0.5rem; letter-spacing: 0.5px;}
        .detail-item p { margin: 0; font-size: 1rem; }
        
        .hidden { display: none !important; }

        /* Existing styles for other tabs are kept for consistency... */

    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    </head>
<body class="dark">
    <div class="layout">
        <aside class="sidebar" id="sidebar">
            <div>
                <div class="sidebar-header">
                    <svg class="sidebar-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5-10-5-10 5z" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" fill-opacity="0.3"></path>
                        <path d="M12 22V12" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path>
                    </svg>
                    <h1 class="sidebar-title">QualityX</h1>
                </div>

                <div class="sidebar-nav-container">
                    <div class="nav-group">
                        <h2 class="nav-group-title">Menu</h2>
                        <ul class="sidebar-nav">
                            <li class="active"><a data-tab="dashboard">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18.7 8l-5.1 5.2-2.8-2.7L7 15.2"/></svg>
                                Dashboard</a></li>
                            <li><a data-tab="my-assigned-orders">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>
                                Assigned Orders</a></li>
                            <li><a data-tab="team-scheduling">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
                                Team Scheduling</a></li>
                            <li><a data-tab="team-members">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                                Team Members</a></li>
                            <li><a data-tab="reports">
                                 <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 2v6h6M21.5 22v-6h-6"/><path d="M22 11.5A10 10 0 0 0 3.2 7.2M2 12.5a10 10 0 0 0 18.8 4.2"/></svg>
                                Reports & Analytics</a></li>
                        </ul>
                    </div>
                     <div class="nav-group">
                        <h2 class="nav-group-title">Account</h2>
                         <ul class="sidebar-nav">
                            <li><a data-tab="profile">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                Profile</a></li>
                            <li><a data-tab="settings">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06-.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                                Settings</a></li>
                            <li><a href="#" id="logout-btn">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                                Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="sidebar-footer">
                <div class="user-profile-widget">
                    <div class="avatar-initials" id="sidebar-avatar-initials">QA</div>
                    <div class="user-info">
                        <span class="user-name" id="sidebar-username">Guest User</span>
                        <span class="user-role" id="sidebar-user-role">Quality Agent</span>
                        <span class="user-status">● Online</span>
                    </div>
                </div>
            </div>
        </aside>

        <main class="main-wrapper">
            <header class="topbar">
                <div class="topbar-left">
                    <h2 class="page-title" id="current-page-title">Dashboard</h2>
                </div>
                <div class="topbar-actions">
                     <div class="notification-bell">
                        <button class="notification-btn" id="notification-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                        </button>
                        <div class="notification-dropdown" id="notification-dropdown">
                            <div class="notification-header">Notifications (0)</div>
                            <ul class="notification-list" id="notification-list">
                                <li class="notification-item">No new notifications.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <div class="main-content">
                <div class="tab-content active" id="dashboard">
                    <h1>Welcome back, <span id="welcome-user-name"></span>!</h1>
                    <p class="section-description" style="color: var(--text-muted-color); margin-top: 0.5rem; margin-bottom: 2rem;">Overview of your key performance indicators and recent activity.</p>
                    
                    <div class="kpi-grid">
                        <div class="kpi-card">
                            <p class="kpi-title">Assignments Due</p>
                            <p class="kpi-value" id="kpi-open-assignments">...</p>
                            <p class="kpi-change" style="color: var(--warning-color);">Handle these immediately.</p>
                        </div>
                        <div class="kpi-card">
                            <p class="kpi-title">Reviews Completed (This Month)</p>
                            <p class="kpi-value" id="kpi-completed-reviews">...</p>
                            <p class="kpi-change" style="color: var(--success-color);">Keep up the great work!</p>
                        </div>
                        <div class="kpi-card">
                            <p class="kpi-title">Accuracy Rate</p>
                            <p class="kpi-value">98.5%</p>
                            <p class="kpi-change" style="color: var(--success-color);">+0.1% vs last month</p>
                        </div>
                        <div class="kpi-card">
                            <p class="kpi-title">Critical Errors Identified</p>
                            <p class="kpi-value">12</p>
                            <p class="kpi-change" style="color: var(--danger-color);">-3 errors this month</p>
                        </div>
                    </div>

                    <div class="dashboard-grid">
                        <div class="grid-col-span-8 widget">
                            <h3>Monthly Performance Trend</h3>
                            <div class="chart-container">
                                <canvas id="monthlyPerformanceChart"></canvas>
                            </div>
                        </div>
                        <div class="grid-col-span-4 widget">
                            <h3>Recent Activity</h3>
                            <ul class="activity-feed">
                                <li class="activity-item">
                                    <div class="activity-icon" style="background-color: rgba(40, 167, 69, 0.2); color: var(--success-color);">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.05-8.77"/></svg>
                                    </div>
                                    <div class="activity-content">
                                        <p class="activity-text">Reviewed order <strong>#87612</strong>: Action **Correct**.</p>
                                        <p class="activity-time">5 minutes ago</p>
                                    </div>
                                </li>
                                <li class="activity-item">
                                    <div class="activity-icon" style="background-color: rgba(220, 53, 69, 0.2); color: var(--danger-color);">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                                    </div>
                                    <div class="activity-content">
                                        <p class="activity-text">Flagged **Critical Error** on order <strong>#87599</strong>.</p>
                                        <p class="activity-time">2 hours ago</p>
                                    </div>
                                </li>
                                <li class="activity-item">
                                    <div class="activity-icon" style="background-color: rgba(0, 191, 255, 0.2); color: var(--primary-color);">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20v2.5a2.5 2.5 0 0 1-2.5 2.5H6.5A2.5 2.5 0 0 1 4 19.5z"/><path d="M20 17V8H6.5A2.5 2.5 0 0 0 4 10.5v1.5"/><path d="M20 8H6.5A2.5 2.5 0 0 0 4 10.5v1.5"/></svg>
                                    </div>
                                    <div class="activity-content">
                                        <p class="activity-text">New order **#87650** assigned to you.</p>
                                        <p class="activity-time">Today, 8:00 AM</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>

                </div>

                <div class="tab-content" id="my-assigned-orders">
                    <h1>Assigned Orders for Review</h1>
                    <p class="section-description" style="color: var(--text-muted-color); margin-top: 0.5rem; margin-bottom: 2rem;">A list of all orders assigned to you awaiting quality review.</p>
                    
                    <div class="filter-bar">
                        <div class="search-input-container">
                             <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
                            <input type="search" id="order-search" placeholder="Search by Order ID or Employee Name...">
                        </div>
                        <div class="filter-group">
                            <label for="status-filter">Status:</label>
                            <select id="status-filter">
                                <option value="all">All Active</option>
                                <option value="pending">Pending</option>
                                <option value="in_progress">In Progress</option>
                            </select>
                        </div>
                    </div>

                    <div class="widget">
                        <div class="results-table-container">
                            <table class="results-table">
                                <thead>
                                    <tr>
                                        <th>Assignment ID</th>
                                        <th>Order ID</th>
                                        <th>Employee Name (Agent)</th>
                                        <th>Reason/Type</th>
                                        <th>Amount</th>
                                        <th>Assigned Date</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="assigned-orders-table-body">
                                    <tr><td colspan="8" style="text-align: center; color: var(--text-muted-color);">Loading assignments...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tab-content" id="team-scheduling"><h3>Team Scheduling</h3><p>Content for Team Scheduling.</p></div>
                <div class="tab-content" id="team-members"><h3>Team Members</h3><p>Content for Team Members.</p></div>
                <div class="tab-content" id="reports"><h3>Reports & Analytics</h3><p>Content for Reports.</p></div>
                <div class="tab-content" id="profile"><h3>Profile Settings</h3><p>Content for Profile.</p></div>
                <div class="tab-content" id="settings"><h3>System Settings</h3><p>Content for Settings.</p></div>

            </div>
        </main>
    </div>

    <div class="modal-overlay" id="view-order-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h2 class="modal-title">Order Details: <span id="view-modal-order-id"></span></h2>
                <button class="modal-close-btn" onclick="hideModal('view-order-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="order-details-grid">
                    <div class="detail-item">
                        <strong>Employee Name</strong>
                        <p id="detail-employee-name"></p>
                    </div>
                    <div class="detail-item">
                        <strong>Order Date</strong>
                        <p id="detail-order-date"></p>
                    </div>
                    <div class="detail-item">
                        <strong>Transaction Amount</strong>
                        <p id="detail-amount"></p>
                    </div>
                    <div class="detail-item">
                        <strong>Reason for Assignment</strong>
                        <p id="detail-reason"></p>
                    </div>
                    <div class="detail-item">
                        <strong>Chefs Notes / Summary</strong>
                        <p id="detail-chefz-notes"></p>
                    </div>
                    <div class="detail-item">
                        <strong>Assignment Status</strong>
                        <p id="detail-assignment-status"></p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="hideModal('view-order-modal')">Close</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="review-order-modal">
        <div class="modal-box">
            <div class="modal-header">
                <h2 class="modal-title">Review Order: <span id="review-modal-order-id"></span></h2>
                <button class="modal-close-btn" onclick="hideModal('review-order-modal')">&times;</button>
            </div>
            <form id="review-form">
                <input type="hidden" id="review-assignment-id" />
                <input type="hidden" id="review-original-employee-name" />
                <div class="modal-body">
                    <div class="form-group">
                        <label for="action-correctness">Action Correctness *</label>
                        <select id="action-correctness" required>
                            <option value="">Select Result</option>
                            <option value="correct">Action was Correct (صحيح)</option>
                            <option value="error">Action was Incorrect (خطأ/Error)</option>
                        </select>
                    </div>
                    <div class="form-group hidden" id="error-type-group">
                        <label for="error-type">Error Type *</label>
                        <select id="error-type">
                            <option value="">Select Error Classification</option>
                            <option value="policy_violation">Policy Violation (مخالفة سياسة)</option>
                            <option value="incorrect_information">Incorrect Information (معلومات خاطئة)</option>
                            <option value="system_entry_error">System Entry Error (خطأ إدخال نظام)</option>
                            </select>
                    </div>
                    <div class="form-group">
                        <label for="review-notes">Review Notes</label>
                        <textarea id="review-notes" rows="4" placeholder="Enter detailed notes for the outcome..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideModal('review-order-modal')">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="submit-review-btn">Submit Review</button>
                </div>
            </form>
        </div>
    </div>

    <div id="toast-container" style="position: fixed; top: 20px; right: 20px; z-index: 2000;"></div>


    <script type="module">
        // **هنا يتم استيراد الدوال من api-client.js**
        import { 
            getCurrentUser, 
            getUserData, 
            signOut, 
            getAssignedOrders, 
            getQualityKPIs,
            submitReview
        } from './api-client.js'; // المسار الصحيح لوحدة الجافاسكريبت

        let CURRENT_USER_ID = null;
        let ASSIGNED_ORDERS_DATA = [];

        // --- Utility Functions ---

        function getInitials(name) {
            if (!name) return 'GU';
            const parts = name.split(' ');
            if (parts.length > 1) {
                return parts[0][0] + parts[1][0];
            }
            return parts[0][0];
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        function showModal(id) {
            document.getElementById(id).classList.add('show');
        }

        function hideModal(id) {
            document.getElementById(id).classList.remove('show');
        }
        
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `btn btn-sm text-center toast-${type}`;
            toast.style.cssText = `
                margin-bottom: 10px;
                padding: 10px 15px;
                border-radius: 8px;
                background-color: ${type === 'success' ? 'var(--success-color)' : type === 'error' ? 'var(--danger-color)' : 'var(--warning-color)'};
                color: white;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                opacity: 0;
                transition: opacity 0.5s ease-in-out;
            `;
            toast.textContent = message;
            
            toastContainer.appendChild(toast);
            setTimeout(() => { toast.style.opacity = 1; }, 10); 
            
            setTimeout(() => {
                toast.style.opacity = 0;
                toast.addEventListener('transitionend', () => toast.remove());
            }, 5000);
        }

        // --- Auth & Data Load ---

        async function checkAuthAndLoadData() {
            try {
                const user = await getCurrentUser();
                if (!user) {
                    console.log("User not logged in, redirecting to login.");
                    // window.location.href = 'login.html'; // Uncomment this in production
                    return;
                }
                
                CURRENT_USER_ID = user.id;
                const userData = await getUserData(CURRENT_USER_ID);

                // Update Sidebar
                const userName = userData.name || user.email;
                const userRole = userData.role || 'Quality Agent';
                
                document.getElementById('sidebar-username').textContent = userName;
                document.getElementById('sidebar-user-role').textContent = userRole;
                document.getElementById('sidebar-avatar-initials').textContent = getInitials(userName);
                document.getElementById('welcome-user-name').textContent = userName.split(' ')[0];


                // Load Dashboard & Assigned Orders Data
                await loadDashboardData();
                await loadAssignedOrders();

            } catch (error) {
                console.error("Error during initial load:", error);
                showToast("Failed to load user data. Try refreshing.", 'error');
                // Force logout if user data fetch fails badly
                // await signOut();
                // window.location.href = 'login.html';
            }
        }

        async function loadDashboardData() {
            try {
                const kpis = await getQualityKPIs(CURRENT_USER_ID);
                document.getElementById('kpi-open-assignments').textContent = kpis.openAssignments;
                document.getElementById('kpi-completed-reviews').textContent = kpis.totalCompletedReviews;
                // Initialize Charts (placeholder data for now)
                initializeCharts(); 

            } catch (error) {
                console.error("Failed to load KPI data:", error);
                showToast("Failed to load KPIs.", 'error');
            }
        }

        async function loadAssignedOrders() {
            try {
                const orders = await getAssignedOrders(CURRENT_USER_ID);
                ASSIGNED_ORDERS_DATA = orders;
                renderAssignedOrdersTable(orders);
            } catch (error) {
                console.error("Failed to load assigned orders:", error);
                renderAssignedOrdersTable([]); // Render empty table on failure
                showToast("Failed to load assigned orders from database.", 'error');
            }
        }


        // --- Render Functions ---

        function renderAssignedOrdersTable(orders) {
            const tableBody = document.getElementById('assigned-orders-table-body');
            tableBody.innerHTML = ''; 

            if (!orders || orders.length === 0) {
                 tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center; color: var(--text-muted-color); padding: 2rem;">No new orders assigned for review. Enjoy your break!</td></tr>';
                 return;
            }

            orders.forEach(assignment => {
                // The actual order data is nested under 'orders' because of the join
                const order = assignment.orders;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${assignment.id.substring(0, 8)}...</td>
                    <td>${order.order_id}</td>
                    <td>${order.employee_name || 'N/A'}</td>
                    <td>${order.reason || 'Standard Review'}</td>
                    <td>${order.amount ? `$${order.amount.toFixed(2)}` : 'N/A'}</td>
                    <td>${formatDate(assignment.assigned_at)}</td>
                    <td><span class="status-badge status-${assignment.status === 'pending' ? 'new' : 'open'}">${assignment.status.replace('_', ' ')}</span></td>
                    <td>
                        <button class="btn btn-secondary btn-sm" onclick="showOrderDetails('${assignment.id}')">View</button>
                        <button class="btn btn-primary btn-sm" onclick="showReviewModal('${assignment.id}')">Review</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // --- Modal Handlers ---

        function showOrderDetails(assignmentId) {
            const assignment = ASSIGNED_ORDERS_DATA.find(a => a.id === assignmentId);
            if (!assignment) {
                showToast("Order data not found.", 'error');
                return;
            }

            const order = assignment.orders;
            
            document.getElementById('view-modal-order-id').textContent = order.order_id;
            document.getElementById('detail-employee-name').textContent = order.employee_name || 'N/A';
            document.getElementById('detail-order-date').textContent = formatDate(order.updated_on_date || order.created_at);
            document.getElementById('detail-amount').textContent = order.amount ? `$${order.amount.toFixed(2)}` : 'N/A';
            document.getElementById('detail-reason').textContent = order.reason || 'N/A';
            document.getElementById('detail-chefz-notes').textContent = order.chefz || 'No specific notes recorded.';
            document.getElementById('detail-assignment-status').textContent = assignment.status;

            showModal('view-order-modal');
        }

        function showReviewModal(assignmentId) {
            const assignment = ASSIGNED_ORDERS_DATA.find(a => a.id === assignmentId);
            if (!assignment) {
                showToast("Assignment data not found.", 'error');
                return;
            }
            
            const order = assignment.orders;

            document.getElementById('review-modal-order-id').textContent = order.order_id;
            document.getElementById('review-assignment-id').value = assignmentId;
            document.getElementById('review-original-employee-name').value = order.employee_name;
            
            // Reset form fields
            document.getElementById('review-form').reset();
            document.getElementById('error-type-group').classList.add('hidden');

            showModal('review-order-modal');
        }

        // --- Event Listeners and Logic ---

        document.getElementById('logout-btn').addEventListener('click', async (e) => {
            e.preventDefault();
            await signOut();
            // window.location.href = 'login.html'; // Redirect to login
            alert("Signed out successfully!"); // Placeholder alert
        });

        // Tab switching logic
        document.querySelectorAll('.sidebar-nav a').forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                document.querySelectorAll('.sidebar-nav li').forEach(li => li.classList.remove('active'));

                const tab = this.getAttribute('data-tab');
                document.getElementById(tab).classList.add('active');
                this.closest('li').classList.add('active');
                document.getElementById('current-page-title').textContent = this.textContent.trim();
            });
        });
        
        // Error Type Visibility Toggle
        document.getElementById('action-correctness').addEventListener('change', (e) => {
            const errorGroup = document.getElementById('error-type-group');
            if (e.target.value === 'error') {
                errorGroup.classList.remove('hidden');
                document.getElementById('error-type').setAttribute('required', 'required');
            } else {
                errorGroup.classList.add('hidden');
                document.getElementById('error-type').removeAttribute('required');
            }
        });

        // Review Submission Handler (Core Transaction)
        document.getElementById('review-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = document.getElementById('submit-review-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            const assignmentId = document.getElementById('review-assignment-id').value;
            const originalEmployeeName = document.getElementById('review-original-employee-name').value;
            const actionCorrectness = document.getElementById('action-correctness').value;
            const errorType = document.getElementById('error-type').value;
            const notes = document.getElementById('review-notes').value;
            
            const assignment = ASSIGNED_ORDERS_DATA.find(a => a.id === assignmentId);
            if (!assignment) {
                showToast("Critical: Assignment data lost. Please refresh.", 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Review';
                return;
            }
            
            const orderId = assignment.orders.order_id;

            try {
                const result = await submitReview(
                    assignmentId,
                    orderId,
                    CURRENT_USER_ID,
                    actionCorrectness,
                    `${actionCorrectness === 'error' ? `[Error Type: ${errorType}] ` : ''}${notes}`,
                    originalEmployeeName // Used for UUID mapping
                );
                
                if (result.success) {
                    showToast(`Review for Order ${orderId} submitted successfully!`, 'success');
                    hideModal('review-order-modal');
                    // Reload data to update tables and KPIs
                    await loadDashboardData(); 
                    await loadAssignedOrders();
                } else {
                    // Handle specific error from API (e.g., employee not found)
                    showToast(`Submission Failed: ${result.error.message}`, 'error');
                }

            } catch (error) {
                console.error("Submission Error:", error);
                showToast("An unexpected error occurred during submission.", 'error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Review';
            }
        });

        // Make functions globally accessible for inline HTML calls
        window.showOrderDetails = showOrderDetails;
        window.showReviewModal = showReviewModal;
        window.hideModal = hideModal;

        // --- Chart Initialization (Placeholder) ---
        function initializeCharts() {
            // Placeholder data for the Monthly Performance Trend Chart
            const ctx = document.getElementById('monthlyPerformanceChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [{
                        label: 'Accuracy Rate (%)',
                        data: [98.2, 98.4, 97.9, 98.5, 98.8, 99.1, 98.9],
                        borderColor: 'var(--primary-color)',
                        backgroundColor: 'rgba(0, 191, 255, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { min: 95, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                        x: { grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                    }
                }
            });
        }


        // --- Initial Load ---
        document.addEventListener('DOMContentLoaded', checkAuthAndLoadData);

    </script>
</body>
</html>
