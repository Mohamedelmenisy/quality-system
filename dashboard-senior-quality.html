<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Senior Quality Portal - QualityX</title>
    <!-- MODIFIED: Updated favicon to the consistent QualityX 'Q' logo. -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%2300bfff'/%3E%3Ctext x='50' y='55' font-family='Poppins, sans-serif' font-size='60' font-weight='bold' fill='white' text-anchor='middle' dominant-baseline='middle'%3EQ%3C/text%3E%3C/svg%3E">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #00bfff;
            --primary-color-darker: #007BFF;
            --bg-color: #121212;
            --sidebar-bg: #1a1a1a;
            --card-bg: #1a1a1a;
            --text-color: #e6edf3;
            --text-muted-color: #8b949e;
            --border-color: #333;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --font-body: 'Poppins', sans-serif;
            --border-radius-base: 0.75rem;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: var(--font-body); background-color: var(--bg-color); color: var(--text-color); }
        .layout { display: flex; min-height: 100vh; }
        .sidebar {
            width: 260px; background-color: var(--sidebar-bg); border-right: 1px solid var(--border-color);
            display: flex; flex-direction: column; padding: 0; position: fixed; height: 100%; z-index: 1000;
        }
        .sidebar-header {
            padding: 1.5rem; display: flex; align-items: center; gap: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }
        .sidebar-logo { height: 32px; fill: var(--primary-color); }
        .sidebar-title { font-size: 1.25rem; color: var(--primary-color); font-weight: 700; }
        .sidebar-nav-container { flex-grow: 1; overflow-y: auto; padding-top: 1rem; }
        .nav-group { margin-bottom: 1.5rem; padding: 0 1.5rem; }
        .nav-group-title { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted-color); font-weight: 600; margin-bottom: 0.75rem; }
        .sidebar-nav { list-style: none; padding: 0; }
        .sidebar-nav a {
            display: flex; align-items: center; gap: 1rem; padding: 0.75rem 1rem; margin: 0.25rem 0;
            text-decoration: none; color: var(--text-muted-color); font-weight: 500; border-radius: 0.5rem;
            transition: all 0.2s ease; cursor: pointer;
        }
        .sidebar-nav a:hover, .sidebar-nav li.active a { background-color: var(--primary-color); color: black; }
        .sidebar-footer { padding: 1.5rem; border-top: 1px solid var(--border-color); }
        .user-profile-widget { display: flex; align-items: center; gap: 12px; }
        .avatar-initials { width: 44px; height: 44px; border-radius: 50%; background-color: var(--primary-color); color: black; font-weight: 700; font-size: 1rem; display: inline-flex; align-items: center; justify-content: center; }
        .user-name { font-weight: 600; font-size: 1rem; }
        .user-role { font-size: 0.8rem; color: var(--text-muted-color); }
        .user-status { font-size: 0.75rem; color: var(--success-color); margin-top: 2px; }
        .main-wrapper { flex-grow: 1; margin-left: 260px; display: flex; flex-direction: column; }
        .topbar {
            background-color: var(--sidebar-bg); border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem; display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 999; /* Adjusted z-index */
        }
        .header-left { flex-grow: 1; }
        .header-actions { display: flex; align-items: center; gap: 1rem; }
        .page-title { font-size: 1.5rem; color: var(--text-color); font-weight: 700; }
        .main-content { padding: 2rem; flex-grow: 1; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        .widget { background-color: var(--card-bg); border-radius: var(--border-radius-base); padding: 1.5rem; border: 1px solid var(--border-color); margin-bottom: 1.5rem; }
        .widget h3 { font-size: 1.25rem; margin-bottom: 1rem; color: var(--text-color); font-weight: 700; }
        .results-table-container { overflow-x: auto; position: relative; }
        /* ADDED: visual cue for scrollable tables */
        .results-table-container::after { content: ''; position: absolute; top: 0; right: 0; bottom: 0; width: 30px; background: linear-gradient(to right, transparent, var(--card-bg)); pointer-events: none; opacity: 0; transition: opacity 0.2s; }
        .results-table-container.is-scrollable::after { opacity: 1; }
        .results-table { width: 100%; border-collapse: collapse; }
        .results-table thead th { padding: 1rem 1.5rem; text-align: left; background-color: #2c2c2c; font-size: 0.8rem; text-transform: uppercase; color: var(--text-muted-color); font-weight: 600; white-space: nowrap; }
        .results-table tbody td { padding: 1rem 1.5rem; text-align: left; border-bottom: 1px solid var(--border-color); white-space: nowrap;}
        /* MODIFIED: Allow text wrapping in specific columns */
        .results-table .wrap-text { white-space: normal; max-width: 200px; }
        .results-table tbody tr:last-child td { border-bottom: none; }
        .results-table tbody tr:hover { background-color: #2c2c2c; }
        .btn { padding: 0.5rem 1rem; border-radius: 0.5rem; border: none; cursor: pointer; font-weight: 600; transition: all 0.2s ease; display: inline-flex; align-items: center; justify-content: center; gap: 0.5rem;}
        .btn-primary { background-color: var(--primary-color); color: black; }
        .btn-success { background-color: var(--success-color); color: white; }
        .btn-danger { background-color: var(--danger-color); color: white; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1050; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .modal-overlay.show { display: flex; animation: fadeIn 0.3s ease; }
        .modal-box { background: var(--card-bg); padding: 2rem; border-radius: var(--border-radius-base); border: 1px solid var(--border-color); width: 90%; max-width: 700px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 1rem; margin-bottom: 1rem; }
        .modal-title { font-size: 1.5rem; font-weight: 700; color: var(--primary-color); }
        .modal-close-btn { background: none; border: none; color: var(--text-muted-color); font-size: 1.5rem; cursor: pointer; }
        .escalation-details { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .detail-item { background: #222; padding: 15px; border-radius: 8px; }
        .detail-item strong { display: block; color: var(--text-muted-color); font-size: 0.8rem; margin-bottom: 5px;}
        .detail-item span { font-size: 1rem; font-weight: 500;}
        .feedback-form textarea { width: 100%; background: #2c2c2c; border: 1px solid var(--border-color); color: white; padding: 10px; border-radius: 8px; font-family: inherit; margin-top: 10px; }
        .feedback-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px; }
        .charts-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; }
        .kpi-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 1.5rem; margin-bottom: 1.5rem;}
        .chart-container { height: 350px; } /* Increased height for better visibility */
        .filter-panel { display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; padding: 1rem; background-color: #222; border-radius: var(--border-radius-base); margin-bottom: 1.5rem; }
        .filter-panel select, .filter-panel input { background: #2c2c2c; border-radius: 8px; color: var(--text-color); padding: 8px 12px; border: 1px solid var(--border-color); }
        .status-badge { padding: 0.3em 0.7em; border-radius: 20px; font-size: 0.75rem; font-weight: 600; color: white; }
        .status-pending { background-color: var(--info-color); }
        .status-completed { background-color: var(--success-color); }
        .status-late { background-color: var(--warning-color); color: black; }
        .status-reviewed { background-color: var(--primary-color-darker); }
        .form-group { margin-bottom: 1.5rem; }
        .form-group label { display: block; font-weight: 500; margin-bottom: 0.5rem; }
        .form-group input, .form-group select { width: 100%; background: #2c2c2c; border: 1px solid var(--border-color); border-radius: 8px; color: var(--text-color); padding: 10px 12px; }
        .form-group.toggle { display: flex; align-items: center; justify-content: space-between; }
        .page-actions { display: flex; justify-content: flex-end; gap: 1rem; margin-top: 1.5rem; }
        .placeholder-content { padding: 3rem; text-align:center; color: var(--text-muted-color); border: 2px dashed var(--border-color); border-radius: var(--border-radius-base); }
        #welcome-message { margin-bottom: 2rem; }
        #welcome-message h2 { font-size: 1.75rem; font-weight: 700; }
        #welcome-message p { color: var(--text-muted-color); }
        .notification-bell { position: relative; }
        .notification-btn { background: none; border: none; color: var(--text-muted-color); font-size: 24px; cursor: pointer; padding: 5px; }
        .notification-dropdown { display: none; position: absolute; right: 0; top: 120%; background: var(--card-bg); border: 1px solid var(--border-color); border-radius: var(--border-radius-base); width: 320px; box-shadow: 0 8px 16px rgba(0,0,0,0.3); z-index: 1010; /* MODIFIED: Increased z-index */ }
        .notification-dropdown.show { display: block; animation: fadeIn 0.2s; }
        .notification-header { padding: 1rem; border-bottom: 1px solid var(--border-color); font-weight: 600; }
        .notification-list { list-style: none; padding: 0; max-height: 300px; overflow-y: auto; }
        .notification-item { padding: 1rem; border-bottom: 1px solid var(--border-color); font-size: 14px; }
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
    </style>
</head>
<body class="dark">
    <div class="layout">
        <aside class="sidebar">
            <div>
                <div class="sidebar-header">
                    <svg class="sidebar-logo" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5-10-5-10 5z" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" fill-opacity="0.3"></path><path d="M12 22V12" stroke="#FFF" stroke-width="1" stroke-linecap="round" stroke-linejoin="round"></path></svg>
                    <h1 class="sidebar-title">QualityX</h1>
                </div>
                <div class="sidebar-nav-container">
                     <div class="nav-group">
                        <h2 class="nav-group-title">Menu</h2>
                        <ul class="sidebar-nav">
                            <!-- MODIFIED: "My Dashboard" to "Dashboard" -->
                            <li class="active"><a data-tab="dashboard">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/></svg>
                                Dashboard</a></li>
                            <li><a data-tab="escalations">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z"/></svg>
                                Escalations</a></li>
                            <li><a data-tab="assignments">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21.5 12H16c-.7 2-2 3-4 3s-3.3-1-4-3H2.5"/><path d="M5.5 5.1L2 12v6c0 1.1.9 2 2 2h16a2 2 0 002-2v-6l-3.4-6.9A2 2 0 0016.8 4H7.2a2 2 0 00-1.7 1.1z"/></svg>
                                Assignments</a></li>
                            <li><a data-tab="agent-performance">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                                Agent Performance</a></li>
                            <!-- ADDED: New Sections -->
                             <li><a data-tab="kpis">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 20.94c1.5 0 2.75 1.06 4 2.06 1.25-1 2.5-2.06 4-2.06V6.52c0-1.25-.5-2.5-1.5-3.5-1-1-2.25-1.5-3.5-1.5-1.25 0-2.5.5-3.5 1.5S10 5.27 10 6.52v3.42c0 1.25.5 2.5 1.5 3.5.75.75 1.75 1.25 2.5 1.5v.44z"/></svg>
                                KPIs</a></li>
                            <li><a data-tab="reports-analytics">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 2v6h6M2.66 15.57a10 10 0 1 0 .57-8.38"/></svg>
                                Reports & Analytics</a></li>
                        </ul>
                    </div>
                    <div class="nav-group">
                        <h2 class="nav-group-title">Account</h2>
                        <ul class="sidebar-nav">
                             <li><a data-tab="profile"><span>👤</span>Profile</a></li>
                             <li><a data-tab="settings"><span>⚙️</span>Settings</a></li>
                             <li><a data-tab="help"><span>❓</span>Get Help</a></li>
                             <li><a onclick="alert('Logging out...')">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                                Logout</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="sidebar-footer">
                <div class="user-profile-widget">
                    <div class="avatar-initials" id="sidebar-avatar-initials">KA</div>
                    <div>
                        <div class="user-name" id="sidebar-username">Khaled Al-Mutairi</div>
                        <div class="user-role">Senior Quality Analyst</div>
                        <div class="user-status">● Online</div>
                    </div>
                </div>
            </div>
        </aside>

        <div class="main-wrapper">
            <header class="topbar">
                <div class="header-left">
                     <h2 class="page-title" id="page-title">Dashboard</h2>
                </div>
                 <div class="header-actions">
                    <input type="search" placeholder="Global search..." style="background: #2c2c2c; border-radius: 8px; color: var(--text-color); padding: 8px 12px; border: 1px solid var(--border-color); width: 250px;">
                    <div class="notification-bell">
                        <button id="notification-btn" class="notification-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
                        </button>
                        <div id="notification-dropdown" class="notification-dropdown">
                            <div class="notification-header">Notifications</div>
                            <ul class="notification-list">
                                <li class="notification-item">3 new orders have been escalated to you.</li>
                                <li class="notification-item">Agent Fahad A. completed his assigned batch.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </header>

            <main class="main-content">
                <!-- MODIFIED: Dashboard Tab -->
                <div id="dashboard" class="tab-content active">
                     <div id="welcome-message">
                        <h2 id="welcome-user-h2">Welcome, Khaled!</h2>
                        <p>Here is a summary of your activity and team oversight.</p>
                    </div>
                    <div class="kpi-grid">
                         <div class="widget"><h3>Reviews Today</h3><p style="font-size: 2rem; font-weight: 700;">12</p></div>
                         <div class="widget"><h3>Pending Escalations</h3><p style="font-size: 2rem; font-weight: 700; color: var(--warning-color);">3</p></div>
                         <div class="widget"><h3>Avg. Resolution Time</h3><p style="font-size: 2rem; font-weight: 700;">45 mins</p></div>
                         <div class="widget"><h3>Team Accuracy</h3><p style="font-size: 2rem; font-weight: 700; color: var(--success-color);">98.1%</p></div>
                    </div>
                     <!-- ADDED: New charts for personal performance -->
                     <div class="widget">
                         <h3>Personal & Team Performance Analysis</h3>
                         <div class="charts-grid">
                             <div class="chart-container"><canvas id="personalPerformanceChart"></canvas></div>
                             <div class="chart-container"><canvas id="teamErrorTypesChart"></canvas></div>
                         </div>
                     </div>
                </div>
                
                <!-- Escalations -->
                <div id="escalations" class="tab-content">
                    <div class="widget">
                         <h3>Orders Awaiting Your Review (<span id="escalation-count">0</span>)</h3>
                         <!-- ADDED: Filter for escalations -->
                         <div class="filter-panel">
                             <input type="search" id="escalation-search" placeholder="Search by Order ID...">
                             <select id="escalation-status-filter">
                                 <option value="all">All Statuses</option>
                                 <option value="Pending">Pending</option>
                                 <option value="Reviewed">Reviewed</option>
                             </select>
                         </div>
                        <div class="results-table-container">
                            <table class="results-table">
                                <thead>
                                    <tr><th>Order ID</th> <th>Issue Type</th> <th>Escalated By</th> <th>Date</th> <th>Status</th> <th>Action</th></tr>
                                </thead>
                                <tbody id="escalation-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Agent Performance -->
                <div id="agent-performance" class="tab-content">
                    <div class="widget">
                         <h3>Quality Team Performance</h3>
                         <div class="filter-panel">
                            <label for="agent-filter" style="font-weight: 500;">Filter by Agent:</label>
                            <select id="agent-filter">
                                <option value="all">All Agents</option>
                                <option value="Fahad A.">Fahad A.</option>
                                <option value="Ali K.">Ali K.</option>
                                <option value="Hessa M.">Hessa M.</option>
                                <option value="Noura S.">Noura S.</option>
                            </select>
                         </div>
                         <div class="charts-grid">
                            <div class="chart-container"><canvas id="agentAccuracyChart"></canvas></div>
                             <div class="chart-container"><canvas id="reviewsVsErrorsChart"></canvas></div>
                         </div>
                    </div>
                </div>

                 <!-- Assignments -->
                <div id="assignments" class="tab-content">
                    <div class="widget">
                        <h3>Unassigned Orders (<span id="unassigned-count">0</span>)</h3>
                        <div class="filter-panel">
                            <span>Assign selected to:</span>
                            <select id="agent-select" style="flex-grow: 1;"></select>
                            <button id="assign-btn" class="btn btn-primary">Assign Selected</button>
                        </div>
                        <div class="results-table-container">
                            <table class="results-table">
                                <!-- MODIFIED: Corrected and reordered columns as requested -->
                                <thead><tr><th><input type="checkbox" id="select-all-checkbox" /></th><th>Order ID</th><th class="wrap-text">Reason</th><th class="wrap-text">Employee</th><th>Chefz</th><th>Order Status</th><th>Requested Delivery Date</th><th>Payment Type</th></tr></thead>
                                <tbody id="unassigned-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                    <div class="widget">
                        <h3>Assigned Orders Status</h3>
                        <div class="filter-panel">
                             <select id="assigned-status-filter">
                                <option value="all">All Statuses</option>
                                <option value="Pending">Pending</option>
                                <option value="Completed">Completed</option>
                                <option value="Late">Late</option>
                             </select>
                             <input type="date" id="assigned-date-filter" style="color-scheme: dark;">
                             <button id="clear-assigned-filters" class="btn" style="background-color: #333; color: white;">Clear Filters</button>
                        </div>
                        <div class="results-table-container">
                            <table class="results-table">
                                <thead><tr><th>Order ID</th><th>Agent</th><th>Status</th><th>Date Assigned</th></tr></thead>
                                <tbody id="assigned-table-body"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Profile Tab -->
                <div id="profile" class="tab-content">
                    <div class="widget">
                        <h3>Edit Profile</h3>
                        <div class="form-group">
                            <label for="profile-photo">Profile Picture</label>
                            <input type="file" id="profile-photo" accept="image/*" />
                        </div>
                        <div class="form-group">
                            <label for="profile-fullname">Full Name</label>
                            <input type="text" id="profile-fullname" value="Khaled Al-Mutairi">
                        </div>
                        <div class="form-group">
                            <label for="profile-email">Email Address</label>
                            <input type="email" id="profile-email" value="k.almutairi@qualityx.com">
                        </div>
                        <div class="form-group">
                            <label for="profile-phone">Phone Number</label>
                            <input type="tel" id="profile-phone" value="+966 55 123 5555">
                        </div>
                        <div class="page-actions">
                             <button class="btn" style="background: #333; color: white;">Cancel</button>
                             <button class="btn btn-primary" id="save-profile-btn">Save Changes</button>
                        </div>
                    </div>
                </div>

                <!-- MODIFIED: Settings Tab with more options -->
                <div id="settings" class="tab-content">
                    <div class="widget">
                        <h3>Settings</h3>
                        <p class="text-muted-color" style="margin-top:-1rem; margin-bottom: 2rem;">Manage team settings, rules, and your preferences.</p>
                        <div class="settings-grid">
                            <div class="form-group">
                                <h4>Notification Preferences</h4>
                                <div class="form-group toggle"><label for="in-app-notifications">In-App Notifications</label><input type="checkbox" id="in-app-notifications" checked></div>
                                <div class="form-group toggle"><label for="email-notifications">Email Notifications</label><input type="checkbox" id="email-notifications" checked></div>
                                <div class="form-group toggle"><label for="escalation-alerts">Urgent Escalation Alerts</label><input type="checkbox" id="escalation-alerts" checked></div>
                            </div>
                            <div class="form-group">
                                <h4>Interface Settings</h4>
                                <div class="form-group">
                                    <label for="theme-select">Theme</label>
                                    <select id="theme-select"><option value="dark">Dark</option><option value="light">Light</option></select>
                                </div>
                                <div class="form-group">
                                    <label for="language-select">Language</label>
                                    <select id="language-select"><option value="en">English</option><option value="ar">العربية</option></select>
                                </div>
                            </div>
                             <div class="form-group" style="grid-column: span 2;">
                                <h4>Auto-Escalation Rules</h4>
                                 <label for="auto-escalate-reason">Auto-escalate for reason:</label>
                                <select id="auto-escalate-reason">
                                    <option>Driver Behavior Issues</option>
                                    <option>Financial Fraud</option>
                                    <option>Do not auto-escalate</option>
                                </select>
                             </div>
                        </div>
                         <div class="page-actions">
                             <button class="btn btn-primary">Save Settings</button>
                        </div>
                    </div>
                </div>

                <!-- ADDED: KPIs Tab -->
                <div id="kpis" class="tab-content">
                     <div class="widget">
                        <h3>Manage Team Key Performance Indicators (KPIs)</h3>
                        <p class="text-muted-color" style="margin-top:-1rem; margin-bottom: 2rem;">Set the targets against which Quality Agents will be evaluated.</p>
                        <div class="settings-grid">
                            <div class="form-group">
                                <label for="kpi-accuracy">Minimum Review Accuracy Target (%)</label>
                                <input type="number" id="kpi-accuracy" value="98">
                            </div>
                            <div class="form-group">
                                <label for="kpi-reviews-day">Daily Reviews Target (per agent)</label>
                                <input type="number" id="kpi-reviews-day" value="25">
                            </div>
                            <div class="form-group">
                                <label for="kpi-aht">Average Handle Time Target (minutes)</label>
                                <input type="number" id="kpi-aht" value="5">
                            </div>
                             <div class="form-group">
                                <label for="kpi-escalation-rate">Allowed Escalation Rate (%)</label>
                                <input type="number" id="kpi-escalation-rate" value="3">
                            </div>
                        </div>
                        <div class="page-actions">
                             <button class="btn btn-primary">Update KPI Targets</button>
                        </div>
                    </div>
                </div>
                
                <!-- ADDED: Reports & Analytics Tab -->
                <div id="reports-analytics" class="tab-content">
                     <div class="widget">
                        <h3>Advanced Reports & Analytics</h3>
                        <div class="placeholder-content">
                            <h4>Reporting Dashboard</h4>
                            <p>Generate detailed reports on team performance, common error types, and escalation trends. (Feature in development)</p>
                        </div>
                    </div>
                </div>
                
                <div id="help" class="tab-content">
                     <div class="widget">
                        <div class="placeholder-content">
                            <h3>Help & Support</h3>
                            <p>Access documentation or contact IT support.</p>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="review-modal" class="modal-overlay">
      <div class="modal-box">
        <div class="modal-header">
            <h3 class="modal-title">Review Escalation: <span id="modal-order-id"></span></h3>
            <button class="modal-close-btn" data-modal-id="review-modal">×</button>
        </div>
        <div id="modal-body-content">
            <!-- Content Populated by JS -->
        </div>
      </div>
    </div>
    
    <script>
    // --- Helper Functions ---
    const getInitials = (name) => {
        if (!name) return '';
        const names = name.split(' ');
        return names.length > 1 ? `${names[0][0]}${names[names.length - 1][0]}`.toUpperCase() : `${names[0][0]}`.toUpperCase();
    };
    const showModal = (modalId) => document.getElementById(modalId)?.classList.add('show');
    const hideModal = (modalId) => document.getElementById(modalId)?.classList.remove('show');

    // --- Sample Data (English) ---
    let escalationsData = [
        { id: 'CZ-84371', issue: 'Spillage', escalatedBy: 'Fahad A.', date: '2025-07-26', comment: 'Customer reported a major spillage. Agent decision seems wrong.', status: 'Pending' },
        { id: 'CZ-84355', issue: 'Driver Behavior', escalatedBy: 'Ali K.', date: '2025-07-25', comment: 'Complex case. Need senior review on policy interpretation.', status: 'Pending' },
        { id: 'CZ-84340', issue: 'Missing Item', escalatedBy: 'Fahad A.', date: '2025-07-24', comment: 'The agent marked it correct, but proof suggests otherwise.', status: 'Pending' },
        { id: 'CZ-84300', issue: 'Wrong Item', escalatedBy: 'Hessa M.', date: '2025-07-23', comment: 'Agent needs feedback on this scenario.', status: 'Reviewed' }
    ];
    let unassignedOrdersData = [
        { orderId: '202389087', reason: 'Late Preparation', employee: 'Ali Alsurayyi-CU', chefz: 'QIS', orderStatus: 'Delivered', requestedDeliveryDate: 'July 11, 2025, 3:48 PM', paymentType: 'Apple Pay' },
        { orderId: '202496824', reason: 'Mishandling By Driver', employee: 'Mona Magdy-SU', chefz: 'DS40 - Ar Rimal', orderStatus: 'Delivered', requestedDeliveryDate: 'July 11, 2025, 7:11 PM', paymentType: 'Apple Pay' },
        { orderId: '202444032', reason: 'Missing Item/Addon', employee: 'System', chefz: 'Baskin Robbins', orderStatus: 'Delivered', requestedDeliveryDate: 'July 11, 2025, 9:00 PM', paymentType: 'Apple Pay' },
        { orderId: '202561955', reason: 'Mishandling By Driver', employee: 'Faisal Alqarni-DU', chefz: 'AZZEZI', orderStatus: 'Delivered', requestedDeliveryDate: 'July 11, 2025, 10:19 PM', paymentType: 'Wallet & MADA' },
        { orderId: '202580072', reason: 'Mishandling By Driver', employee: 'Bahinour Abdelrasoul-SU', chefz: 'Burgeration', orderStatus: 'Delivered', requestedDeliveryDate: 'July 11, 2025, 11:22 PM', paymentType: 'Apple Pay' }
    ];
    let assignedOrdersData = [
        { id: 'CZ-90050', agent: 'Fahad A.', status: 'Completed', date: '2025-07-27' },
        { id: 'CZ-90051', agent: 'Ali K.', status: 'Pending', date: '2025-07-27' },
        { id: 'CZ-90052', agent: 'Hessa M.', status: 'Pending', date: '2025-07-27' },
        { id: 'CZ-90053', agent: 'Fahad A.', status: 'Late', date: '2025-07-26' },
    ];
    const agents = ['Fahad A.', 'Ali K.', 'Hessa M.', 'Noura S.'];

    document.addEventListener('DOMContentLoaded', () => {
        const initialName = document.getElementById('sidebar-username').textContent;
        const welcomeName = initialName.split(' ')[0];
        document.getElementById('sidebar-avatar-initials').textContent = getInitials(initialName);
        document.getElementById('welcome-user-h2').textContent = `Welcome, ${welcomeName}!`;
        
        const pageTitle = document.getElementById('page-title');
        const tabs = document.querySelectorAll('.sidebar-nav a[data-tab]');
        const contentAreas = document.querySelectorAll('.tab-content');
        const notificationBtn = document.getElementById('notification-btn');
        const notificationDropdown = document.getElementById('notification-dropdown');

        tabs.forEach(tab => {
            tab.addEventListener('click', (e) => {
                e.preventDefault();
                const tabId = tab.dataset.tab;
                
                tabs.forEach(t => t.parentElement.classList.remove('active'));
                tab.parentElement.classList.add('active');
                
                contentAreas.forEach(area => area.classList.remove('active'));
                const activeTab = document.getElementById(tabId);
                if (activeTab) activeTab.classList.add('active');
                
                pageTitle.textContent = tab.textContent.trim().replace(/^[^\w\s]+/, '');
            });
        });

        notificationBtn.addEventListener('click', (e) => {
             e.stopPropagation();
             notificationDropdown.classList.toggle('show');
        });
        document.addEventListener('click', (e) => {
            if (!notificationBtn.parentElement.contains(e.target)) {
                notificationDropdown.classList.remove('show');
            }
        });
        
        document.querySelectorAll('.modal-close-btn').forEach(btn => btn.addEventListener('click', () => hideModal('review-modal')));

        // --- Render Functions ---
        const renderEscalations = () => {
            const tableBody = document.getElementById('escalation-table-body');
            const statusFilter = document.getElementById('escalation-status-filter').value;
            const searchTerm = document.getElementById('escalation-search').value.toLowerCase();
            
            const filteredData = escalationsData.filter(order => {
                const statusMatch = (statusFilter === 'all' || order.status === statusFilter);
                const searchMatch = (order.id.toLowerCase().includes(searchTerm));
                return statusMatch && searchMatch;
            });

            tableBody.innerHTML = filteredData.map(order => {
                const statusClass = order.status === 'Reviewed' ? 'status-reviewed' : 'status-pending';
                return `
                <tr data-order-id="${order.id}">
                    <td>${order.id}</td><td>${order.issue}</td><td>${order.escalatedBy}</td><td>${order.date}</td>
                    <td><span class="status-badge ${statusClass}">${order.status}</span></td>
                    <td><button class="btn btn-primary review-btn">Review</button></td>
                </tr>`;
            }).join('');
            document.getElementById('escalation-count').textContent = filteredData.length;
            addReviewButtonListeners();
        };
        
        const renderAssignments = () => {
            const unassignedBody = document.getElementById('unassigned-table-body');
            unassignedBody.innerHTML = unassignedOrdersData.map(order => `
                <tr>
                    <td><input type="checkbox" class="assign-checkbox" data-order-id="${order.orderId}"></td>
                    <td>${order.orderId}</td><td class="wrap-text">${order.reason}</td><td class="wrap-text">${order.employee}</td><td>${order.chefz}</td><td>${order.orderStatus}</td><td>${order.requestedDeliveryDate}</td><td>${order.paymentType}</td>
                </tr>`).join('');
            document.getElementById('unassigned-count').textContent = unassignedOrdersData.length;
            
            const agentSelect = document.getElementById('agent-select');
            agentSelect.innerHTML = agents.map(name => `<option value="${name}">${name}</option>`).join('');
            renderAssignedTable();
            updateScrollableTables();
        };

        const renderAssignedTable = () => {
            const assignedBody = document.getElementById('assigned-table-body');
            const statusFilter = document.getElementById('assigned-status-filter').value;
            const dateFilter = document.getElementById('assigned-date-filter').value;

            let filteredData = assignedOrdersData.filter(order => {
                const statusMatch = (statusFilter === 'all' || order.status === statusFilter);
                const dateMatch = (!dateFilter || order.date === dateFilter.replace(/-/g, '/'));
                return statusMatch && dateMatch;
            });
            
            const statusClasses = { 'Pending': 'status-pending', 'Completed': 'status-completed', 'Late': 'status-late' };
            assignedBody.innerHTML = filteredData.map(order => `
                <tr>
                    <td>${order.id}</td><td>${order.agent}</td>
                    <td><span class="status-badge ${statusClasses[order.status]}">${order.status}</span></td>
                    <td>${order.date}</td>
                </tr>`).join('');
        };

        function addReviewButtonListeners() {
            document.querySelectorAll('.review-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const orderId = e.target.closest('tr').dataset.orderId;
                    const orderData = escalationsData.find(o => o.id === orderId);
                    document.getElementById('modal-order-id').textContent = orderData.id;
                    const modalBody = document.getElementById('modal-body-content');
                    modalBody.innerHTML = `
                        <div class="escalation-details">
                            <div class="detail-item"><strong>Issue Type</strong><span>${orderData.issue}</span></div>
                            <div class="detail-item"><strong>Escalated By</strong><span>${orderData.escalatedBy}</span></div>
                            <div class="detail-item" style="grid-column: span 2;"><strong>Agent's Comment</strong><span>${orderData.comment}</span></div>
                        </div>
                        <hr style="border-color: var(--border-color); margin: 20px 0;">
                        <div class="feedback-form">
                            <label for="feedback-comment" style="font-weight: 500; margin-bottom: 8px; display:block;">Your Feedback & Final Decision:</label>
                            <textarea id="feedback-comment" rows="4" placeholder="e.g., I agree with the agent's assessment..."></textarea>
                            <div class="feedback-actions">
                                <button class="btn btn-danger" onclick="handleDecision('${orderId}', 'Error')">Confirm Error</button>
                                <button class="btn btn-success" onclick="handleDecision('${orderId}', 'Correct')">Mark as Correct</button>
                            </div>
                        </div>`;
                    showModal('review-modal');
                });
            });
        }
        
        window.handleDecision = (orderId, decision) => {
            const order = escalationsData.find(o => o.id === orderId);
            order.status = 'Reviewed';
            const feedback = document.getElementById('feedback-comment').value;
            alert(`Decision for ${orderId} logged as '${decision}'. Feedback: ${feedback || 'N/A'}`);
            hideModal('review-modal');
            renderEscalations();
        };
        
        document.getElementById('assign-btn').addEventListener('click', () => {
            const selectedAgent = document.getElementById('agent-select').value;
            const checkedBoxes = document.querySelectorAll('.assign-checkbox:checked');
            if (checkedBoxes.length === 0) {
                alert('Please select orders to assign.');
                return;
            }
            const idsToAssign = Array.from(checkedBoxes).map(cb => cb.dataset.orderId);
            unassignedOrdersData = unassignedOrdersData.filter(o => !idsToAssign.includes(o.orderId));
            const newAssignments = idsToAssign.map(id => ({ id, agent: selectedAgent, status: 'Pending', date: new Date().toLocaleDateString('en-CA') })); // YYYY-MM-DD
            assignedOrdersData.unshift(...newAssignments);
            alert(`${idsToAssign.length} order(s) assigned to ${selectedAgent}.`);
            renderAssignments();
        });
        
        const updateScrollableTables = () => {
            document.querySelectorAll('.results-table-container').forEach(container => {
                if (container.scrollWidth > container.clientWidth) {
                    container.classList.add('is-scrollable');
                } else {
                    container.classList.remove('is-scrollable');
                }
            });
        };
        window.addEventListener('resize', updateScrollableTables);

        // --- Filter Event Listeners ---
        document.getElementById('escalation-search').addEventListener('input', renderEscalations);
        document.getElementById('escalation-status-filter').addEventListener('change', renderEscalations);
        document.getElementById('assigned-status-filter').addEventListener('change', renderAssignedTable);
        document.getElementById('assigned-date-filter').addEventListener('change', renderAssignedTable);
        document.getElementById('clear-assigned-filters').addEventListener('click', () => {
            document.getElementById('assigned-status-filter').value = 'all';
            document.getElementById('assigned-date-filter').value = '';
            renderAssignedTable();
        });

        document.getElementById('save-profile-btn')?.addEventListener('click', () => {
            const newName = document.getElementById('profile-fullname').value;
            document.getElementById('sidebar-username').textContent = newName;
            document.getElementById('sidebar-avatar-initials').textContent = getInitials(newName);
            document.getElementById('welcome-user-h2').textContent = `Welcome, ${newName.split(' ')[0]}!`;
            alert('Profile updated successfully!');
        });
        
        // --- Chart.js Initializations ---
        Chart.defaults.font.family = 'Poppins';
        Chart.defaults.color = '#e6edf3';

        // Dashboard Charts
        new Chart(document.getElementById('personalPerformanceChart').getContext('2d'), { type: 'line', data: { labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri'], datasets: [{ label: 'Completed Reviews', data: [8, 12, 9, 15, 12], backgroundColor: 'rgba(0, 191, 255, 0.2)', borderColor: 'rgba(0, 191, 255, 1)', tension: 0.3, fill: true, }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: true }, title: { display: true, text: 'Personal Review Performance (Last 5 Days)', color: '#fff' } }, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } }, x: { grid: { display: false } } } } });
        new Chart(document.getElementById('teamErrorTypesChart').getContext('2d'), { type: 'pie', data: { labels: ['Missing Item', 'Driver Behavior', 'Spillage', 'Wrong Item'], datasets: [{ data: [45, 25, 15, 15], backgroundColor: [ '#dc3545', '#ffc107', '#17a2b8', '#6f42c1'], borderColor: 'var(--card-bg)', borderWidth: 4, }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Common Team Error Types', color: '#fff' } } } });
        
        // Agent Performance Charts
        new Chart(document.getElementById('agentAccuracyChart').getContext('2d'), { type: 'bar', data: { labels: agents, datasets: [{ label: 'Accuracy Rate (%)', data: [98.2, 97.5, 99.1, 96.8], backgroundColor: 'rgba(0, 191, 255, 0.6)', borderWidth: 1, borderRadius: 4, }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false }, title: { display: true, text: 'Agent Accuracy Rate (This Month)', color: '#fff' } }, scales: { y: { min: 95, grid: { color: 'rgba(255,255,255,0.1)' } }, x: { grid: { display: false } } } } });
        new Chart(document.getElementById('reviewsVsErrorsChart').getContext('2d'), { type: 'doughnut', data: { labels: ['Correct Reviews', 'Confirmed Errors'], datasets: [{ data: [5412, 123], backgroundColor: ['#28a745', '#dc3545'], borderColor: 'var(--card-bg)', borderWidth: 4, }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' }, title: { display: true, text: 'Team Overall Performance', color: '#fff' } } } });
        
        // Initial Render
        renderEscalations();
        renderAssignments();
    });
    </script>
</body>
</html>
