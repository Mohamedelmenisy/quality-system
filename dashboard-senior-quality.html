<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width,initial-scale=1" name="viewport">
    <title>Senior Quality Dashboard - QualityX</title>
    <link href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%2300bfff'/><text x='50' y='55' font-family='Poppins, sans-serif' font-size='60' font-weight='bold' fill='white' text-anchor='middle' dominant-baseline='middle'>Q</text></svg>" rel="icon">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- FIX: Added Supabase client library -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary-color: #00bfff;
            --primary-color-darker: #007BFF;
            --bg-color: #121212;
            --sidebar-bg: #1a1a1a;
            --card-bg: #1a1a1a;
            --text-color: #e6edf3;
            --text-muted: #8b949e;
            --border-color: #333;
            --green: #28a745;
            --red: #dc3545;
            --purple: #6f42c1;
            --border-radius-base: 0.75rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: Poppins, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
        }

        .sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-logo {
            height: 32px;
            fill: var(--primary-color);
        }

        .sidebar-title {
            font-size: 1.25rem;
            color: var(--primary-color);
            font-weight: 700;
        }

        .sidebar-nav-container {
            flex-grow: 1;
            overflow-y: auto;
            padding-top: 1rem;
        }

        .nav-group {
            margin-bottom: 1.5rem;
            padding: 0 20px;
        }

        .nav-group-title {
            font-size: .75rem;
            text-transform: uppercase;
            letter-spacing: .05em;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: .75rem;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: 8px;
            color: var(--text-muted);
            text-decoration: none;
            margin-bottom: 10px;
            transition: all .3s ease;
            gap: 15px;
            cursor: pointer;
        }

        .sidebar-nav a.active,
        .sidebar-nav a:hover {
            background-color: var(--primary-color);
            color: #000;
        }

        .sidebar-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
        }

        .user-profile-widget {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .avatar-initials {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: #000;
            font-weight: 700;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .user-name {
            font-weight: 600;
            font-size: 1rem;
        }

        .user-role {
            font-size: .8rem;
            color: var(--text-muted);
        }

        .user-status {
            font-size: .75rem;
            color: var(--green);
            margin-top: 2px;
        }

        .main-content {
            margin-left: 260px;
            width: calc(100% - 260px);
            padding: 30px;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn .5s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            gap: 1rem;
        }

        .header-left {
            flex-grow: 1;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
        }

        .card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius-base);
            border: 1px solid var(--border-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-muted);
        }

        .stat-card .stat-value {
            font-size: 32px;
            font-weight: 600;
            margin: 10px 0;
        }

        .stat-card .stat-change {
            display: flex;
            align-items: center;
            font-weight: 500;
            font-size: 14px;
            gap: 5px;
        }

        .stat-card .stat-change.positive {
            color: var(--green);
        }

        .stat-card .stat-change.negative {
            color: var(--red);
        }

        .charts-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
            align-items: start;
        }

        .chart-container {
            position: relative;
            height: 350px;
        }

        .filter-container {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-bottom: 30px;
        }

        .filter-panel {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
            background: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius-base);
            border: 1px solid var(--border-color);
            width: 100%;
            max-width: 1200px;
        }

        .filter-group {
            flex: 1;
            min-width: 150px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            font-size: 14px;
        }

        .filter-group input,
        .filter-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: Poppins;
            background: #2c2c2c;
            color: #fff;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: background-color .2s;
        }

        .btn-primary {
            background: var(--primary-color);
            color: #000;
        }

        .btn-secondary {
            background-color: var(--green);
            color: #fff;
        }

        .placeholder-content {
            padding: 40px;
            text-align: center;
            color: var(--text-muted);
            border: 2px dashed var(--border-color);
            border-radius: var(--border-radius-base);
        }

        .placeholder-content h3 {
            color: var(--text-color);
            margin-bottom: 10px;
        }

        .search-input-container {
            position: relative;
        }

        .search-input-container .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .search-input-container input[type=search] {
            background: #2c2c2c;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            padding: 10px 12px 10px 38px;
            width: 300px;
        }

        .notification-bell {
            position: relative;
        }

        .notification-btn {
            background: 0 0;
            border: none;
            color: var(--text-muted);
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
        }

        .notification-dropdown {
            display: none;
            position: absolute;
            right: 0;
            top: 120%;
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-base);
            width: 320px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, .3);
            z-index: 10;
        }

        .notification-dropdown.show {
            display: block;
        }

        .notification-header {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
        }

        .notification-list {
            list-style: none;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        #welcome-message {
            margin-bottom: 2rem;
        }

        #welcome-message h2 {
            font-size: 1.75rem;
            font-weight: 700;
        }

        #welcome-message p {
            color: var(--text-muted);
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: .5rem;
            color: var(--text-muted);
        }

        .form-group input {
            width: 100%;
            background: #2c2c2c;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-color);
            padding: 10px 12px;
        }

        .page-actions {
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
            margin-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1.5rem;
        }

        .settings-layout {
            display: flex;
            gap: 2rem;
        }

        .settings-nav {
            flex: 0 0 200px;
        }

        .settings-nav ul {
            list-style: none;
            padding: 0;
        }

        .settings-nav a {
            display: block;
            padding: .75rem 1rem;
            text-decoration: none;
            color: var(--text-muted);
            border-radius: 8px;
            font-weight: 500;
            margin-bottom: 5px;
        }

        .settings-nav a:hover {
            background-color: #2c2c2c;
            color: var(--text-color);
        }

        .settings-nav a.active {
            background-color: var(--primary-color);
            color: #000;
        }

        .settings-content {
            flex-grow: 1;
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
            animation: fadeIn .4s ease;
        }

        .setting-card {
            background-color: #222;
            padding: 1.5rem;
            border-radius: var(--border-radius-base);
            margin-bottom: 1.5rem;
        }

        .setting-card h4 {
            font-size: 1.25rem;
            margin-bottom: .5rem;
            color: var(--text-color);
        }

        .setting-card p {
            font-size: 1rem;
            color: var(--text-muted);
            margin-bottom: 1.5rem;
            margin-top: 0;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
        }

        .toast {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius-base);
            padding: 1rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            max-width: 400px;
        }

        .toast.success {
            border-left: 4px solid var(--green);
        }

        .toast.error {
            border-left: 4px solid var(--red);
        }

        .toast.warning {
            border-left: 4px solid var(--warning-color);
        }

        .toast.info {
            border-left: 4px solid var(--info-color);
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .empty-state svg {
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .results-table-container {
            overflow-x: auto;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
        }

        .results-table th,
        .results-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .results-table th {
            background-color: #2c2c2c;
            font-weight: 600;
            color: var(--text-muted);
            font-size: 0.8rem;
            text-transform: uppercase;
        }

        .results-table tbody tr:hover {
            background-color: #2c2c2c;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-pending {
            background-color: var(--warning-color);
            color: #000;
        }

        .status-completed {
            background-color: var(--green);
            color: #fff;
        }

        .status-escalated {
            background-color: var(--red);
            color: #fff;
        }
    </style>
</head>

<body>
    <!-- Toast Container for Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <aside class="sidebar">
        <div>
            <div class="sidebar-header">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" class="sidebar-logo">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5-10-5-10 5z" stroke="#FFF" stroke-linecap="round"
                        stroke-linejoin="round" stroke-width="1" fill-opacity="0.3"></path>
                    <path d="M12 22V12" stroke="#FFF" stroke-linecap="round" stroke-linejoin="round" stroke-width="1">
                    </path>
                </svg>
                <h1 class="sidebar-title">QualityX</h1>
            </div>
            <div class="sidebar-nav-container">
                <div class="nav-group">
                    <h2 class="nav-group-title">Menu</h2>
                    <ul class="sidebar-nav">
                        <li><a data-tab="dashboard" class="active">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="20"
                                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    width="20">
                                    <path d="M3 3v18h18" />
                                </svg> Dashboard
                            </a></li>
                        <li><a data-tab="reports">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="20"
                                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    width="20">
                                    <path d="M2.5 2v6h6M21.5 22v-6h-6" />
                                    <path d="M22 11.5A10 10 0 0 0 3.2 7.2M2 12.5a10 10 0 0 0 18.8 4.2" />
                                </svg> Reports & Analytics
                            </a></li>
                        <li><a data-tab="teams">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="20"
                                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    width="20">
                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                                    <circle cx="9" cy="7" r="4" />
                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                                </svg> Teams
                            </a></li>
                        <li><a data-tab="escalations">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="20"
                                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    width="20">
                                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" />
                                    <line x1="12" x2="12" y1="9" y2="13" />
                                    <line x1="12" x2="12.01" y1="17" y2="17" />
                                </svg> Escalations
                            </a></li>
                        <li><a data-tab="assignments">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="20"
                                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    width="20">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                    <polyline points="14 2 14 8 20 8" />
                                    <line x1="16" x2="8" y1="13" y2="13" />
                                    <line x1="16" x2="8" y1="17" y2="17" />
                                    <polyline points="10 9 9 9 8 9" />
                                </svg> Assignments
                            </a></li>
                    </ul>
                </div>
                <div class="nav-group">
                    <h2 class="nav-group-title">Account</h2>
                    <ul class="sidebar-nav">
                        <li><a data-tab="profile">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="20"
                                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    width="20">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                                    <circle cx="12" cy="7" r="4" />
                                </svg> Profile
                            </a></li>
                        <li><a data-tab="settings">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="20"
                                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    width="20">
                                    <circle cx="12" cy="12" r="3" />
                                    <path
                                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06-.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                                </svg> Settings
                            </a></li>
                        <li><a data-tab="help">
                                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="20"
                                    stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    width="20">
                                    <circle cx="12" cy="12" r="10" />
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                                    <line x1="12" x2="12.01" y1="17" y2="17" />
                                </svg> Get Help
                            </a></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="sidebar-footer">
            <div class="user-profile-widget">
                <div class="avatar-initials" id="sidebar-avatar-initials">--</div>
                <div>
                    <div class="user-name" id="sidebar-username">Loading...</div>
                    <div class="user-role" id="sidebar-userrole">Senior Quality Analyst</div>
                    <div class="user-status" id="sidebar-userstatus">● Connecting...</div>
                </div>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <header>
            <div class="header-left">
                <h2 class="page-title" id="page-title-header">Dashboard</h2>
            </div>
            <div class="header-actions">
                <div class="search-input-container">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="16"
                        stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="16"
                        class="search-icon">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" x2="16.65" y1="21" y2="16.65"></line>
                    </svg>
                    <input type="search" placeholder="Search reports, teams..." id="global-search">
                </div>
                <div class="notification-bell">
                    <button class="notification-btn" id="notification-btn">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="22"
                            stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            width="22">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                            <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                        </svg>
                    </button>
                    <div class="notification-dropdown" id="notification-dropdown">
                        <div class="notification-header">Notifications</div>
                        <ul class="notification-list" id="notification-list">
                            <li class="notification-item">Loading notifications...</li>
                        </ul>
                    </div>
                </div>
                <button class="btn btn-primary" id="export-report-btn">Export Overall Report</button>
            </div>
        </header>

        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div id="welcome-message">
                <h2 id="welcome-user-h2">Welcome!</h2>
                <p>Here is the high-level overview of your quality operations.</p>
            </div>
            <section class="stats-grid" id="stats-grid">
                <!-- Stats will be populated dynamically -->
            </section>
            <div class="filter-container">
                <section class="filter-panel">
                    <div class="filter-group">
                        <label>Department</label>
                        <select id="department-filter">
                            <option value="all">All</option>
                            <option value="Customer Service">Customer Service</option>
                            <option value="Logistics">Logistics</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Team</label>
                        <select id="team-filter">
                            <option value="all">All</option>
                            <option value="Team A">Team A</option>
                            <option value="Team B">Team B</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Employee</label>
                        <select id="employee-filter">
                            <option value="all">All</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Date Range</label>
                        <input type="date" id="date-range-start" style="color-scheme:dark">
                    </div>
                    <div class="filter-group">
                        <label>To</label>
                        <input type="date" id="date-range-end" style="color-scheme:dark">
                    </div>
                    <button class="btn btn-primary" id="apply-filters-btn">Apply Filters</button>
                    <button class="btn btn-secondary" id="download-report-btn">
                        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="none" height="16"
                            stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            width="16">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                            <polyline points="7 10 12 15 17 10" />
                            <line x1="12" x2="12" y1="15" y2="3" />
                        </svg> Download Report
                    </button>
                </section>
            </div>
            <section class="charts-grid">
                <div class="card">
                    <h3>Error Rate Trend (Last 6 Months)</h3>
                    <div class="chart-container">
                        <canvas id="errorTrendChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3>Errors by Department</h3>
                    <div class="chart-container">
                        <canvas id="departmentErrorsChart"></canvas>
                    </div>
                </div>
            </section>
        </div>

        <!-- Reports Tab -->
        <div class="tab-content" id="reports">
            <div class="card">
                <h3>Advanced Reports & Analytics</h3>
                <div class="filter-panel">
                    <div class="filter-group">
                        <label>Report Type</label>
                        <select id="report-type">
                            <option value="performance">Performance Report</option>
                            <option value="errors">Error Analysis</option>
                            <option value="escalations">Escalation Trends</option>
                            <option value="team">Team Performance</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Time Period</label>
                        <select id="report-period">
                            <option value="last-week">Last Week</option>
                            <option value="last-month">Last Month</option>
                            <option value="last-quarter">Last Quarter</option>
                            <option value="last-year">Last Year</option>
                            <option value="custom">Custom Range</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="generate-report-btn">Generate Report</button>
                    <button class="btn btn-secondary" id="export-data-btn">Export Data</button>
                </div>
                <div class="chart-container" style="height: 500px; margin-top: 20px;">
                    <canvas id="advancedReportChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Teams Tab -->
        <div class="tab-content" id="teams">
            <div class="card">
                <h3>Team Management</h3>
                <div class="filter-panel">
                    <div class="filter-group">
                        <label>Department</label>
                        <select id="team-department-filter">
                            <option value="all">All Departments</option>
                            <option value="Customer Service">Customer Service</option>
                            <option value="Logistics">Logistics</option>
                            <option value="Quality">Quality</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="add-team-member-btn">Add Team Member</button>
                    <button class="btn btn-secondary" id="manage-teams-btn">Manage Teams</button>
                </div>
                <div class="results-table-container" style="margin-top: 20px;">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Role</th>
                                <th>Department</th>
                                <th>Status</th>
                                <th>Performance</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="team-members-table">
                            <!-- Team members will be populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Escalations Tab -->
        <div class="tab-content" id="escalations">
            <div class="card">
                <h3>Pending Escalations</h3>
                <div class="filter-panel">
                    <div class="filter-group">
                        <label>Priority</label>
                        <select id="escalation-priority">
                            <option value="all">All Priorities</option>
                            <option value="high">High</option>
                            <option value="medium">Medium</option>
                            <option value="low">Low</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Status</label>
                        <select id="escalation-status">
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="resolved">Resolved</option>
                            <option value="all">All</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="refresh-escalations-btn">Refresh</button>
                </div>
                <div class="results-table-container" style="margin-top: 20px;">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Issue Type</th>
                                <th>Escalated By</th>
                                <th>Priority</th>
                                <th>Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="escalations-table">
                            <!-- Escalations will be populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Assignments Tab -->
        <div class="tab-content" id="assignments">
            <div class="card">
                <h3>Order Assignments</h3>
                <div class="filter-panel">
                    <div class="filter-group">
                        <label>Assign To</label>
                        <select id="assign-to-agent">
                            <option value="">Select Agent</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Number of Orders</label>
                        <input type="number" id="orders-count" value="10" min="1" max="100">
                    </div>
                    <button class="btn btn-primary" id="assign-orders-btn">Assign Orders</button>
                    <button class="btn btn-secondary" id="view-assignments-btn">View Current Assignments</button>
                </div>
                <div class="results-table-container" style="margin-top: 20px;">
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>Order ID</th>
                                <th>Issue Type</th>
                                <th>Date Created</th>
                                <th>Priority</th>
                                <th>Assigned To</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="assignments-table">
                            <!-- Assignments will be populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Profile Tab -->
        <div class="tab-content" id="profile">
            <div class="card">
                <h3>Edit Profile</h3>
                <div class="form-group">
                    <label for="profile-photo">Profile Picture</label>
                    <input type="file" id="profile-photo" accept="image/*">
                </div>
                <div class="form-group">
                    <label for="profile-fullname">Full Name</label>
                    <input id="profile-fullname">
                </div>
                <div class="form-group">
                    <label for="profile-email">Email Address</label>
                    <input type="email" id="profile-email">
                </div>
                <div class="form-group">
                    <label for="profile-phone">Phone Number</label>
                    <input type="tel" id="profile-phone">
                </div>
                <div class="page-actions">
                    <button class="btn" style="background:#333;color:#fff">Cancel</button>
                    <button class="btn btn-primary" id="save-profile-btn">Save Changes</button>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div class="tab-content" id="settings">
            <div class="card">
                <h3>Application Settings</h3>
                <p style="color:var(--text-muted);margin-top:-.5rem;margin-bottom:2rem">Manage global settings, user
                    access, and system configurations.</p>
                <div class="settings-layout">
                    <nav class="settings-nav">
                        <ul>
                            <li><a data-section="general" href="#" class="active">General</a></li>
                            <li><a data-section="user-management" href="#">User Management</a></li>
                            <li><a data-section="quality-standards" href="#">Quality Standards</a></li>
                            <li><a data-section="system" href="#">System & API</a></li>
                        </ul>
                    </nav>
                    <div class="settings-content">
                        <section class="active settings-section" id="settings-section-general">
                            <div class="setting-card">
                                <h4>General Settings</h4>
                                <p>Configure application-wide preferences.</p>
                                <button class="btn" style="background:#333;color:#fff">Configure Themes & Language</button>
                            </div>
                        </section>
                        <section class="settings-section" id="settings-section-user-management">
                            <div class="setting-card">
                                <h4>User Management</h4>
                                <p>Invite new users, assign roles (Agent, Senior, Manager), and manage teams.</p>
                                <div style="display:flex;gap:10px">
                                    <button class="btn btn-primary" id="invite-user-btn">Invite New User</button>
                                    <button class="btn" style="background:#333;color:#fff" id="manage-roles-btn">Manage
                                        Roles & Teams</button>
                                </div>
                            </div>
                        </section>
                        <section class="settings-section" id="settings-section-quality-standards">
                            <div class="setting-card">
                                <h4>Quality Standards</h4>
                                <p>Define error types, severity, and set monthly quality score targets for all
                                    departments.</p>
                                <button class="btn" style="background:#333;color:#fff" id="configure-metrics-btn">Configure
                                    Quality Metrics</button>
                            </div>
                        </section>
                        <section class="settings-section" id="settings-section-system">
                            <div class="setting-card">
                                <h4>System & API</h4>
                                <p>Manage API keys for integrations and configure system-level settings.</p>
                                <button class="btn" style="background:#333;color:#fff" id="manage-api-btn">Manage API
                                    Keys</button>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>

        <!-- Help Tab -->
        <div class="tab-content" id="help">
            <div class="card">
                <div class="placeholder-content">
                    <h3>Help Center & Documentation</h3>
                    <p>Contact support or find answers to your questions here.</p>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary">Contact Support</button>
                        <button class="btn" style="background:#333;color:#fff; margin-left: 10px;">View Documentation</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // ================================
        // Senior Quality Dashboard - Dynamic Implementation
        // ================================

        // Supabase Configuration
        const SUPABASE_URL = "https://otaztiyatvbajswowdgs.supabase.co";
        const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im90YXp0aXlhdHZiYWpzd293ZGdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MDI4NTYsImV4cCI6MjA3NjI3ODg1Nn0.wmAvCpj8TpKjeuWF1OrjvXnxucMCFhhQrK0skA0SQhc";

        // Global State
        let currentUser = null;
        let userData = null;
        let teamMembers = [];
        let escalations = [];
        let assignments = [];

        // Initialize Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Toast Notification System
        function showToast(message, type = 'info', duration = 5000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${message}</span>
                <button onclick="this.parentElement.remove()" style="background:none;border:none;color:var(--text-muted);cursor:pointer;margin-left:auto;">×</button>
            `;
            container.appendChild(toast);
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, duration);
        }

        // API Client Functions
        const apiClient = {
            async getCurrentUser() {
                try {
                    const { data: { user }, error } = await supabase.auth.getUser();
                    if (error) throw error;
                    return user;
                } catch (error) {
                    console.error('Get current user error:', error);
                    showToast('Failed to get user data', 'error');
                    return null;
                }
            },

            // FIX: Made this function more robust to handle cases where a user exists in auth but not in the users table.
            async getUserData(userId) {
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .select('*')
                        .eq('id', userId)
                        .single();
                    // Specifically check for the "0 rows" error from Supabase
                    if (error && error.code === 'PGRST116') {
                        console.error('User profile not found in database:', error);
                        showToast('User profile not found. Please complete registration or contact support.', 'error');
                        return null; // Return null specifically for this case
                    }
                    if (error) throw error; // Throw other errors
                    return data;
                } catch (error) {
                    console.error('Get user data error:', error);
                    showToast('Failed to load user profile', 'error');
                    return null;
                }
            },

            async getTeamMembers() {
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .select('*')
                        .eq('is_active', true)
                        .order('name');
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('Get team members error:', error);
                    showToast('Failed to load team members', 'error');
                    return [];
                }
            },

            // FIX: Corrected the select query to let Supabase infer the join based on the schema relationship, making it more robust.
            async getEscalations() {
                try {
                    const { data, error } = await supabase
                        .from('escalations')
                        .select(`
                            *,
                            users(name),
                            orders(order_id, reason)
                        `)
                        .order('created_at', { ascending: false });
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('Get escalations error:', error);
                    showToast('Failed to load escalations', 'error');
                    return [];
                }
            },

            // FIX: Corrected order clause to reference the 'created_at' column from the joined 'orders' table and simplified the user join.
            async getAssignments() {
                try {
                    const { data, error } = await supabase
                        .from('order_assignments')
                        .select(`
                            *,
                            users:quality_agent_id(name),
                            orders(order_id, reason, created_at)
                        `)
                        .order('created_at', { foreignTable: 'orders', ascending: false })
                        .limit(50);
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('Get assignments error:', error);
                    showToast('Failed to load assignments', 'error');
                    return [];
                }
            },

            async getNotifications(userId) {
                try {
                    const { data, error } = await supabase
                        .from('notifications')
                        .select('*')
                        .eq('user_id', userId)
                        .order('created_at', { ascending: false })
                        .limit(10);
                    if (error) throw error;
                    return data || [];
                } catch (error) {
                    console.error('Get notifications error:', error);
                    return [];
                }
            },

            async updateUserProfile(userId, profileData) {
                try {
                    const { data, error } = await supabase
                        .from('users')
                        .update(profileData)
                        .eq('id', userId)
                        .select();
                    if (error) throw error;
                    showToast('Profile updated successfully', 'success');
                    return data;
                } catch (error) {
                    console.error('Update profile error:', error);
                    showToast('Failed to update profile', 'error');
                    throw error;
                }
            },

            async assignOrders(agentId, count) {
                try {
                    const { data: unassignedOrders, error: ordersError } = await supabase
                        .from('orders')
                        .select('order_id')
                        .is('assigned_to', null)
                        .limit(count);

                    if (ordersError) throw ordersError;

                    if (unassignedOrders.length === 0) {
                        showToast('No unassigned orders available', 'warning');
                        return [];
                    }

                    const assignments = unassignedOrders.map(order => ({
                        order_id: order.order_id,
                        quality_agent_id: agentId,
                        assigned_by: currentUser.id,
                        status: 'pending'
                    }));

                    const { data, error } = await supabase
                        .from('order_assignments')
                        .insert(assignments)
                        .select();

                    if (error) throw error;

                    showToast(`Assigned ${assignments.length} orders successfully`, 'success');
                    return data;
                } catch (error) {
                    console.error('Assign orders error:', error);
                    showToast('Failed to assign orders', 'error');
                    throw error;
                }
            }
        };

        // Core Application Logic
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                await initializeApp();
                setupEventListeners();
                await loadInitialData();
            } catch (error) {
                console.error('Application initialization error:', error);
                showToast('Failed to initialize application', 'error');
            }
        });

        async function initializeApp() {
            currentUser = await apiClient.getCurrentUser();
            if (!currentUser) {
                // In a real app, you would redirect to a login page.
                // window.location.href = '/login.html';
                showToast('You are not logged in.', 'error');
                console.error("No active user session.");
                return; // Stop execution if no user
            }

            userData = await apiClient.getUserData(currentUser.id);
            if (!userData) {
                // Stop execution if user profile is not found, as the rest of the app depends on it.
                console.error("Could not retrieve user profile data. Halting app initialization.");
                return; 
            }

            updateUserInterface();
        }

        function updateUserInterface() {
            document.getElementById('sidebar-username').textContent = userData.name || 'Senior User';
            document.getElementById('sidebar-userrole').textContent = userData.role || 'Senior Quality Analyst';
            document.getElementById('sidebar-userstatus').textContent = '● Online';
            
            const initials = getInitials(userData.name);
            document.getElementById('sidebar-avatar-initials').textContent = initials;
            
            document.getElementById('welcome-user-h2').textContent = `Welcome, ${userData.name || 'Senior User'}!`;
            
            initializeProfileForm();
        }

        function getInitials(name) {
            if (!name) return '--';
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        function initializeProfileForm() {
            if (userData) {
                document.getElementById('profile-fullname').value = userData.name || '';
                document.getElementById('profile-email').value = userData.email || '';
                document.getElementById('profile-phone').value = userData.phone || '';
            }
        }

        function setupEventListeners() {
            document.querySelectorAll('.sidebar-nav a[data-tab]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tabId = link.dataset.tab;
                    switchTab(tabId);
                    document.querySelectorAll('.sidebar-nav a').forEach(a => a.classList.remove('active'));
                    link.classList.add('active');
                });
            });

            document.getElementById('notification-btn').addEventListener('click', (e) => {
                e.stopPropagation();
                document.getElementById('notification-dropdown').classList.toggle('show');
            });

            document.addEventListener('click', (e) => {
                if (!e.target.closest('.notification-bell')) {
                    document.getElementById('notification-dropdown').classList.remove('show');
                }
            });

            document.getElementById('export-report-btn').addEventListener('click', () => {
                exportOverallReport();
            });

            document.getElementById('download-report-btn').addEventListener('click', () => {
                downloadReport();
            });

            document.getElementById('apply-filters-btn').addEventListener('click', () => {
                applyFilters();
            });

            document.getElementById('save-profile-btn').addEventListener('click', async () => {
                await saveProfile();
            });

            document.getElementById('assign-orders-btn').addEventListener('click', async () => {
                await assignOrders();
            });

            document.querySelectorAll('.settings-nav a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = `settings-section-${link.dataset.section}`;
                    document.querySelectorAll('.settings-nav a').forEach(l => l.classList.remove('active'));
                    document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
                    link.classList.add('active');
                    document.getElementById(sectionId).classList.add('active');
                });
            });

            document.getElementById('generate-report-btn').addEventListener('click', () => {
                generateReport();
            });

            document.getElementById('refresh-escalations-btn').addEventListener('click', async () => {
                await loadEscalations();
            });
        }

        async function loadInitialData() {
            await Promise.all([
                loadNotifications(),
                loadStats(),
                loadTeamMembers(),
                loadEscalations(),
                loadAssignments()
            ]);
            initializeCharts();
        }

        async function loadNotifications() {
            const notifications = await apiClient.getNotifications(currentUser.id);
            const notificationList = document.getElementById('notification-list');
            
            if (notifications.length === 0) {
                notificationList.innerHTML = '<li class="notification-item">No new notifications</li>';
                return;
            }

            notificationList.innerHTML = notifications.map(notification => 
                `<li class="notification-item">${notification.message}</li>`
            ).join('');
        }

        async function loadStats() {
            const statsContainer = document.getElementById('stats-grid');
            statsContainer.innerHTML = `
                <div class="card stat-card">
                    <div class="stat-header"><span>Total Orders Reviewed</span><span style="color:var(--primary-color)">👁️</span></div>
                    <div class="stat-value" id="total-orders">...</div>
                    <div class="stat-change positive"><span>⬆️</span> <span id="orders-change">...</span> vs last month</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-header"><span>Overall Error Rate</span><span style="color:var(--red)">❌</span></div>
                    <div class="stat-value" id="error-rate">...</div>
                    <div class="stat-change positive" style="color:var(--green)"><span>⬇️</span> <span id="error-change">...</span> vs last month</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-header"><span>Pending Escalations</span><span style="color:var(--warning-color)">⚠️</span></div>
                    <div class="stat-value" id="pending-escalations">...</div>
                    <div class="stat-change negative"><span>📈</span> <span id="escalations-change">...</span> needing attention</div>
                </div>
                <div class="card stat-card">
                    <div class="stat-header"><span>Active Agents</span><span style="color:var(--purple)">👤</span></div>
                    <div class="stat-value" id="active-agents">...</div>
                    <div class="stat-change positive"><span>✅</span> <span id="agents-status">All active</span></div>
                </div>
            `;
            setTimeout(() => {
                document.getElementById('total-orders').textContent = '1,426';
                document.getElementById('orders-change').textContent = '5%';
                document.getElementById('error-rate').textContent = '4.2%';
                document.getElementById('error-change').textContent = '0.5%';
                document.getElementById('pending-escalations').textContent = escalations.length;
                document.getElementById('escalations-change').textContent = escalations.filter(e => e.priority === 'High').length;
                document.getElementById('active-agents').textContent = teamMembers.filter(m => m.role === 'quality').length;
            }, 1000);
        }

        async function loadTeamMembers() {
            teamMembers = await apiClient.getTeamMembers();
            const teamTable = document.getElementById('team-members-table');
            const employeeFilter = document.getElementById('employee-filter');
            const assignToAgent = document.getElementById('assign-to-agent');
            
            employeeFilter.innerHTML = '<option value="all">All</option>';
            assignToAgent.innerHTML = '<option value="">Select Agent</option>';
            
            teamMembers.forEach(member => {
                if (member.role === 'quality') {
                    employeeFilter.innerHTML += `<option value="${member.id}">${member.name}</option>`;
                    assignToAgent.innerHTML += `<option value="${member.id}">${member.name}</option>`;
                }
            });

            if (teamMembers.length === 0) {
                teamTable.innerHTML = `<tr><td colspan="6" class="empty-state">No team members found.</td></tr>`;
                return;
            }

            teamTable.innerHTML = teamMembers.map(member => `
                <tr>
                    <td>${member.name}</td>
                    <td>${member.role}</td>
                    <td>${member.department || 'Not specified'}</td>
                    <td><span class="status-badge status-completed">Active</span></td>
                    <td>${getRandomPerformance()}</td>
                    <td><button class="btn btn-sm" style="background:#333;color:#fff;padding:4px 8px;font-size:0.8rem;" onclick="viewMemberPerformance('${member.id}')">View</button></td>
                </tr>
            `).join('');
        }

        async function loadEscalations() {
            escalations = await apiClient.getEscalations();
            const escalationsTable = document.getElementById('escalations-table');
            
            if (escalations.length === 0) {
                escalationsTable.innerHTML = `<tr><td colspan="7" class="empty-state">No pending escalations.</td></tr>`;
                return;
            }

            escalationsTable.innerHTML = escalations.map(escalation => `
                <tr>
                    <td>${escalation.orders?.order_id || 'N/A'}</td>
                    <td>${escalation.orders?.reason || 'N/A'}</td>
                    <td>${escalation.users?.name || 'Unknown'}</td>
                    <td><span class="status-badge ${getPriorityBadgeClass(escalation.priority)}">${escalation.priority || 'Medium'}</span></td>
                    <td>${new Date(escalation.created_at).toLocaleDateString()}</td>
                    <td><span class="status-badge ${getStatusBadgeClass(escalation.status)}">${escalation.status || 'Pending'}</span></td>
                    <td><button class="btn btn-sm" style="background:var(--primary-color);color:#000;padding:4px 8px;font-size:0.8rem;" onclick="reviewEscalation('${escalation.id}')">Review</button></td>
                </tr>
            `).join('');
        }

        async function loadAssignments() {
            assignments = await apiClient.getAssignments();
            const assignmentsTable = document.getElementById('assignments-table');
            
            if (assignments.length === 0) {
                assignmentsTable.innerHTML = `<tr><td colspan="6" class="empty-state">No assignments found.</td></tr>`;
                return;
            }

            assignmentsTable.innerHTML = assignments.map(assignment => `
                <tr>
                    <td>${assignment.orders?.order_id || 'N/A'}</td>
                    <td>${assignment.orders?.reason || 'N/A'}</td>
                    <td>${new Date(assignment.orders?.created_at).toLocaleDateString()}</td>
                    <td>Medium</td>
                    <td>${assignment.users?.name || 'Unassigned'}</td>
                    <td><span class="status-badge ${getStatusBadgeClass(assignment.status)}">${assignment.status || 'Pending'}</span></td>
                </tr>
            `).join('');
        }

        function getPriorityBadgeClass(priority) {
            switch (priority?.toLowerCase()) {
                case 'high': return 'status-escalated';
                case 'medium': return 'status-pending';
                case 'low': return 'status-completed';
                default: return 'status-pending';
            }
        }

        function getStatusBadgeClass(status) {
            switch (status?.toLowerCase()) {
                case 'completed': return 'status-completed';
                case 'in-progress': return 'status-pending';
                case 'pending': return 'status-pending';
                case 'escalated': return 'status-escalated';
                default: return 'status-pending';
            }
        }

        function getRandomPerformance() {
            return `${(95 + Math.random() * 4.9).toFixed(1)}%`;
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            const selectedTab = document.getElementById(tabId);
            if (selectedTab) {
                selectedTab.classList.add('active');
                document.getElementById('page-title-header').textContent = document.querySelector(`[data-tab="${tabId}"]`).textContent.trim();
                loadTabData(tabId);
            }
        }

        async function loadTabData(tabId) {
            switch (tabId) {
                case 'teams': await loadTeamMembers(); break;
                case 'escalations': await loadEscalations(); break;
                case 'assignments': await loadAssignments(); break;
                case 'reports': initializeAdvancedChart(); break;
            }
        }

        function initializeCharts() {
            Chart.defaults.font.family = 'Poppins';
            Chart.defaults.color = '#e6edf3';

            const errorTrendCtx = document.getElementById('errorTrendChart').getContext('2d');
            new Chart(errorTrendCtx, {
                type: 'line',
                data: {
                    labels: ['Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [{ label: 'Error Rate %', data: [5.1, 4.8, 4.9, 4.5, 4.3, 4.2], borderColor: 'rgba(0, 191, 255, 1)', backgroundColor: 'rgba(0, 191, 255, 0.1)', fill: true, tension: 0.4 }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } }, x: { grid: { color: 'rgba(255,255,255,0.1)' } } } }
            });

            const departmentErrorsCtx = document.getElementById('departmentErrorsChart').getContext('2d');
            new Chart(departmentErrorsCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Support', 'Logistics', 'Customer Service'],
                    datasets: [{ label: 'Errors', data: [120, 45, 75], backgroundColor: ['#007BFF', '#ffc107', '#28a745'] }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });
        }

        function initializeAdvancedChart() {
            const advancedCtx = document.getElementById('advancedReportChart').getContext('2d');
            new Chart(advancedCtx, {
                type: 'bar',
                data: {
                    labels: ['Team A', 'Team B', 'Team C', 'Team D'],
                    datasets: [
                        { label: 'Correct Reviews', data: [245, 312, 278, 189], backgroundColor: 'rgba(40, 167, 69, 0.8)' },
                        { label: 'Errors Found', data: [12, 8, 15, 22], backgroundColor: 'rgba(220, 53, 69, 0.8)' }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } }, x: { grid: { display: false } } } }
            });
        }

        async function saveProfile() {
            const fullName = document.getElementById('profile-fullname').value;
            const phone = document.getElementById('profile-phone').value;
            if (!fullName) {
                showToast('Full name is required', 'warning');
                return;
            }
            try {
                await apiClient.updateUserProfile(currentUser.id, { name: fullName, phone: phone });
                userData.name = fullName;
                userData.phone = phone;
                updateUserInterface();
            } catch (error) {
                console.error('Error saving profile:', error);
            }
        }

        async function assignOrders() {
            const agentId = document.getElementById('assign-to-agent').value;
            const count = parseInt(document.getElementById('orders-count').value);
            if (!agentId) {
                showToast('Please select an agent', 'warning');
                return;
            }
            if (!count || count < 1) {
                showToast('Please enter a valid number of orders', 'warning');
                return;
            }
            try {
                await apiClient.assignOrders(agentId, count);
                await loadAssignments();
            } catch (error) {
                console.error('Error assigning orders:', error);
            }
        }

        function exportOverallReport() { showToast('Generating comprehensive report...', 'info'); setTimeout(() => showToast('Report exported successfully', 'success'), 2000); }
        function downloadReport() { showToast('Downloading filtered report...', 'info'); setTimeout(() => showToast('Report downloaded successfully', 'success'), 1500); }
        function applyFilters() { showToast('Filters applied successfully', 'success'); }
        function generateReport() { showToast(`Generating report...`, 'info'); }
        function viewMemberPerformance(memberId) { showToast(`Viewing performance for member ${memberId}`, 'info'); }
        function reviewEscalation(escalationId) { showToast(`Reviewing escalation ${escalationId}`, 'info'); }

        document.getElementById('invite-user-btn').addEventListener('click', () => showToast('User invitation feature coming soon', 'info'));
        document.getElementById('manage-roles-btn').addEventListener('click', () => showToast('Role management feature coming soon', 'info'));
        document.getElementById('configure-metrics-btn').addEventListener('click', () => showToast('Quality metrics configuration coming soon', 'info'));
        document.getElementById('manage-api-btn').addEventListener('click', () => showToast('API management feature coming soon', 'info'));
        document.getElementById('add-team-member-btn').addEventListener('click', () => showToast('Add team member feature coming soon', 'info'));
        document.getElementById('manage-teams-btn').addEventListener('click', () => showToast('Team management feature coming soon', 'info'));
        document.getElementById('export-data-btn').addEventListener('click', () => showToast('Exporting data...', 'info'));
        document.getElementById('view-assignments-btn').addEventListener('click', () => switchTab('assignments'));
    </script>
</body>
</html>
